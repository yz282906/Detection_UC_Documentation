{"preview":false,"result":{"updated_time":"1631219356","updated":"2021-09-09","title":"Access - AWS Root Account Usage - Console Sign In - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"AWS Root Account Usage - Console Sign In","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 09/09/21: Created Search\nAuthor: Zunyan Yang\n\n#### Goal\nThe goal of this alert is to monitor and generate real time alerts that detects when a user signs in via the AWS console as root.\n\n#### Categorization\nMITRE ATT&CK: T1078\n\n#### Strategy Abstract\nThe search logic is querying AWS Cloudtrail logs for root account login \n\n#### Technical Context\nAWS root account login via console is prohibited per policy. This alert indicates unauthorized use of an AWS account by Zoom personnel or could indicate malicious use by an external actor.\n\n#### Blind Spots and Assumptions\nThe alert assumes all AWS account CloudTrail logs are ingested and available in Splunk.\n\n#### False Positives\nNo false positives are known at this time.\n\n#### Validation\nThe Operations team can log in to an AWS account's web console with a known root account. \n\n#### Priority\nMedium\n\n#### Response\nThe source IP address should be investigated to understand the source of the AWS root account use. Based on findings, the appriopriate Zoom team should consulted with to understand why the account was used. If the source IP address appears to be associated with an external actor, the event should be escalated appropriately.\n\n#### Additional Resources\n[Access, Authentication, and Monitoring Standard](https://c1secure.service-now.com/kb_view.do?sys_kb_id=f94943501b4f2050c8194118cc4bcb53)","search":"sourcetype=aws:cloudtrail eventName=ConsoleLogin user_type=Root  | rename userIdentity.arn as user | stats earliest(_time) as firstTime latest(_time) as lastTime by user","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"AWS Root Account Usage - Console Sign In","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1631218825","updated":"2021-09-09","title":"Threat - AWS GuardDuty Alert: PenTest/KaliLinux  - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS GuardDuty Alert: PenTest/KaliLinux ","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 09/08/2021: Created Search for PenTest:S3/KaliLinux GuardDuty findings.\nAuthor: Zunyan Yang\n\n#### Goal\nThe goal of this correlation search is to reproduce the organization's AWS GuardDuty alerts in Splunk ES for SOC review and triage.\n\n#### Categorization\nThere will be a number of various frameworks and ATT&CK techniques that apply to specific alerts recreated as a result of this search.\n\n#### Strategy Abstract\nAWS GuardDuty is a service provided by AWS that performs prebuilt cloud-specific detection capabilities on AWS EC2 instances, S3 buckets, and IAM issues. The alerts are well-tuned and high quality.\n\n#### Technical Context\nThis correlation search reproduces GuardDuty alerts in Splunk ES as notable events. GuardDuty findings are consistently updated as a condition persists, so events are suppressed (based on signature field) in Splunk ES for 7 days to minimize noise. If a GuardDuty alert remains unhandled for 7 days or is not properly remediated, a ES notable event will be recreated for the same finding. \n\nAWS has documented each GuardDuty signature ID in detail here: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html)\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS GuardDuty data is available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for GuardDuty. Blind spots may exist if new AWS accounts are introduced and not properly configured for GuardDuty and logging to Splunk.\n\n#### False Positives\nFalse positives are unlikely to result from this correlation search. Any well identified false positives should be escalated to the Detection Team for tuning upstream in GuardDuty.\n\n#### Validation\nThe search can be validated by comparing findings in the AWS GuardDuty console to the Splunk logs that result from the base search of this correlation search. The results should align with the records in GuardDuty.\n\n#### Priority\nThe priority of each alert will be replicated based on the priority assigned by AWS as follows: 8 - High, 5 - Medium, 3 - Low\n\n#### Response\n**Triage Steps**\n\t•\tDetermine what resources those credentials have access to, by checking IAM credentials will be associated with an IAM user and you should review the user’s IAM policies. We can use IAM console.\u2028\n\t•\tNote what all the policies applied to the IAM user account.\u2028\n\t•\tCheck IAM access analyser to identify the resources accessed.\u2028\n\t•\tNote what all the applications and resources using these credentials.\u2028\n\t•\tInvalidate the credentials so they can no longer be used to access your account.\u2028\n\t•\tConsider invalidating any temporary security credentials that might have been issued using the credentials.\u2028\n\t•\tVerify and note what all the resources are created by this IAM user account.\u2028\n\t•\tInvalidating Temporary Security Credentials by deleting the IAM user.\u2028\n\t•\tRestore appropriate access by creating new IAM user account with same permissions.\u2028\n\t•\tRemove all the rouge user accounts, instances, S3 buckets created by bad actor.\u2028\n\t•\tDocument all the evidence from the analysis and Create executive summary report and update it in SNOW ticket.\u2028\n\t•\tDocument the lessons learned from the Incident which is occurred.\u2028\n\t•\tAfter all the tasks have been completed, Send a final email to AWS notifying them about remediation actions\u2028\n\t•\tClose the SNOW incident ticket.\u2028\n\n#### Additional Resources\nMore information on AWS GuardDuty can be found here: [https://aws.amazon.com/guardduty/](https://aws.amazon.com/guardduty/)\n\nAWS provides remediation recommendations for each signature ID here: [https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html](https://docs.aws.amazon.com/guardduty/latest/ug/guardduty_finding-types-active.html)","search":"index=aws sourcetype=aws:cloudwatch:guardduty category=\"PenTest:S3/KaliLinux\" OR category=\"PenTest:IAMUser/KaliLinux\" |stats count by  _time, category,description, accountId, region, severity, type","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"AWS GuardDuty Alert: PenTest:S3/KaliLinux","action.notable.param.rule_description":"The goal of this correlation search is to reproduce the organization's AWS GuardDuty alerts in Splunk ES for SOC review and triage.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1631195678","updated":"2021-09-09","title":"Threat - Command Channel Relay - Rule","index":"paloaltocdl","datamodel":"N/A","product":"Palo Alto Networks","action.correlationsearch.label":"Command Channel Relay","author":"john.pierce@zoom.us","disabled":"0","description":"### Release Notes \n- 09/09/2021: Search Released\n- Author: John Pierce\n### Goal\nThis search detects the use of tools that provide a command channel (RDP, SSH, Telnet, VNC) employed to bypass access restrictions or obscure the real source of actions. \n### Categorization\nMITRE ATT&CK: \nT1021.001 \nT1021.004 \nT1021.005 \n### Strategy\nAbstract A command relay occurs when a user establishes a command channel (RDP, SSH, Telnet, or VNC) from DeviceA (origin) to DeviceB (relay), and then uses that connection to establish a command channel from DeviceB (relay) to DeviceC (final destination). This is generally used to circumvent access controls intended to prevent DeviceA from accessing DeviceC. It can also be used to obscure the original source of malicious activity. \n### Technical Context\nThis detection contains a subsearch that extracts the source ip as origin_ip and the destination ip as relay_ip for all command channels. The main search then extracts the source ip as relay_ip and the destination ip as the final_destination. The query performs an inner join on relay_ip so that we only keep addresses where relay_ip was both a command channel source and destination in the time window observed. The list of candidates are checked to see if the second connection started and ended while the original command channel was still active. It also ensures that the origin connection contained more bytes than the relay connection. If either case isn’t true then the origin connection couldn’t have controlled the relay connection. In that case, the events are discarded. RDP and Telnet have a singular function, but SSH and VNC can be used interactively or as file transfer protocols. \n\nThe query filters out likely file transfers (large average packet sizes and byte ratios that are heavily one-sided) to prevent false positives due to secure copy or a VNC file transfer/print. The query also eliminates connections with 5 or less packets to filter out scanning activity before we perform real logic. Finally, no connection with less than 50kB total bytes is considered. This filter is there to eliminate the false positives from very small file transfers where there isn’t enough data to identify it correctly as a data transfer. \n### Blind Spots and Assumptions\nThis alert requires the relay device to be behind a PAN firewall that logs to the paloaltocdl or paloalto_cn index. \n### False Positives\nIt is possible that a file transfer over SSH may escape our filtering. If so, we can adjust the filters. It is also possible that there are \"jump boxes\" that are known and blessed by IT. For example, web developers in China use a SSH relay to access our git. If more cases like this are found, we will need to update command_channel_relay_filter. We don’t want to introduce unintended blindspots, so filters should be applied in pairs- origin_ip and final_destination together. \n### Validation \nThis can be manually verified by establishing a connection to our VPN, open a SSH connection to a device in our network, and then use that connection to open an additional connection to a second device. \n### Priority \nMedium \n### Response\nYou should identify the user and final destination to determine if the relay chain served a legitimate purpose or was malicious. \n### Additional Resources \n### Correlation Search:\n    (index=paloaltocdl OR index=paloalto_cn) sourcetype=pan:traffic packets>5 bytes>50000 | where (app IN(\"ssh\", \"ms-rdp\", \"telnet\") OR like(app,\"vnc%\")) OR (transport=\"tcp\" AND dest_port IN(\"22\", \"3389\", \"23\", \"5500\", \"5800\", \"5900\")) | eval ratio=(bytes_in/bytes * 100) | eval avgpktsize=bytes/packets | where avgpktsize<700 AND ratio<85 AND ratio>15 | eval final_app=app.\" \".transport.\"-\".dest_port | fields dest_ip, src_ip, final_app, start_time, duration, bytes, user | rename src_ip AS relay_ip, start_time AS relay_start, dest_ip AS final_destination, user AS origin_user, duration AS relay_duration, bytes AS relayed_bytes | join relay_ip type=inner max=0 [ search (index=paloaltocdl OR index=paloalto_cn) sourcetype=pan:traffic packets>5 bytes>50000 | where (app IN(\"ssh\", \"ms-rdp\", \"telnet\") OR like(app,\"vnc%\")) OR (transport=\"tcp\" AND dest_port IN(\"22\", \"3389\", \"23\", \"5500\", \"5800\", \"5900\")) | eval ratio=(bytes_in/bytes * 100) | eval avgpktsize=bytes/packets | where avgpktsize<700 AND ratio<85 AND ratio>15 | eval relay_app=app.\" \".transport.\"-\".dest_port | fields dest_ip, src_ip, relay_app, start_time, duration, bytes | rename dest_ip AS relay_ip, src_ip AS origin_ip, start_time AS origin_start, duration AS origin_duration, bytes AS origin_bytes] | `command_channel_relay_filter` | eval relay_start_epoch=strptime(relay_start,\"%Y/%m/%d %H:%M:%S\"), origin_start_epoch=strptime(origin_start,\"%Y/%m/%d %H:%M:%S\"), relay_stop_epoch=(relay_start_epoch + relay_duration), origin_stop_epoch=(origin_start_epoch + origin_duration) | where relay_start_epoch>=origin_start_epoch AND relay_stop_epoch<origin_stop_epoch AND origin_duration>relay_duration AND origin_bytes>relayed_bytes | table origin_ip, origin_user, relay_ip, relay_app, final_destination, final_app, relayed_bytes, relay_duration, origin_duration, origin_start, relay_start\n","search":"(index=paloaltocdl OR index=paloalto_cn) sourcetype=pan:traffic packets>5 bytes>50000 \n| where (app IN(\"ssh\", \"ms-rdp\", \"telnet\") OR like(app,\"vnc%\")) OR (transport=\"tcp\" AND dest_port IN(\"22\", \"3389\", \"23\", \"5500\", \"5800\", \"5900\")) \n| eval ratio=(bytes_in/bytes * 100) \n| eval avgpktsize=bytes/packets \n| where avgpktsize<700 AND ratio<85 AND ratio>15 \n| eval final_app=app.\" \".transport.\"-\".dest_port \n| fields dest_ip, src_ip, final_app, start_time, duration, bytes, user \n| rename src_ip AS relay_ip, start_time AS relay_start, dest_ip AS final_destination, user AS origin_user, duration AS relay_duration, bytes AS relayed_bytes \n| join relay_ip type=inner max=0 \n    [ search (index=paloaltocdl OR index=paloalto_cn) sourcetype=pan:traffic packets>5 bytes>50000 \n    | where (app IN(\"ssh\", \"ms-rdp\", \"telnet\") OR like(app,\"vnc%\")) OR (transport=\"tcp\" AND dest_port IN(\"22\", \"3389\", \"23\", \"5500\", \"5800\", \"5900\")) \n    | eval ratio=(bytes_in/bytes * 100) \n    | eval avgpktsize=bytes/packets \n    | where avgpktsize<700 AND ratio<85 AND ratio>15 \n    | eval relay_app=app.\" \".transport.\"-\".dest_port \n    | fields dest_ip, src_ip, relay_app, start_time, duration, bytes \n    | rename dest_ip AS relay_ip, src_ip AS origin_ip, start_time AS origin_start, duration AS origin_duration, bytes AS origin_bytes] \n| `command_channel_relay_filter` \n| eval relay_start_epoch=strptime(relay_start,\"%Y/%m/%d %H:%M:%S\"), origin_start_epoch=strptime(origin_start,\"%Y/%m/%d %H:%M:%S\"), relay_stop_epoch=(relay_start_epoch + relay_duration), origin_stop_epoch=(origin_start_epoch + origin_duration) \n| where relay_start_epoch>=origin_start_epoch AND relay_stop_epoch<origin_stop_epoch AND origin_duration>relay_duration AND origin_bytes>relayed_bytes \n| table origin_ip, origin_user, relay_ip, relay_app, final_destination, final_app, relayed_bytes, relay_duration, origin_duration, origin_start, relay_start","dispatch.earliest_time":"-48h","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Command Channel Relay","action.notable.param.rule_description":"$origin_ip$ initiated a command channel to $final_destination$ after relaying through $relay_ip$. This may be because $origin_ip$ is not allowed to connect to $final_destination$, or the user may have attempted to obscure their actual location.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1631026805","updated":"2021-09-07","title":"Threat - AWS Unauthorized AccessKey Creation - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Unauthorized AccessKey Creation","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/24/2021: Created search\n-Author: (Zunyan Yang)\n\n#### Goal\nThis use case looks for AWS CloudTrail events where a user with permission to create access keys makes API calls to create access key for an unknown user. This can be indicative of a privilege escalation attempt, where a new user gains higher level permission than the original user.\n\n#### Categorization\nMITRE ATT&CK: T1586\n\n#### Strategy Abstract\nAWS users with permissions to create keys can be targeted due to their elevated privileges and ability to generate keys. Any instance of keys being generated for unknown users could indicate a compromise.\n\n#### Technical Context\nThis alert detects successful AWS Console key generation message by a user with key generating permissions for another user where the user agent isn’t console.amazonaws.com.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nEvents triggered could indicate an AWS admin legitimately generating a key for another user.\n\n#### Validation\nValidate this alert by checking the AWS account ID where the access key originated from.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nN/A\n","search":"index=aws sourcetype=aws:cloudtrail eventName=CreateAccessKey userAgent!=console.amazonaws.com errorCode=success  | search userIdentity.userName!=requestParameters.userName | stats count by requestParameters.userName eventName aws_account_id awsRegion eventTime","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1631026765","updated":"2021-09-07","title":"Threat - AWS Network Access Controls List Deleted - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Network Access Controls List Deleted","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 9/2/2021: Created search\n-Author: (Zunyan Yang)\n\n#### Goal\nThe goal of this use case is to detect users deleting AWS network ACLs on ingress parameters. \n\n#### Categorization\nMITRE ATT&CK: T1586\n\n#### Strategy Abstract\nAEnforcing network access control is on the of the main defensive mechanisms used by cloud admin to restrict access to a cloud instance. After an attacker gains control of the AWS console by compromising an admin saccount, they can delete network ACls and gain access to the instance from anywhere. \n\n#### Technical Context\nThis alert detects successful deletions of network acl entries on ingress parameters.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nEvents triggered could indicate an AWS admins deleting access control lists for legitimate reasons.\n\n#### Validation\nValidate this alert by checking the AWS ID of the account that performed the deletions and ensure proper request/approval process was followed.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nN/A\n","search":"index=aws sourcetype=aws:cloudtrail eventName=DeleteNetworkAclEntry requestParameters.egress=false\n| stats count by userIdentity.principalId eventName requestParameters.egress src userAgent","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630590389","updated":"2021-09-02","title":"Threat - RR - Detect Outbound SMB Traffic - System - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"RR - Detect Outbound SMB Traffic - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/08/2021: Added ADS documentation\n\n#### Goal\nThis search rule detected outbound SMB connections made by hosts within the network to the Internet.\n\n#### Categorization\nMITRE ATT&CK: T1043\n\n#### Strategy Abstract\nThe search logic is querying data from Network_Traffic datamodel and filter the data for SMB traffic only.\n\n#### Technical Context\nThe correlation search runs hourly, based on data from the start of 65 minutes to 5 minutes in the past. From Network_Traffic datamodel, find the traffic using SMB, exclude the internal IPs and safe IPs, evaluate the risk score for the $src$.\n\n#### Blind Spots and Assumptions\nThis correlation search  assumes that 'cim_Network_Traffic_indexes' events for Network_Traffic datamodel are available and consistent. \n\n#### False Positives\nIf the macros \"`whitelist_internal_ips\" or \"whitelist_zoom_safe_ips\" are not up to date, false positive may be triggered.\n\n#### Validation\nValidate this alert by running the Splunk search based on data from the past 90 days.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nSMB traffic is used for Windows file-sharing activity. One of the techniques often used by attackers involves retrieving the credential hash using an SMB request made to a compromised server controlled by the threat actor.\n---\n\n\n","search":"| tstats summariesonly=true values(All_Traffic.direction) as direction values(All_Traffic.bytes_in) as bytes_in sum(All_Traffic.bytes_out) as bytes_out count from datamodel=\"Network_Traffic\" where All_Traffic.app=\"*SMB*\" AND All_Traffic.app!=\"ms-ds-smb-base\" by \"All_Traffic.app\",\"All_Traffic.src\",\"All_Traffic.dest\",index,sourcetype,_time span=1s\n| `drop_dm_object_name(\"All_Traffic\")`\n| `whitelist_internal_ips(dest)`\n| `whitelist_zoom_safe_ips(dest)`\n| iplocation dest\n| eval search_name=\"RR - Detect Outbound SMB Traffic - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Detect Outbound SMB Traffic from \".src\n| `risk_score_system(src)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"24 * * * *","action.notable.param.rule_title":"Detected Outbound SMB Traffic from system: $src$","action.notable.param.rule_description":"This search rule detected outbound SMB connections made by hosts within the network to the Internet.","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View SMB network traffic from $src$","action.notable.param.drilldown_search":"| from datamodel:\"Network_Traffic\" | search src=$src|s$ app=\"*SMB*\" app!=\"ms-ds-smb-base\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630521521","updated":"2021-09-01","title":"Threat - Zoom - Digital Guardian Custom Policies  - Rule","index":"digital-guardian","datamodel":"N/A","product":"Digital Guardian","action.correlationsearch.label":"Zoom - Digital Guardian Custom Policies","author":"jeng.lee@zoom.us","disabled":"0","description":"","search":"index=digital-guardian dg_alert.dg_name IN (\"DLP - Upload Classified Data to External Site\",\"Zoom Meeting Recording Transfer\",\"DLP - Upload Classified Data to Cloud/Fileshare Site\",\"DLP - Email to External Domains - Classified Data\")","dispatch.earliest_time":"-20m","dispatch.latest_time":"-5m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630437506","updated":"2021-08-31","title":"Endpoint - Crowdstrike Falcon Detection - Rule","index":"crowdstrike","datamodel":"N/A","product":"Crowdstrike EDR","action.correlationsearch.label":"Crowdstrike Falcon Detection","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n-06/09/2021: Added ADS documentation\n-07/09/2021: Suppress low severity detections\n-08/03/2021: Changed search to update severity to CS assigned event.SeverityName.\n\n#### Goal\nCreates notable alerts based on Crowdstrike Falcon detections (https://falcon.crowdstrike.com/activity/detections).\n\n#### Categorization\nMITRE ATT&CK: TA0001, TA0002, TA0003, TA0004, TA0005, TA0007, TA0008, TA0011, TA0010\n\n#### Strategy Abstract\nThe use case creates downstream ES alerts from Crowdstrike detections.\n\n#### Technical Context\nThe use case alert downstream in Splunk from Crowdstrike detections. This searches on the crowdstrike index and specifies the CrowdStrike:Event:Streams:JSON as the source type.\n\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that crwodstrike index events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nAlerts on the CS events can be normal host actions/behaviors.\n\n#### Validation\nValidations of the alert should start from CS events that triggered the alert, and determine whether the event is potentially malicious.\n\n#### Priority\nMedium\n\n#### Response\nThe SOC should first determine whether the CS event triggering the alert is malicious. If so, further investigations/containment of the host might be needed.\n\n#### Additional Resources\nN/A\n---","search":"index=crowdstrike sourcetype=\"CrowdStrike:Event:Streams:JSON\" metadata.eventType=DetectionSummaryEvent event.SeverityName!=\"Low\"  | eval urgency=$event.SeverityName$ | rename event.CommandLine as command event.ParentCommandLine as parent_command event.GrandparentCommandLine as grandparent_command","dispatch.earliest_time":"-6m","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Crowdstrike Falcon Detection - $dest$","action.notable.param.rule_description":"Creates notable alerts based on Crowdstrike Falcon detections (https://falcon.crowdstrike.com/activity/detections).","action.notable.param.security_domain":"endpoint","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View logs in search","action.notable.param.drilldown_search":"index=crowdstrike sourcetype=\"CrowdStrike:Event:Streams:JSON\" metadata.eventType=DetectionSummaryEvent  | eval action= case('event.PatternDispositionValue'== 0, \"allowed\",'event.PatternDispositionValue' == 128,\"allowed\", 'event.PatternDispositionValue' == 272, \"allowed\",'event.PatternDispositionValue' == 768, \"allowed\",'event.PatternDispositionValue' == 1280, \"allowed\",'event.PatternDispositionValue' == 2304, \"allowed\",'event.PatternDispositionValue' == 4638, \"allowed\",'event.PatternDispositionValue'==16,\"blocked\",'event.PatternDispositionValue'==512,\"blocked\", 'event.PatternDispositionValue'==1024,\"blocked\", 'event.PatternDispositionValue'==2048, \"blocked\", 'event.PatternDispositionValue'==2176, \"blocked\", 'event.PatternDispositionValue'==4096, \"blocked\", 'event.PatternDispositionValue'==4112, \"blocked\", 'event.Success'==\"false\", \"failure\", 'event.Success'==\"true\", \"success\")  | eval vendor_product=\"CrowdStrike Falcon\" | eval user=coalesce('event.UserId', 'event.UserName') | rename event.ComputerName as dest, event.Severity as severity_id, event.DetectDescription as subject, event.MachineDomain as dest_nt_domain, event.SHA256String as file_hash, event.DetectId as id, event.ParentCommandLine as parent_process, event.ParentProcessId as parent_process_id, event.ParentImageFileName as parent_process_name, event.ProcessId as process_id, event.SeverityName as severity, event.FileName as file_name, event.FilePath as file_path, event.UserIp as src, event.FalconHostLink as url | search url=$url$","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"dest"}}
{"preview":false,"result":{"updated_time":"1630334051","updated":"2021-08-30","title":"Threat - Detect AWS Console Login From High Severity IP - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"Detect AWS Console Login From High Severity IP","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/30/2021: Added notable trigger (Brendan Chamberlain)\n- 07/01/2021: Official ADS Framework Creation \n\n#### Goal\nDetects an AWS console (management web UI) client connection sourcing from an IP address that ThreatStream has identified as a high severity IOC.\n\n#### Categorization\nMITRE ATT&CK\nName: Account Manipulation\nID: T1098\nReference URL: https://attack.mitre.org/techniques/T1098/\n\nName: Valid Accounts: Cloud Accounts\nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n#### Strategy Abstract\nDetects an AWS console (management web UI) client connection sourcing from an IP address that ThreatStream has identified as a high severity IOC.\n\n### Technical Context\nThe correlation searches aws invents for ConsoleLogin from IP Address in the TS lookup table\n\n#### Blind Spots and Assumptions\nThis search assumes that there are not interruption in event collection.\n\n#### False Positives\nTS Provided an IP Address that has been cleaned up and is not utilized by a Zoom Employee or Support Vendor. \n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=aws sourcetype=\"aws:cloudtrail\" tag=authentication eventName=ConsoleLogin \n| fields user, src, action, severity \n| rename src as src_ip \n| eval severity_lookup=\"high\" \n| lookup ts_lookup_srcip_2 srcip as src_ip severity as severity_lookup OUTPUT severity as ts_severity, itype as threat_source_type, confidence as ts_confidence, source as threat_collection, org as threat_group \n| search ts_severity=high \n| eval threat_description=\"ThreatStream has identified \".src.\" as a \".ts_severity.\" severity IP with \".ts_confidence.\"% confidence.\" \n| fields - severity_lookup, ts*","dispatch.earliest_time":"-20m","dispatch.latest_time":"-5m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"Detect AWS Console Login From High Severity IP - $src_ip$","action.notable.param.rule_description":"Detected an AWS console login from a ThreatStream-defined high severity IP - $src_ip$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"See related AWS logs","action.notable.param.drilldown_search":"index=aws sourcetype=\"aws:cloudtrail\" tag=authentication eventName=ConsoleLogin src=$src_ip$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630330496","updated":"2021-08-30","title":"Network - AWS Instance with SSH/RDP/Telnet Ports Open - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Instance with SSH/RDP/Telnet Ports Open","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/16/2020: Created search\n\n#### Goal\nThe goal of this alert is to detectAWS instances launched with SSH/RDP/Telnet ports open to the internet.\n\n#### Categorization\nMITRE ATT&CK: T1595, T1590, T1020\n\n#### Strategy Abstract\nAWS instances with SSH/RDP/Telnet access pose a security threat to Zoom and should not permitted anywhere.\n\n#### Technical Context\nThis alert detects successful AWS instance with ports 22, 3389, or 23 open to the internet.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nNo known false positives at this time. Any events triggered by this use case should be considered an incident.\n\n#### Validation\nCheck alert details, instance details, security groups, and rules. Determine whether Guarduty alert was triggered, determined user who launched the instance.\n\n#### Priority\nHigh\n\n#### Response\nStep-1: Splunk notable alert received and create ticket in Service now.\nStep-2: Check for the alert details including Instance details, security group and and its rules.\nStep-3: Check for any Guard Duty alerts for the offending instance related to SSH/RDP bruteforce attempts.\nStep-4: Analyse the RDP/SSH audit logs for successful login attempts.\nStep-5: If RDP/SSH login is successful then escalate the incident to IR team else reach out to instance owner or AWS account owner to remediate this Security group issue.\nStep-6: Ask owners for business justification to keep this instance open to the internet.\nStep-7: Update the ticket with all the findings and close it.\n\n#### Additional Resources\nhttps://zoomvideo.atlassian.net/wiki/spaces/IS/pages/2044468796/SOP+-+Security+Group+open+to+the+Internet+RDP+SSH","search":"index=aws sourcetype=\"aws:cloudtrail\" eventName=AuthorizeSecurityGroupIngress (src_ip_range=0.0.0.0*)\n| eval new_field=mvzip(src_ip_range,src_port_range)\n| mvexpand new_field \n| rex field=new_field \"^(?<src_ip_range2>.+)\\,(?<src_port_range2>.+)$\" \n| search src_ip_range2=\"0.0.0.0*\" (src_port_range2=22 OR src_port_range2=23 OR src_port_range2=3389)\n| table _time,dest,src,user,userName,aws_account_id,awsRegion,src_ip_range2,src_port_range2,protocol,userAgent\n| sort -_time","dispatch.earliest_time":"-5h","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"AWS Instance with SSH/RDP/Telnet Ports Open","action.notable.param.rule_description":"The goal of this alert is to detectAWS instances launched with SSH/RDP/Telnet ports open to the internet.","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630098052","updated":"2021-08-27","title":"Access - AWS CloudTrail Tampering - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS CloudTrail Tampering","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/05/2021: Initial Release\n-Tuning to exclude AWSControlTowerExecution \nAuthor: Zunyan Yang\n\n#### Goal\nThe goal of this use case is to detect any attempt to disable or modify the functionalities of CloudTrail.\n\n#### Categorization\nThis use case aligns with TA0005 (Defense Evasion) and TA0003 (Persistence) ATT&CK Techniques.\n\n#### Strategy Abstract\nCurrently AWS CloudTrail data is ingested into Splunk under index=aws and sourcetype=\"aws:cloudtrail\". The use case will correlate IOA event names with CloudTrail's event sources.\n\n#### Technical Context\nThe correlation search filters based on specific eventNames that indicated CloudTrail tampering such as - DeleteTrail - StopLogging - UpdateTrail . The search runs every 6 hours based on data from the last 6 hours.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of AWS CloudTrail data feed.\n\n#### False Positives\nFalse positives is possible but unlikely for this use case as there ins't any valid uses that involves disable or altering CloudTrail, even for testing purposes.\n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days of alert data. It's unlikely that an alert will not trigger within a 7 day range.\n\n#### Priority\nThis alert should be a high severity and should be investigated as soon as possible.\n\n#### Response\n\n-Identify the source account, source IP, AWS instance, and any other relevant information collected from the correlated events\n\n-Perform research on the source IP to identify if it is a Zoom-controlled asset or not, attempt to identify an owner for the host\n\n-Investigate other activity performed by the same IP, user, and account ID over the last 24 hours paying close attention to the events immediately leading up to and following the time of this alert\n\n-Verify if there are any notifications to the SOC, Jira tickets, or other approved communications that this activity would be expected and authorized\n\n-If there is no justification for this activity, document all findings and escalate to Tier 2\n\n#### Splunk Search\n\n```\nindex=aws sourcetype=\"aws:cloudtrail\" eventSource=cloudtrail.amazonaws.com eventName=DeleteTrail OR eventName=StopLogging OR eventName=UpdateTrail | eval user=coalesce(user, userName)\n| fields _time, user, user_type, eventType, eventName, sourceIPAddress, userAgent, aws_account_id\n| stats values(user_type) AS user_category earliest(_time) AS start_time latest(_time) AS end_time count by aws_account_id user eventType sourceIPAddress userAgent\n| fieldformat start_time=strftime(start_time,\"%F %T\")\n| fieldformat end_time=strftime(end_time,\"%F %T\")\n| fillnull value=\"unknown\"\n| sort start_time\n| rename sourceIPAddress as src, userAgent as http_user_agent, eventName as signature\n```\n","search":"index=aws sourcetype=\"aws:cloudtrail\" eventSource=cloudtrail.amazonaws.com eventName=DeleteTrail OR eventName=StopLogging OR eventName=UpdateTrail NOT userIdentity.sessionContext.sessionIssuer.userName=AWSControlTowerExecution | eval user=coalesce(user, userName)\n| fields _time, user, user_type, eventType, eventName, sourceIPAddress, userAgent, aws_account_id, userIdentity.sessionContext.sessionIssuer.userName\n| stats values(user_type) AS user_category earliest(_time) AS start_time latest(_time) AS end_time count by aws_account_id user eventType sourceIPAddress userAgent userIdentity.sessionContext.sessionIssuer.userName\n| fieldformat start_time=strftime(start_time,\"%F %T\")\n| fieldformat end_time=strftime(end_time,\"%F %T\")\n| fillnull value=\"unknown\"\n| sort start_time\n| rename sourceIPAddress as src, userAgent as http_user_agent, eventName as signature, userIdentity.sessionContext.sessionIssuer.userName as session_issuer_username","dispatch.earliest_time":"-70min","dispatch.latest_time":"-10m","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"AWS CloudTrail Tampering","action.notable.param.rule_description":"The goal of this use case is to detect any attempt to disable or modify the functionalities of CloudTrail.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630094435","updated":"2021-08-27","title":"Threat - PRISMA Cloud Alert - Rule","index":"prisma","datamodel":"N/A","product":"Prisma Cloud","action.correlationsearch.label":"PRISMA Cloud Alert","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/27/2021: Per INC0039542, bumped up the brute force alert threshold from 5 to 10 attempts (Brendan Chamberlain)\n- 05/12/2021: Released search\n\n#### Goal\nThe goal of this use case is to reproduce Palo Alto PRISMA-generated cloud alerts in Splunk ES Incident Review for SOC triage and response.\n\n#### Categorization\nThis use case reproduces many PRISMA-specific alerts that aligned with various MITRE ATT&CK Techniques.\n\n#### Strategy Abstract\nPalo Alto PRISMA is currently configured to monitor select AWS account and all of OCI. Several out of the box alerts are configured to detection anomlyous or malicious acitivty occuring within these accounts.\n\n#### Technical Context\nThe correlation search filters based on a subset of PRISMA Policies that were selected by the SOC ([see list in JIRA issue here](https://zoomvideo.atlassian.net/browse/DTCOPS-67)). The search runs every 15 minutes based on data from the last 15 minutes.\n\n#### Blind Spots and Assumptions\nThis search assumes that the PRISMA API and Splunk integration are available, functioning as expected, and alert logs are ingesting within 5 minutes.\n\n#### False Positives\nFalse positives are likely to occur upstream in PRISMA and will need to be tuned by the Detection Team.\n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days of alert data. It's unlikely that an alert will not trigger within a 7 day range.\n\n#### Priority\nThe alerts will be prioritized based on the severity assigned by PRISMA.\n\n#### Response\n**Triage Steps**\n\n1. Triage for this alert will vary depending on the PRISMA detection, similar to Carbon Black or CrowdStrike alerts\n2. Review the detection and validate in the PRISMA console if needed (accessed via Okta tile)\n3. Use Splunk Asset Manager, AWS access, or other tools to identify the affected cloud instance, source/destination hosts, and associated user accounts or IDs\n4. Pivot to any appropriate tools for context and enrichment\n5. If the detection is found to be a true positive (malicious activity detected), document and escalate findings to Tier 2\n\n#### Additional Resources\n- [PRISMA Cloud Console (Okta SSO)](https://app3.prismacloud.io/)\n- [SecOps Engineering Confluence Documentation](https://zoomvideo.atlassian.net/wiki/spaces/IS/pages/1750295196/Prisma+Cloud+Project)","search":"index=prisma sourcetype=prisma `prisma_soc_alerts` NOT (\"message.policyName\"=\"Excessive login failures\" AND \"message.additionalInfo.anomalyDetail.groupedAnomalyCount\"<10) \n| dedup message.alertId \n| fields - sender \n| rename message.policyName as signature, message.policyDescription as desc, id as uid, message.resource.accountId as accountId, message.callbackUrl as url, message.resource.id as resourceId, message.policyRecommendation as note, message.resourceName as resourceName, message.resource.resourceType as resourceType, message.resource.cloudType as cloudType, message.resource.accountId as accountId \n| eval src_user=if(resourceType==\"IAM_USER\" OR resourceType==\"FOREIGN_ENTITY\", resourceName, NULL), src=if(resourceType==\"INSTANCE\" OR resourceType==\"OTHER\", resourceName, NULL), aws_account_id=if(cloudType==\"aws\",accountId,NULL)","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"PRISMA Cloud Alert - $uid$","action.notable.param.rule_description":"$desc$ Follow the URL in the URL field below to view alert in the PRISMA console.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View PRISM alert event log","action.notable.param.drilldown_search":"index=prisma sourcetype=prisma id=$uid$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1630000129","updated":"2021-08-26","title":"Network - Internal Vulnerability Scanner Detected - Rule","index":"N/A","datamodel":"Intrusion_Detection","product":["Aruba Airwave","Palo Alto Networks","Webnginx App Protect"],"action.correlationsearch.label":"Internal Vulnerability Scanner Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/26/2021: Per INC0040013, updated list of vulnerability scanner assets and excluded them in base search (Brendan Chamberlain)\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nDetects a potential internal vulnerability scanner by detecting devices that have triggered events against a large number of unique RFC1918 IP targets. Vulnerability scanners generally trigger events against a high number of unique hosts when they are scanning a network for vulnerable hosts.\n\n#### Categorization\nMITRE ATT&CK\nName: Active Scanning: Vulnerability Scanning\nID: T1595.002\nReference URL: https://attack.mitre.org/techniques/T1595/002/\n\n\n#### Strategy Abstract\nDetects a potential internal vulnerability scanner by detecting devices that have triggered events against a large number of unique RFC1918 IP targets. Vulnerability scanners generally trigger events against a high number of unique hosts when they are scanning a network for vulnerable hosts.\n\n### Technical Context\nThe correlation search pulls from a data model that consist of network edge controls then searches in the data model for internal IP Addresses or the term internal_vulnerability_scanner_detected_filter with a count greater than 5. \n\n#### Blind Spots and Assumptions\nThe data model must provide enough data to ensure the proper ML can be performed on the data. \n\n#### False Positives\nData Model indexed data created by behavior that simulates an internal scanner but is not actually a scanner. \n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nPriority is high\n\n#### Response\n\n#### Additional Resources\n\n---","search":"| tstats summariesonly=true values(IDS_Attacks.tag) as \"tag\", dc(IDS_Attacks.signature) as \"signature_count\", values(IDS_Attacks.signature) as \"signature\", values(IDS_Attacks.action) as \"action\", values(IDS_Attacks.dest) as \"dest\", dc(IDS_Attacks.dest) as \"count\" from datamodel=\"Intrusion_Detection\".\"IDS_Attacks\" where IDS_Attacks.src!=\"0.0.0.0\" IDS_Attacks.action!=\"blocked\" IDS_Attacks.action!=\"dropped\" IDS_Attacks.src_category!=\"scanner\" by \"IDS_Attacks.src\" \n| rename \"IDS_Attacks.src\" as \"src\"\n| search dest=10.0.0.0/8 OR dest=172.16.0.0/16 OR dest=192.168.1.0/24 `internal_vulnerability_scanner_detected_filter` \n| fields - dest \n| where signature_count > 5","dispatch.earliest_time":"-4h","dispatch.latest_time":"now","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"Internal Vulnerability Scanner Detected","action.notable.param.rule_description":"Detects a potential internal vulnerability scanner by detecting devices that have triggered events against a large number of unique RFC1918 IP targets. Vulnerability scanners generally trigger events against a high number of unique hosts when they are scanning a network for vulnerable hosts.","action.notable.param.security_domain":"network","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View vulnerability scanner traffic","action.notable.param.drilldown_search":"| tstats summariesonly=true values(IDS_Attacks.tag) as \"tag\", dc(IDS_Attacks.signature) as \"signature_count\", values(IDS_Attacks.signature) as \"signature\", values(IDS_Attacks.action) as \"action\", values(IDS_Attacks.dest) as \"dest\", dc(IDS_Attacks.dest) as \"count\" from datamodel=\"Intrusion_Detection\".\"IDS_Attacks\" where IDS_Attacks.src!=\"0.0.0.0\" IDS_Attacks.action!=\"blocked\" IDS_Attacks.action!=\"dropped\" by \"IDS_Attacks.src\"  | rename \"IDS_Attacks.src\" as \"src\" | search dest=10.0.0.0/8 OR dest=172.16.0.0/16 OR dest=192.168.1.0/24 src=$src$  | fields - dest  | where signature_count > 5","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"src"}}
{"preview":false,"result":{"updated_time":"1629985048","updated":"2021-08-26","title":"Network - AWS Unrestricted VPC SG Created - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Unrestricted VPC SG Created","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/26/2021: Per INC0039559, changed empty \"uid\" field to \"dest\" to properly display VPC ID and fix drilldown search. (Brendan Chamberlain)\n- 05/12/2021: Released search\n\n#### Goal\nThe goal of this alert is to detect the creation of misconfigured and insecure AWS VPC Security Groups that allow unrestricted inbound access from anywhere (0.0.0.0/0). VPC Security Groups configured in this manner create a risk that external threats may exploit services enabled on the assets associated with it.\n\n#### Categorization\nMITRE ATT&CK: T1190, Initial Access, Exploit Public-Facing Application\nCyber Kill Chain: Exploitation\n\n#### Strategy Abstract\nThis alert relies on AWS CloudTrail audit event logs to detect when a new AWS VPC security group is created. \n\n#### Technical Context\nThe correlation search runs every 15 minutes against data for the last hour and creates a notable for each result. The search throttles on the Security Group ID for 4 hours.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nFalse positives are unlikely to occur.\n\n#### Validation\nTo validate this alert, work with a Security Operations Engineer to create a temporary AWS VPC Security Group that is unrestricted (source 0.0.0.0/0 with all ports allowed inbound).\n\n#### Priority\nHigh\n\n#### Response\nReach out to the Operations team via SOC/Ops Zoom chat and inform them of the misconfigured VPC Security Group. Include details like the AWS Account ID, the VPC Security Group name, and the user who created the group.\n\n#### Additional Resources\n- [AWS Docs - Security groups for your VPC](https://docs.aws.amazon.com/vpc/latest/userguide/VPC_SecurityGroups.html)","search":"index=aws sourcetype=aws:cloudtrail eventCategory=Management eventSource=\"ec2.amazonaws.com\" eventName=AuthorizeSecurityGroupIngress \"requestParameters.ipPermissions.items{}.ipRanges.items{}.cidrIp\"=\"0.0.0.0/0\" NOT requestParameters.ipPermissions.items{}.toPort=*","dispatch.earliest_time":"-1h","dispatch.latest_time":"now","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"AWS Unrestricted VPC SG - $dest$","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"network","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View AWS CloudTrail events","action.notable.param.drilldown_search":"index=aws sourcetype=aws:cloudtrail eventCategory=Management eventSource=\"ec2.amazonaws.com\" eventName=AuthorizeSecurityGroupIngress requestParameters.groupId=$dest$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1629731765","updated":"2021-08-23","title":"Threat - RR - High Volume of Web Activity from High or Critical System - System - Rule","index":"N/A","datamodel":"Web","product":"Zoom Application","action.correlationsearch.label":"RR - High Volume of Web Activity from High or Critical System - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 08/23/2021: Fixed issue of field \"bytes_out\" in data model Web.\n- 07/07/2021: Added ADS documentation.  Field \"bytes_out\" contains only null values. Can't be validated.\n\n#### Goal\nThe goal of this alert is to raise risk score when a system of high or critical severity generates a high volume of outbound web activity. This may indicate that the system has been compromised.\n\n#### Categorization\nMITRE ATT&CK: TA0010, T1102\n\n#### Strategy Abstract\nCurrently data model \"Web\".\"Web\" uses 'cim_Web_indexesindex', i.e. index=corp OR index=zoomapps OR index=paloalto_cn OR index=paloaltocdl OR index=webnginx. The the risk scores are evaluated for the high volume web activity sources.\n\n#### Technical Context\nThis correlation search runs hourly, based on the data from the start of 65 minutes to 5 minutes in the past. It detects high volume web activities if 'bytes_out'>10485760, excluding the IPs if they are internal or in the safe list. Evaluate the risk score by the sources.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, \n\n#### False Positives\nFalse positives may be triggered if the `whitelist_if_both_internal_ips(src,dest)` or  `whitelist_zoom_safe_ips(dest)` macros are not up to date such that some legitimate IPs are not filtered out from the search.\n\n#### Validation\nThis correlation search is validated by excluding condition of (\"Web.src_priority\"=\"high\" OR \"Web.src_priority\"=\"critical\").\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n","search":"| tstats summariesonly=true count sum(Web.bytes_out) as \"bytes_out\" from datamodel=\"Web\".\"Web\" where \"Web.bytes_out\">0 AND (\"Web.src_priority\"=\"high\" OR \"Web.src_priority\"=\"critical\") by \"Web.src\",\"Web.dest\"\n| `drop_dm_object_name(\"Web\")`\n| `whitelist_if_both_internal_ips(src,dest)`\n| `whitelist_zoom_safe_ips(dest)`\n| where 'bytes_out'>10485760\n| eval search_name=\"RR - High Volume of Web Activity from High or Critical System - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"High Volume of Web Activity from \".src.\" to \".dest\n| `risk_score_system(src)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"44 * * * *","action.notable.param.rule_title":"High Volume of Web Activity from $src$ to $dest$","action.notable.param.rule_description":"A large volume of web activity was observed from $src$ to $dest$.","action.notable.param.security_domain":"network","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View web activity involving $src$ to $dest$","action.notable.param.drilldown_search":"| from datamodel:\"Web\".\"Web\" | where 'bytes_out'>0 AND ('src_priority'=\"high\" OR 'src_priority'=\"critical\") AND 'src'=$src|s$ AND 'dest'=$dest|s$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1629729173","updated":"2021-08-23","title":"Threat - RR - Web Uploads to Non-corporate Sites by Users - User - Rule","index":"N/A","datamodel":"Web","product":"Zoom Application","action.correlationsearch.label":"RR - Web Uploads to Non-corporate Sites by Users - User","author":"admin","disabled":"0","description":"#### Release Notes\n- 08/23/2021: Fixed the issue in data model Web. \n- 07/01/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detected  high volume web uploads by user ($user$) to non-corporate domains.\n\n#### Categorization\nMITRE ATT&CK: TA0010\n\n#### Strategy Abstract\nThe high web volume a user upload to non-corporate domains is an indicator of exfiltration. If the volume exceeds a threshold, the user is suspicious. \n\n#### Technical Context\nThe detection is scheduled to run hourly, based on the data from the start of 65 minutes to 5 minutes in the past. Collect the \"$bytes$\" uploaded by \"$user$\" to non-corporate domain from datamodel \"web\". Find the overall mean and standard deviation. If the observed \"bytes\" is greater than mean + 2std, the domain is identified as abnormal.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the \"$bytes$\" field and \"$user$\" field have non-empty data in this data model, while they are actually not available currently.\n\n#### False Positives\nUsing only one hour data as baseline may cause some bias. \n\n#### Validation\nVerified the correlation search by exclude the condition of | search over_2_stds=\"Y\".\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n","search":"| tstats `summariesonly` count values(Web.status) as status, values(Web.app) as app, values(Web.url) as url, sum(Web.bytes) as bytes from datamodel=Web.Web where (Web.http_method=\"POST\" OR Web.http_method=\"PUT\") NOT (`cim_corporate_web_domain_search(\"Web.url\")`) by Web.src, Web.dest, Web.user\n| `drop_dm_object_name(\"Web\")`\n| `whitelist_if_both_internal_ips(src,dest)`\n| `whitelist_zoom_safe_ips(dest)`\n| eventstats avg(bytes) as avg_bytes, stdev(bytes) as stdev_bytes\n| eval over_2_stds=if(bytes>(ROUND((avg_bytes+(2*stdev_bytes)),1)),\"Y\",\"N\")\n| search over_2_stds=\"Y\"\n| search user!=\"unknown\"\n| eval search_name=\"RR - Web Uploads to Non-corporate Sites by Users - User\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Web Uploads to Non-corporate Domains from User (\".user.\")\"\n| `risk_score_user(user)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"51 * * * *","action.notable.param.rule_title":"Web Uploads to Non-corporate Sites by User: $user$","action.notable.param.rule_description":"Detected  high volume web uploads by user ($user$) to non-corporate domains.","action.notable.param.security_domain":"identity","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View web upload activity from user $user$","action.notable.param.drilldown_search":"| from datamodel:\"Web\".\"Web\" | search user=$user$ (http_method=\"POST\" OR http_method=\"PUT\")","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1629314511","updated":"2021-08-18","title":"Access - Zoom: Brute Force Access Behavior Detected for High Value Targets - Rule","index":"N/A","datamodel":"Authentication","product":["Amazon Web Services","Okta","Linux OS","Juniper","Zoom Application"],"action.correlationsearch.label":"Zoom: Brute Force Access Behavior Detected for High Value Targets","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nDetects excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack), looking specifically for user logins associated with high or critical users (high value targets).\n\n#### Categorization\nMITRE ATT&CK\nName: Antivirus/Antimalware\nID: M1049\nReference URL: https://attack.mitre.org/mitigations/M1049\n\n#### Strategy Abstract\nDetects excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack), looking specifically for user logins associated with high or critical users (high value targets).\n\n### Technical Context\nThe correlation searches for  events related to Authentication from the Authentication data model getting counts of success and failure Authentications.\nIf the failure count and success count is greater than zero, the data is piped into the app:failures_by_src_count_1h data model. \n\n#### Blind Spots and Assumptions\nThe correlation search assume that there is no interruption in event collection. \n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is High \n\n#### Response\n\n#### Additional Resources\n---","search":"| tstats `summariesonly` values(Authentication.tag) as tag, values(Authentication.app) as app, values(Authentication.user_category) as user_category, values(Authentication.user_priority) as user_priority, count from datamodel=\"Authentication\" where Authentication.user_priority IN (\"high\",\"critical\") by Authentication.src, Authentication.action, Authentication.user\n| `drop_dm_object_name(\"Authentication\")`\n| eval failure=if(action=\"failure\",count,null()), success=if(action=\"success\",count,null())\n| stats values(tag) as tag, values(user_category) as user_category, values(user_priority) as user_priority, values(app) as app, max(failure) as failure, max(success) as success by src, user\n| search success>0 failure>0\n| `mltk_apply_upper(\"app:failures_by_src_count_1h\", \"high\", \"failure\")`","dispatch.earliest_time":"-70m@m","dispatch.latest_time":"now","cron_schedule":"03,08,13,18,23,28,33,38,43,48,53,58 * * * *","action.notable.param.rule_title":"Brute Force Access Behavior Detected For High Value Target User ($user$)","action.notable.param.rule_description":"Detected excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack), looking specifically for user logins associated with high or critical users (high value targets).","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View all login attempts by user $user$","action.notable.param.drilldown_search":"| from datamodel:\"Authentication\".\"Authentication\" | search user=\"$user$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1629295668","updated":"2021-08-18","title":"Threat - User Reported Phishing Message - Rule","index":"proofpoint","datamodel":"N/A","product":["Proofpoint Digital Risk","Proofpoint Email","Proofpoint Targeted Attack Protection (TAP)"],"action.correlationsearch.label":"User Reported Phishing Message","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/18/2021: Per tuning request INC0041101, updated subsearch to include only messages sent from @zoom.us domain and excluded discarded messages.\n- 05/05/2021: Update cron settings to run every 5 minutes per INC0039258.\n- 04/27/2021: Enabled search.\n\n#### Goal\nThe goal of this alert is to centralize, enrich, and track user reported phishing messages in Splunk ES as notable events.\n\n#### Categorization\nMITRE ATT&CK: T1566, T1566.001, T1566.002, T1566.003\n\n#### Strategy Abstract\nPhishing is a technique commonly used by attackers to gain unauthorized access to valid user accounts or to drop malicious payloads on endpoints in an attempt to gain a foothold in an organization's environment. While preventative controls exist that filter a large majority of malicious phishig messages, the control is not 100% effective. To detect unblocked phishing messages, we must rely heavily on end user reported phishing messages.\n\n#### Technical Context\nThis search first runs a stats command to retreive all messages delivered in the last 24 hours. Next, an append search adds the last 20 minutes of user reported phishing messages. The two searches are combined in attempt to provide additional context like the malicious sender and the full list of receipients. The search is then filtered on user reported phishing messages where the row contains src_user (reporting user). In some cases, the parent search will not provide additional context, for example, when a user reports a phishing message that was received > 24 hours ago. More detail can be found in the drilldown search which runs a similar search on the subject line looking back 7 days by default. Notables will be throttled based on the subject line of the user reported phishing message for 8 hours to reduce duplicate alerts. \n\n#### Blind Spots and Assumptions\nThis alert relies on end user awareness to identify and report a phishing message. It will only be as effective as our end users' best judgement. This alert also assumes that ProofPoint message logs are timely (lag < 5 minutes) and available.\n\n#### False Positives\nUsers will likely report messages that do not pose a threat to the organization that include newsletter/marketing emails, system generated messages, or internally/externally distributed mass email campaigns.\n\n#### Validation\nThis search can be validated by running the base search and changing the \"earliest\" field criteria from -25m@m to -72h@h in the subsearch. This should return rows that show user reported phishing messages.\n\n#### Priority\nMedium\n\n#### Response\nSOC triage/response playbooks are documented here: \n\n- [https://docs.google.com/document/d/1cXP2Q800Cmv_zcf3-nJ6U3U7tAHsuQTAsvvSR_kq4NE/](https://docs.google.com/document/d/1cXP2Q800Cmv_zcf3-nJ6U3U7tAHsuQTAsvvSR_kq4NE/)\n- [https://docs.google.com/document/d/1YC4Ytzi8mlSZpKDoa4tc3hHTzVe7bfNdnlK-oki1W4A](https://docs.google.com/document/d/1YC4Ytzi8mlSZpKDoa4tc3hHTzVe7bfNdnlK-oki1W4A)\n\n#### Additional Resources\n- [ProofPoint Targeted Attack Prevention (TAP) Console](https://threatinsight.proofpoint.com/)\n- [ProofPoint Threat Response (TRAP) Console](https://threatresponse.sec.corp.zoom.us/)\n- [ProofPoint Splunk Data Source](https://zoomvideo.atlassian.net/wiki/spaces/IS/pages/1600104307/Splunk+ES+Data+Sources#Proofpoint-Email)\n\nh/t Ku Masomere for providing base search logic.","search":"index=proofpoint sourcetype=pps_messagelog NOT subject=\"\" \n| rename \"msg.normalizedHeader.subject{}\" as subject, envelope.rcpts{} as recipient, msg.parsedAddresses.from{} as sender \n| eval pretty_time=strftime(_time, \"%m/%d/%Y %I:%M:%S %p\") \n| stats earliest(pretty_time) as start_time latest(pretty_time) as end_time values(sender) as sender values(recipient) as recipient by subject \n| append \n    [ search index=proofpoint sourcetype=pps_messagelog \"envelope.rcpts{}\"=\"phishing@zoom.us\" \"msg.parsedAddresses.from{}\"=*zoom.us NOT \"msg.parsedAddresses.from{}\"=\"phishing*@zoom.us\" NOT final_action=discard earliest=-25m@m latest=-5m@m \n    | rename \"msg.normalizedHeader.subject{}\" as subject, envelope.rcpts{} as recipient, \"msg.parsedAddresses.from{}\" as src_user \n    | dedup message_id \n    | eval action=if(isnull(mvfind(subject, \"Reported\")), \"forwarded\", \"button\"), subject=if(action==\"forwarded\", replace(subject, \"FW: \", \"\"), subject), subject=if(action==\"forwarded\", replace(subject, \"Fwd: \", \"\"), subject), subject=if(action==\"forwarded\", replace(subject, \"Re: \", \"\"), subject), subject=if(action==\"forwarded\", replace(subject, \"RE: \", \"\"), subject), subject=if(action==\"button\", replace(subject, \"\\[Reported Phish\\] \", \"\"), subject), url_query=replace(src_user, \"@\", \"%40\"), url=\"https://threatresponse.sec.corp.zoom.us/search?q=\".url_query, url_query2=replace(src_user, \"@\", \"%40\"), url2=\"https://threatinsight.proofpoint.com/3542def0-64ef-01c6-9912-90c2bd32ca07/search?d=a&p=1&ps=200&searchQuery=\".url_query2.\"&sortBy=threat-burden&sortOrder=desc&t=6&type=PEOPLE\", url=mvappend(url, url2) \n    | `user_reported_phishing_message_filter` \n    | table _time, src_user, subject, url, message_id, action] \n| stats values(start_time) as start_time values(end_time) as end_time values(src_user) as src_user, values(url) as url, values(message_id) as message_id, values(action) as action, values(recipient) as recipient, values(sender) as sender, values(desc) as desc by subject \n| eval desc=\"The user \".src_user.\" reported a phishing message with the subject line \\\"\".subject.\"\\\". Proofpoint TAP and TRAP linked below in URL field.\" \n| fillnull value=\"Unknown\" recipient, sender, start_time, end_time \n| search src_user=*","dispatch.earliest_time":"-25min","dispatch.latest_time":"-5min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"User Reported Phishing Message - \"$subject$\"","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View all messages with this subject","action.notable.param.drilldown_search":"index=proofpoint sourcetype=pps_messagelog  | rename \"msg.normalizedHeader.subject{}\" as subject, envelope.rcpts{} as recipient, msg.parsedAddresses.from{} as sender | eval pretty_time=strftime(_time, \"%m/%d/%Y %I:%M:%S %p\") | search subject=\"$subject$\" | stats earliest(pretty_time) as start_time latest(pretty_time) as end_time values(sender) as sender values(recipient) as recipient by subject","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628605650","updated":"2021-08-10","title":"Threat - Proofpoint TAP Malicious Attachment Detected - Rule","index":"proofpoint","datamodel":"N/A","product":["Proofpoint Digital Risk","Proofpoint Email","Proofpoint Targeted Attack Protection (TAP)"],"action.correlationsearch.label":"Proofpoint TAP Malicious Attachment Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n**Date:** 03/23/2021\n**Created by:** Brendan Chamberlain\n\n- 03/26/2021: Added quotes around transaction_id field to fix drilldown search. \n- 03/23/2021: Created search\n\n#### Goal\nThe overall goal of this alert is to detect, drive a rapid response, and minimize the impact caused by a user who has received an email with a malicious attachment.\n\n#### Categorization\nATT&CK: T1566, T1078, T1204\n\n#### Strategy Abstract\nThis search is keying on events that match field/value of  \"threatsInfoMap{}.threatType\"=attachment and eventType=messagesDelivered in the Proofpoint TAP index/sourcetype. Enrichment is performed upstream in Proofpoint which has retroactively determined that a user received a message with a malicious attachment that was not blocked. False positives are very unlikely.\n\n#### Technical Context\nProofpoint Targeted Attack Protection (TAP) is responsible for blocking and detecting email threats destined to Zoom users. TAP will retroactively analyze previous message attachments against new intel. TAP console is here: https://threatinsight.proofpoint.com/\n\n#### Blind Spots and Assumptions\nProofpoint TAP only inspects email that is routed through Proofpoint MTAs. This will not inspect email received through any other third party services or email routed through separate infrastructure.\n\n#### False Positives\nFalse positives are very unlikely for this alert. Any false positives occur upstream in Proofpoint TAP and will be caused by inaccurate intel sourcing from Proofpoint. False positives can be ruled out during the analysis of attachments.\n\n#### Validation\nGive the reliance on Proofpoint intel, this control cannot be easily validated.\n\n#### Priority\nHigh\n\n#### Response\nThe alert should be further analyzed in ProofPoint TAP to understand the intent of the malicious payload. The endpoint of the recipient in question should be investigated for malicious activity related to execution of payload. If you determine the payload was executed, the incident should be escalated appropriately.\n\n#### Additional Resources\n- Email logs are contained in the index=proofpoint sourcetype=pps_messagelog. \n- More info can be found in [TAP support docs here](https://help.proofpoint.com/Threat_Insight_Dashboard/Product_Documentation/Threat_and_Campaign_Activity)\n\n","search":"index=proofpoint sourcetype=proofpoint_tap_siem \"threatsInfoMap{}.threatType\"=attachment eventType=messagesDelivered NOT senderIP=127.0.0.1 \n| dedup messageID \n| stats latest(_time) as _time values(senderIP) as src, values(sender) as sender, values(\"recipient{}\") as recipient, values(subject) as subject, values(eventType) as action, values(messageParts{}.filename) as file_name values(threatsInfoMap{}.threatUrl) as url by messageID\n| rename messageID as transaction_id\n| eval file_name=mvfilter(NOT (match(file_name,\"text.html\") OR match(file_name,\"text.txt\"))), signature=\"Attachment Defense Alert\", desc=\"A message containing a malicious attachment has been delivered to an end user.\"","dispatch.earliest_time":"-10m","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Malicious Attachment Detected - $recipient$","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View TAP logs","action.notable.param.drilldown_search":"index=proofpoint sourcetype=proofpoint_tap_siem \"threatsInfoMap{}.threatType\"=attachment eventType=messagesDelivered NOT senderIP=127.0.0.1 messageID=\"$transaction_id$\"","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"recipient"}}
{"preview":false,"result":{"updated_time":"1628546470","updated":"2021-08-09","title":"Threat - Zoom Intel Match Detected - Rule","index":"threatstream_summary","datamodel":"N/A","product":"Threatstream","action.correlationsearch.label":"Zoom Intel Match Detected","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n**Date:** 08/09/2021\n**Created by:** Matt DeVries\n- Jira: https://zoomvideo.atlassian.net/browse/DTCOPS-319?atlOrigin=eyJpIjoiZjEyZmIwMjhiOWQ2NDBmNzk0NDg0NmRmYTlkYWM5YmYiLCJwIjoiaiJ9\n\n#### Goal\nThe goal of this use case is to detect all IOC matches provided to us by the threat intel team.\n\n#### Categorization\nMITRE ATT&CK\nName: NA\nID: NA\nReference URL: NA\n\n#### Strategy Abstract\nCurrently uses matching based on multiple event feeds from within Splunk.\n\n#### Technical Context\nThe correlation search looks for any IOC matches where the tag contains **Zoom_Analyst_Import**.  Once a match occurrs, the notable alert will be sent to the SOC for investigation.\n\n#### Blind Spots and Assumptions\nThis search assumes that we are collecting IOC's from ThreatStream and that there is no interruption of data sent to Splunk.  This also assumes that we are collecting all traffic from known zoom devices to monitor.\n\n#### False Positives\nPotential false positive based on old or stale intel or incorrect traffic direction based on single IP/Domain/URL matching.  \n\n#### Validation\nThe correlation search can be validated by running the search directly over the last 30 days to determine if any matches took place.\n\n#### Priority\nThis alert should be high severity.\n\n#### Response\n1. Investigate the IPs, user-agent strings, operating systems, geolocations, and device types in use for each detected session for the user\n2. Perform OSINT and contextual analysis on the IPs, user-agent strings, or any other relevant discovered IOCs to determine reputation\n3. Perform a 7-day search on user/device to determine normal behavior and expected devices for them\n5. Determine any other users that have been associated with the same IP/Host over the last 14 days\n6. Document findings and escalate to Tier 2\n\n#### Additional Resources\n\n---","search":"index=threatstream_summary\n| fillnull whitelisted_at_match value=\"no\" \n| search whitelisted_at_match=\"no\" \n| eval indicator=coalesce('event.indicator', indicator, 'event.ts_lookup_key_value',ts_lookup_key_value) \n| fields - event.indicator \n| eval indicator = if(match(indicator, \";\"), split(indicator, \";\"), indicator) \n| foreach event.ts_* \n    [ eval <<FIELD>>=if(match('<<FIELD>>', \";\"), split('<<FIELD>>', \";\"),'<<FIELD>>')] \n| eval event.ts_confidence = max('event.ts_confidence') \n| eval event.ts_date_last = max(strptime('event.ts_date_last', \"%Y-%m-%dT%T\")) \n| eval event.victim=case( 'event.ts_type'=\"ip\" OR 'event.ts_type'=\"domain\", \n    if(indicator='event.src','event.dest', 'event.src'),'event.ts_type'=\"email\", \n    if(indicator='event.src_user','event.recipient', 'event.src_user'),'event.ts_type'=\"url\", \n    if(indicator='event.src', 'event.dest', 'event.src') , 'event.ts_type'=\"md5\", 'event.src' ) \n| eval event.ts_severity = case('event.ts_severity'=\"very-high\", \"very-high\",'event.ts_severity'=\"high\",\"high\",'event.ts_severity'=\"medium\",\"medium\",'event.ts_severity'=\"low\",\"low\",'event.ts_severity'=\"very-low\",\"very-low\") \n| convert mktime(event_time)\n| eval Age = floor(abs(event_time - 'event.ts_date_last')/3600/24) \n| rename event.* AS * \n| rename ts_* as *\n| search detail=*Zoom_Analyst_Import*\n| table _time, Age, confidence, sourcetype, host, victim, indicator, type, itype, src, dest, detail","dispatch.earliest_time":"-120m@m","dispatch.latest_time":"-60m@m","cron_schedule":"45 */1 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628537638","updated":"2021-08-09","title":"Access - S3 CRM Bucket Access to Customer Data - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"S3 CRM Bucket Access to Customer Data","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/21/2021: Created search\n\n#### Goal\nThe goal of this alert is to detect unauthorized access of CMR customer recording data in AWS S3 objects.\n\n#### Categorization\nMITRE ATT&CK: T1078.001, T1078.003, T1123, T1567.002\n\n#### Strategy Abstract\nAWS CMR customer recordings data access should be restricted to authorized service accounts and account that were temporarily grated permissions. Any individual users should not have access and if detected should be investigated promptly. \n\n#### Technical Context\nThis alert detects successful AWS S3 access via console or command line from accounts not on a pre-approved list. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS index and eventSource=\"s3.amazonaws.com\" events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nPotential false positives triggered would include users accessing S3 buckets with proper request/approval from an account not previously added to the allowlist.\n\n#### Validation\nValidate this alert by running the Splunk search without the office, vpn, AWS workspace exclusions, and the where speed>=85 filter. Results should display based on users who have logged in from home and office/vpn IP addresses.\n\n#### Priority\nHigh\n\n#### Response\n\n\n#### Additional Resources\nN/A","search":"index=aws eventSource=\"s3.amazonaws.com\" eventCategory=Data \"userIdentity.userName\"!=CMR_SVR \"userIdentity.userName\"!=XMPP_File_Nginx  \"userIdentity.userName\"!=cmr_user \"userIdentity.userName\"!=get-recording  \"userIdentity.userName\"!=op_user \"userIdentity.userName\"!=command_user \"userIdentity.userName\"!=zoom-aisense \"assumed-role\"!=\"cmr-object-delete-LambdaRole-1DHUUITHFF9PI/cmr-object-delete-LambdaFunc-1RTXBA6O5209W\"  \"assumed-role\"!=\"cmr-object-delete-LambdaRole-1MQ0BCH21PHY0/cmr-object-delete-LambdaFunc-MA1YU0N29MIM\"  \"assumed-role\"!=\"cmr-object-delete-eu01-LambdaRole-LDJE0PSSMT5V/cmr-object-delete-eu01-LambdaFunc-MO5VZWSGUKKD\" \"assumed-role\"!=\"cmr-object-delete-us-east-1-LambdaRole-ALDB99XAYPLP/cmr-object-delete-us-east-1-LambdaFunc-42WV15CINHPG\" \"assumed-role\"!=\"cmr-object-delete-us-west-1-LambdaRole-D716WYS7NTX4/cmr-object-delete-us-west-1-LambdaFunc-1FMUK07YZX46B\" \"eventName\"!=HeadBucket \"errorCode\"!=AccessDenied","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"S3 CRM Bucket Access to Customer Data","action.notable.param.rule_description":"The goal of this alert is to detect unauthorized access of CMR customer recording data in AWS S3 objects.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628535782","updated":"2021-08-09","title":"Threat - Venafi TLS Events - Rule","index":"venafi","datamodel":"N/A","product":"Venafi","action.correlationsearch.label":"Venafi TLS Events","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/22/2021: Created search (Zunyan Yang)\n\n#### Goal\nThe goal of this use case is to detect any suspicious events occurring in the Venafi TLS code signing environment and alert the PKI team.\n\n#### Categorization\nMITRE ATT&CK: T1098.001, T1212\n\n#### Strategy Abstract\nVenafi’s TLS code signing environment should have restricted access and any unauthorized or unknown access should be monitored and alerted on.\n\n#### Technical Context\nThis alert detects a number of event_id deemed by the code signing team as events of interest. It searches against the index=venafi sourcetype=venafiapplog for specific event_ids that corresponds to potential malicious activities.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that index=venafi sourcetype=venafiapplog is available, consistent, and ingesting in a timely manner (< 10 minute delay). \n\n#### False Positives\nPotential false positives include authorized Amin activity.\n\n#### Validation\nValidate this alert by running the search agains the event_id and determine which user had performed the activity corresponding to the event_id.\n\n#### Priority\nHigh\n\n#### Response\nCurrently correlation is set to alert the code signing team. Once SOC has proper response procedure notables will be turned on.\n\n#### Additional Resources\nN/A","search":"index=venafi sourcetype=venafiapplog [ | inputlookup venafi_tls_events.csv | fields event_id ]","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628533866","updated":"2021-08-09","title":"Endpoint - Crowdstrike Falcon Incident - Rule","index":"crowdstrike","datamodel":"N/A","product":"Crowdstrike EDR","action.correlationsearch.label":"Crowdstrike Falcon Incident","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n-06/09/2021: Added ADS documentation\n- 2/19/2021: Fixed and normalized the severity field\n\n\n#### Goal\nAlerts on Crowdstrike-identified incidents (https://falcon.crowdstrike.com/crowdscore/incidents)\n\n#### Categorization\nMITRE ATT&CK: TA0001, TA0002, TA0003, TA0004, TA0005, TA0007, TA0008, TA0011, TA0010\n\n#### Strategy Abstract\nThe use case creates downstream ES alerts from Crowdstrike incidents.\n\n#### Technical Context\nThe use case alert downstream in Splunk from Crowdstrike incidents. This searches on the crowdstrike index and specifies the metadata.eventType\"=incidentsummaryevent .\n\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that crwodstrike index events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nDetections on the CS events can be normal host actions/behaviors.\n\n#### Validation\nValidations of the alert should start from CS events that triggered the alert, and determine whether the incident is true positive.\n\n#### Priority\nMedium\n\n#### Response\nThe SOC should first determine whether the CS event triggering the alert is malicious. If so, further investigations/containment of the host might be needed.\n\n#### Additional Resources\nN/A","search":"index=crowdstrike \"metadata.eventType\"=incidentsummaryevent \n| rename event.FineScore as cs_severity \n| eval cs_severity=mvindex(split(cs_severity,\".\"),0)\n| eval severity=case(cs_severity<4,\"low\",cs_severity>3 AND cs_severity<7,\"medium\", cs_severity>6 AND cs_severity<9, \"high\", cs_severity>8, \"critical\")\n| eval desc=\"New Crowdstrike incident with a \".severity.\" severity has been opened. Follow this URL for more details in CrowdStrike: \".url \n| table _time, url, desc, severity","dispatch.earliest_time":"-20m","dispatch.latest_time":"-5m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"New $severity$ severity Crowdstrike Falcon Incident","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"endpoint","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View Crowdstrike Incident Log Entry","action.notable.param.drilldown_search":"index=crowdstrike \"metadata.eventType\"=incidentsummaryevent url=$url$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628531279","updated":"2021-08-09","title":"Threat - RR - Prohibited Port Activity Detected - System - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"RR - Prohibited Port Activity Detected - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/02/2021: Added ADS documentation\n- 08/09/2021 fix the issue of the missing fields \"$src$\" and \"$dest$\" by adding these fields to the by clause\n\n#### Goal\nThe goal of this alert is to detect the use of ports that are prohibited. \n\n#### Categorization\nMITRE ATT&CK: TA0003\n\n#### Strategy Abstract\nFinding the use of prohibited port can help to detect the installation of new software or a successful compromise of a host (such as the presence of a backdoor or a system communicating with a botnet). \n\n#### Technical Context\nThe correlation search runs every half hour, based on the data from the start of 35 minutes to 5 minutes in the past. Search from datamodel \"Network_Traffic\" from (index=corp OR index=paloalto OR index=aws OR index=aruba_cn) and find the event using prohibited port. Exclude the port if it is internal or if it is in the safe list.   \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that data model Network_Traffic (index=corp OR index=paloalto OR index=aws OR index=aruba_cn) events are available and consistent.\n\n#### False Positives\nIf the marcros `whitelist_if_both_internal_ips(src,dest)`\nand `whitelist_zoom_safe_ips(dest)` are not up to data, false positives may be triggered.\n\n#### Validation\nN/A. The correlation search can be validated based on 7 days of data in the past.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n######\n","search":"| tstats `summariesonly` count from datamodel=Network_Traffic where nodename=All_Traffic.Traffic_By_Action.Allowed_Traffic by index, sourcetype, All_Traffic.dest_port, All_Traffic.dvc, All_Traffic.transport, All_Traffic.action, All_Traffic.src, All_Traffic.dest\n| `drop_dm_object_name(\"All_Traffic\")`\n| `is_traffic_prohibited(dest_port)`\n| search dest_port>0 NOT is_prohibited=false\n| stats sum(count) as count by dvc,src,dest,transport,dest_port,is_prohibited,index,sourcetype\n| `whitelist_if_both_internal_ips(src,dest)`\n| `whitelist_zoom_safe_ips(dest)`\n| eval search_name=\"RR - Prohibited Port Activity Detected - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Prohibited Port Activity Detected (\".transport.\"/\".dest_port.\" from \".src.\" on \".dvc.\")\"\n| `risk_score_system(src)`","dispatch.earliest_time":"-35m@m","dispatch.latest_time":"-5m@m","cron_schedule":"16,46 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628175405","updated":"2021-08-05","title":"Threat - Privileged Access in Jenkins DevOps environment - Rule","index":"jenkins","datamodel":"N/A","product":"Jenkins","action.correlationsearch.label":"Privileged Access in Jenkins DevOps environment","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 08/05/2021: Created search (Zunyan Yang)\n\n#### Goal\nThe goal of this alert is to detect unauthorized use of privileged privileged admin account in the Jenkins integration and delivery servers used by Deveops.\n\n#### Categorization\nMITRE ATT&CK: T1078: Valid Accounts\n\n#### Strategy Abstract\nJenkins admin access should be restricted to valid and approved users only. Any instance of unauthorized access to the environment could lead to Zoom’s source code compromise.\n\n#### Technical Context\nThis alert detects successful actions performed bu privileged admin users that is not part of a pre-approved list.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that Jenkins events are available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\n#### False Positives\nAny events of admin access should be promptly investigated, instances of false positives can occur when new admin accounts are created and granted access.\n\n#### Validation\nValidate this alert by running the Splunk search against the admin user-ID and ensure the user has the proper permissions to access the Jenkins environment.\n\n#### Priority\nHigh\n\n#### Response\nAt time of creation any notables triggered will be sent directly to the engineering R&D team for validation.\n\n#### Additional Resources\nN/A","search":"index=jenkins user=\"admin\" job_result!=\"FAILURE\" user_identity_id!=\"5edea36727c0843deb149fa5\"","dispatch.earliest_time":"-6m","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1628165316","updated":"2021-08-05","title":"Threat - Gitlab Abnormally High Count of Projects Pulled via Git - Rule","index":"gitlab","datamodel":"N/A","product":"Gitlab","action.correlationsearch.label":"Gitlab Abnormally High Count of Projects Pulled via Git","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nDetects when a user is observed downloading an unusually high number of distinct project/repositories via the Git shell utility. Could indicate the collection and staging of source code for exfiltration.\n\n#### Categorization\nMITRE ATT&CK\nName: Data Staged: Local Data Staging\nID: T1074.001\nReference URL: https://attack.mitre.org/techniques/T1074/001/\n\n\n#### Strategy Abstract\nDetects when a user is observed downloading an unusually high number of distinct project/repositories via the Git shell utility. Could indicate the collection and staging of source code for exfiltration.\n\n### Technical Context\nThe correlation searches gitlab events for shell downloads by user and baselines the average downloads finding a match when the user exceeds 4 STDevs of downloads from their 7 day average downloads. \n\n#### Blind Spots and Assumptions\nThis search assumes that there are not intruption in event collection.\n\n#### False Positives\nUser has new business requiring the download of gitlab content that exceeds their average 7 day download. \n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nUser risk analysis is set to 10 \nPriority is medium\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=gitlab source=\"/var/log/gitlab/gitlab-rails/api_json.log\" ua=\"GitLab-Shell\"\n| rename params{}.key as key params{}.value as value\n| eval key0=mvindex(key,0), key1=mvindex(key,1), key2=mvindex(key,2), key3=mvindex(key,3), key4=mvindex(key,4), key5=mvindex(key,5)\n| eval {key0}=mvindex(value,0), {key1}=mvindex(value,1), {key2}=mvindex(value,2), {key3}=mvindex(value,3), {key4}=mvindex(value,4), {key5}=mvindex(value,5)\n| search action=\"git-upload-pack\"\n| bucket span=1h _time\n| stats values(meta.project) as projects dc(meta.project) as projects_count count by meta.user, check_ip, _time\n| eventstats avg(projects_count) as projects_pulled_avg, stdev(projects_count) as projects_pulled_stdev\n| eval threshold_value = 4\n| eval isOutlier=if(projects_count > projects_pulled_avg+(projects_pulled_stdev * threshold_value), 1, 0)\n| search isOutlier=1 AND _time >= relative_time(now(), \"-60m@m\")\n| eval num_standard_deviations_away = round(abs(projects_count - projects_pulled_avg) / projects_pulled_stdev, 2)\n| rename meta.user as user, check_ip as src_ip\n| search `gitlab_abnormally_high_projects_pulled_via_git_filter`\n| eval desc=\"User \\\"\".user.\"\\\" pulled \".projects_count.\" Gitlab project repos in the span of 1 hour.\"\n| table _time, user, src_ip, desc, projects_pulled_avg, projects_pulled_stdev, num_standard_deviations_away","dispatch.earliest_time":"-7d","dispatch.latest_time":"now","cron_schedule":"52 * * * *","action.notable.param.rule_title":"Gitlab Abnormally High Count of Projects Pulled via Git","action.notable.param.rule_description":"Detects when a user is observed downloading an unusually high number of distinct project/repositories via the Git shell utility. Could indicate the collection and staging of source code for exfiltration.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related log entries","action.notable.param.drilldown_search":"index=gitlab source=\"/var/log/gitlab/gitlab-rails/api_json.log\" ua=\"GitLab-Shell\"  | rename params{}.key as key params{}.value as value  | eval key0=mvindex(key,0), key1=mvindex(key,1), key2=mvindex(key,2), key3=mvindex(key,3), key4=mvindex(key,4), key5=mvindex(key,5)  | eval {key0}=mvindex(value,0), {key1}=mvindex(value,1), {key2}=mvindex(value,2), {key3}=mvindex(value,3), {key4}=mvindex(value,4), {key5}=mvindex(value,5)  | search action=\"git-upload-pack\"  | rename meta.user as user, check_ip as src_ip | search user=$user$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"10","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1628101230","updated":"2021-08-04","title":"Threat - Gitlab Abnormally High Project Downloads via Web - Rule","index":"gitlab","datamodel":"N/A","product":"Gitlab","action.correlationsearch.label":"Gitlab Abnormally High Project Downloads via Web","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nDetects when a user is observed downloading an unusually high number of distinct project/repositories via the Gitlab web user interface. Could indicate the collection and staging of source code for exfiltration.\n\n#### Categorization\nMITRE ATT&CK\nName: Data Staged: Local Data Staging\nID: T1074.001\nReference URL: https://attack.mitre.org/techniques/T1074/001/\n\n\n#### Strategy Abstract\nDetects when a user is observed downloading an unusually high number of distinct project/repositories via the Gitlab web user interface. Could indicate the collection and staging of source code for exfiltration.\n\n### Technical Context\nThe correlation searches gitlab events for Repository downloads by user and baselines the average downloads finding a match when the user exceeds 2 STDevs of downloads from their 7 day average downloads. \n\n#### Blind Spots and Assumptions\nThis search assumes that there are not intruption in event collection.\n\n#### False Positives\nUser has new business requiring the download of gitlab content that exceeds their average 7 day download. \n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nUser risk analysis is set to 20 \nPriority is medium\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=gitlab custom_message=\"Repository Download Started\" source=\"/var/log/gitlab/gitlab-rails/audit_json.log\"\n| rename author_name as user, ip_address as src_ip\n| bucket span=1h _time \n| stats dc(target_details) as downloads by user, src_ip, _time\n| eventstats avg(downloads) as downloads_avg, stdev(downloads) as downloads_stdev \n| eval threshold_value = 2 \n| eval isOutlier=if(downloads > downloads_avg+(downloads_stdev * threshold_value), 1, 0) \n| search isOutlier=1 AND _time >= relative_time(now(), \"-70m@m\")\n| eval num_standard_deviations_away = round(abs(downloads - downloads_avg) / downloads_stdev, 2)\n| eval desc=\"The user \\\"\".user.\"\\\" manually downloaded \".downloads.\" repositories in an hour via the Github website.\"\n| table _time, user, src_ip, desc, downloads, downloads_avg, downloads_stdev, num_standard_deviations_away","dispatch.earliest_time":"-7d","dispatch.latest_time":"now","cron_schedule":"43 * * * *","action.notable.param.rule_title":"Gitlab Abnormally High Count of Project Downloads via Web","action.notable.param.rule_description":"Detects when a user is observed downloading an unusually high number of distinct project/repositories via the Gitlab web user interface. Could indicate the collection and staging of source code for exfiltration.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related log entries","action.notable.param.drilldown_search":"index=gitlab custom_message=\"Repository Download Started\" source=\"/var/log/gitlab/gitlab-rails/audit_json.log\" | rename author_name as user, ip_address as src_ip | search user=$user src_ip=$src_ip$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"25","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1627915273","updated":"2021-08-02","title":"Threat - Venafi Code Signing Events - Rule","index":"venafi","datamodel":"N/A","product":"Venafi","action.correlationsearch.label":"Venafi Code Signing Events","author":"zunyan.yang@zoom.us","disabled":"0","description":"Release Notes\n07/6/2021: Created search (Zunyan Yang)\n\nGoal\nThe goal of this use case is to detect any suspicious events occurring in the Venafi  code signing environment and alert the PKI team.\n\nCategorization\nMITRE ATT&CK: T1098.001, T1212\n\nStrategy Abstract\nVenafi’s code signing environment should have restricted access and any unauthorized or unknown access should be monitored and alerted on.\n\nTechnical Context\nThis alert detects a number of event_id deemed by the code signing team as events of interest. It searches against the index=venafi sourcetype=venafiapplog for specific event_ids that corresponds to potential malicious activities.\n\nBlind Spots and Assumptions\nThis correlation search assumes that index=venafi sourcetype=venafiapplog is available, consistent, and ingesting in a timely manner (< 10 minute delay).\n\nFalse Positives\nPotential false positives include authorized Amin activity.\n\nValidation\nValidate this alert by running the search agains the event_id and determine which user had performed the activity corresponding to the event_id.\n\nPriority\nHigh\n\nResponse\nCurrently correlation is set to alert the code signing team. Once SOC has proper response procedure notables will be turned on.\n\nAdditional Resources\nN/A\n\n","search":"index=venafi sourcetype=venafiapplog [ | inputlookup venafi_cs_events.csv | fields event_id ]","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1627647412","updated":"2021-07-30","title":"Threat - OP Access Control - Rule","index":"op","datamodel":"N/A","product":"Zoom Operation","action.correlationsearch.label":"OP Access Control","author":"zunyan.yang@zoom.us","disabled":"0","description":"Report for activity performed against OP environment.","search":"index=op sourcetype=opaudit action=\"addOPUser\" OR action=\"editOPUser\" OR action=\"updateOPUserStatus\" OR action=\"resetOPUserPassword\" OR action=\"resetOPUserGoogleAuth\" OR action=\"deleteOPUser\" OR action=\"unlockOPUser\" OR action=\"approveSuperAdmin\" OR action=\"createOPRole\" OR action=\"editOPRole\" OR action=\"deleteOPRole\" OR action=\"createOPPermission\" OR action=\"importOPPermissions\" OR action=\"editOPPermission\" OR action=\"deleteOPPermission\" OR action=\"addRolePermissionMapping\" OR action=\"removeRolePermissionMapping\" OR action=\"saveOPUserPwdRule\" OR action=\"saveOPSessionExpiryTime\" OR action=\"saveOPUserLockRule\" | stats count by action,  opEmail","dispatch.earliest_time":"-7d","dispatch.latest_time":"-10m","cron_schedule":"0 2 * * 5","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1627409725","updated":"2021-07-27","title":"Threat - Cloud Scanning/Exfiltration Tools Detected - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"Cloud Scanning/Exfiltration Tools Detected","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/27/2021: Created search\n\n#### Goal\nThe goal of this alert is to detect the usage of CyberDuck (an open source file transfer applications via FTP/SFTP) or Scout Suite (an open source cloud scanning tool).\n\n#### Categorization\nMITRE ATT&CK: T1595.002, T1041\n\n#### Strategy Abstract\nCyberDuck and ScotSuite were both used by the team during the last campaign. Currently no detection in place for usage of these tools. Any events detected not performed by the red team should be viewed as an incident.\n\n#### Technical Context\nThis alert detects any usage of CyberDuck or ScoutSuite agents within Zoom’s AWS environment and lists the specific signatures detected. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS  events are available, consistent, and ingesting in a timely manner (< 10 minute delay). \n\n#### False Positives\nEvents detected can be from the red team conducting pentests. \n\n#### Validation\nValidate this alert by running the Splunk search and determining whether the AWS ID belongs to a member of Zoom’s red team. \n\n#### Priority\nHigh\n\n#### Response\nNotables should immediately investigated to confirm whether it originated from the red team. If not an incident should be opened and further containment action should be taken promptly. There should be no legitimate use of these tools within Zoom’s environment outside of penitests.\n\n#### Additional Resources\nhttps://cyberduck.io/\nhttps://github.com/nccgroup/ScoutSuite","search":"index=aws userAgent=\"Cyberduck*\" OR userAgent=\"*Scout Suite*\" | stats count by signature, src | sort -count signature, src","dispatch.earliest_time":"-6min","dispatch.latest_time":"-1min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Cloud Scanning/Exfiltration Tools Detected","action.notable.param.rule_description":"#### Release Notes - 07/27/2021: Created search  #### Goal The goal of this alert is to detect the usage of CyberDuck (an open source file transfer applications via FTP/SFTP) or Scout Suite (an open source cloud scanning tool).  #### Categorization MITRE ATT&CK: T1595.002, T1041  #### Strategy Abstract CyberDuck and ScotSuite were both used by the team during the last campaign. Currently no detection in place for usage of these tools. Any events detected not performed by the red team should be viewed as an incident.  #### Technical Context This alert detects any usage of CyberDuck or ScoutSuite agents within Zoom’s AWS environment and lists the specific signatures detected.   #### Blind Spots and Assumptions This correlation search assumes that AWS  events are available, consistent, and ingesting in a timely manner (< 10 minute delay).   #### False Positives Events detected can be from the red team conducting pentests.   #### Validation Validate this alert by running the Splunk search and determining whether the AWS ID belongs to a member of Zoom’s red team.   #### Priority High  #### Response Notables should immediately investigated to confirm whether it originated from the red team. If not an incident should be opened and further containment action should be taken promptly. There should be no legitimate use of these tools within Zoom’s environment outside of penitests.  #### Additional Resources https://cyberduck.io/ https://github.com/nccgroup/ScoutSuite","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1627328789","updated":"2021-07-26","title":"Threat - Zoom - Solarwinds Supply Chain IOC Detected - Rule","index":"threatstream_summary","datamodel":"N/A","product":"Threatstream","action.correlationsearch.label":"Zoom - Solarwinds Supply Chain IOC Detected","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nDetects when any IOC related to the Solarwinds Supply chain attack has been detected on the network using ThreatStream IOC matching.\n\n#### Categorization\n\n#### Strategy Abstract\nDetects when any IOC related to the Solarwinds Supply chain attack has been detected on the network using ThreatStream IOC matching.\n\n### Technical Context\nThe correlation searches for ThreatStream events that contain SolarWindds in the event.ts_detail field. \n \n#### Blind Spots and Assumptions\nThe correlation search assume that there is no interruption in event collection. \n\n#### False Positives\n\n#### Validation\n\n#### Priority\nSrc System Risk is set to 50\nPriority is High \n\n#### Response\n\n#### Additional Resources\n---","search":"index=threatstream_summary\n| fillnull whitelisted_at_match value=\"no\" \n| search whitelisted_at_match=\"no\" \n| eval indicator=coalesce('event.indicator', indicator, 'event.ts_lookup_key_value',ts_lookup_key_value) \n| fields - event.indicator \n| eval indicator = if(match(indicator, \";\"), split(indicator, \";\"), indicator) \n| foreach event.ts_* \n    [ eval <<FIELD>>=if(match('<<FIELD>>', \";\"), split('<<FIELD>>', \";\"),'<<FIELD>>')] \n| eval event.ts_confidence = max('event.ts_confidence') \n| eval event.ts_date_last = max(strptime('event.ts_date_last', \"%Y-%m-%dT%T\")) \n| eval event.victim=case( 'event.ts_type'=\"ip\" OR 'event.ts_type'=\"domain\", if(indicator='event.src','event.dest', 'event.src'),'event.ts_type'=\"email\", if(indicator='event.src_user','event.recipient', 'event.src_user'),'event.ts_type'=\"url\", if(indicator='event.src', 'event.dest', 'event.src') , 'event.ts_type'=\"md5\", 'event.src' ) \n| eval event.ts_severity = case('event.ts_severity'=\"very-high\", \"very-high\",'event.ts_severity'=\"high\",\"high\",'event.ts_severity'=\"medium\",\"medium\",'event.ts_severity'=\"low\",\"low\",'event.ts_severity'=\"very-low\",\"very-low\") \n| convert mktime(event_time) \n| eval Age = floor(abs(event_time - 'event.ts_date_last')/3600/24) \n| search event.ts_detail=\"*SolarWinds Supply Chain Compromise*\"\n| rename event.* AS * \n| table sourcetype, host, ts_detail, source, victim, indicator, ts_itype, src, dest\n| rename ts_itype AS itype","dispatch.earliest_time":"-120m@m","dispatch.latest_time":"-60m@m","cron_schedule":"45 */1 * * *","action.notable.param.rule_title":"Zoom - Solarwinds Supply Chain IOC: $itype$ match detected from $victim$","action.notable.param.rule_description":"High Priority Match based on Solarwinds Supply Chain IOC's: $indicator$ with itype: $itype$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View raw logs associated with $indicator$","action.notable.param.drilldown_search":"`drilldown_filter` sourcetype=$orig_sourcetype$ $indicator$ $victim$ host=$orig_host$  `drilldown_match`","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"src"}}
{"preview":false,"result":{"updated_time":"1626988377","updated":"2021-07-22","title":"Identity - Zoom: Activity from Deprovisioned User Identity - Rule","index":"N/A","datamodel":"Authentication","product":["Amazon Web Services","Okta","Linux OS","Juniper","Zoom Application"],"action.correlationsearch.label":"Zoom: Activity from Deprovisioned User Identity","author":"admin","disabled":"0","description":"Alerts when an event is discovered from a user associated with identity that is now expired (that is, the end date of the identity has been passed) or status is deprovisioned.","search":"| tstats `summariesonly` count, max(_time) as lastTime, values(Authentication.action) as action, values(Authentication.user_category) as user_category, values(Authentication.src) as src, values(Authentication.dest) as dest from datamodel=Authentication where Authentication.user_category=\"*STATUS_deprovisioned*\" by Authentication.user\n| `drop_dm_object_name(\"Authentication\")`\n| lookup simple_identity_lookup identity as user OUTPUTNEW endDate as user_endDate\n| eval lastTime=strftime(lastTime,\"%Y-%m-%d %T\")\n| rename count as auth_events_count, lastTime as last_auth_event_time\n| table last_auth_event_time, user_endDate, user, auth_events_count, action, src, dest, user_category","dispatch.earliest_time":"-30m@m","dispatch.latest_time":"now","cron_schedule":"03,08,13,18,23,28,33,38,43,48,53,58 * * * *","action.notable.param.rule_title":"Activity from Deprovisioned User Identity ($user$)","action.notable.param.rule_description":"Activity from a deprovisioned identity was observed. This is indicative of activity from a user whose access should have been disabled.","action.notable.param.security_domain":"identity","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View activity from $user$","action.notable.param.drilldown_search":"| from datamodel:\"Identity_Management\".\"Expired_Identity_Activity\" | search (user=$user|s$ OR src_user=$user|s$)","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"80","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1626985453","updated":"2021-07-22","title":"Threat - RR - Host With Multiple Infections - System - Rule","index":"N/A","datamodel":"Malware","product":"Sophos AV","action.correlationsearch.label":"RR - Host With Multiple Infections - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/06/2021: Added ADS documentation\n\n#### Goal\nThe goal of this search is to raise risk score when a host with multiple infections is discovered. \n\n#### Categorization\nMITRE ATT&CK:\n\n#### Strategy Abstract\nFrom \"Malware\".\"Malware_Attacks\" datamodel, look for the $dest$ which  has more than one malwares on.\n\n#### Technical Context\nThis correlation search runs hourly, based on the data from the start of 245 minutes to 5 minutes in the past. From \"Malware\".\"Malware_Attacks\" datamodel, find the number of the malware in the $dest$, collect the signatures, file_path and action. If there are more than one malware found for the $dest$ within 4 hours, alert is triggered. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events for \"Malware\".\"Malware_Attacks\" datamodel are available and consistent \n\n#### False Positives\nIf the \"Malware\".\"Malware_Attacks\" datamodel produces some false positives, the false positive alerts will be triggered for this correlation search.\n\n#### Validation\nValidate this alert by running the Splunk search based on the data from 1 year in the past.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nN/A\n","search":"| tstats summariesonly=true dc(Malware_Attacks.signature) as count, values(Malware_Attacks.signature) as signature, values(Malware_Attacks.file_path) as file_path, values(Malware_Attacks.action) as action from datamodel=\"Malware\".\"Malware_Attacks\"   by \"Malware_Attacks.dest\" | rename \"Malware_Attacks.dest\" as \"dest\" | where 'count'>1\n| eval search_name=\"RR - Host With Multiple Infections - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Host With Multiple Infections (\".dest.\")\"\n| `risk_score_system(dest)`","dispatch.earliest_time":"-245m@m","dispatch.latest_time":"-5m@m","cron_schedule":"07 * * * *","action.notable.param.rule_title":"Host With Multiple Infections ($dest$)","action.notable.param.rule_description":"The device $dest$ was detected with multiple ($infection_count$) infections.","action.notable.param.security_domain":"endpoint","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View all infection events associated with device $dest$","action.notable.param.drilldown_search":"| from datamodel:\"Malware\".\"Malware_Attacks\" | search dest=\"$dest$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626884351","updated":"2021-07-21","title":"Threat - RR - Protocol or Port Mismatch - System - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"RR - Protocol or Port Mismatch - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/02/2021: Added ADS documentation\n\n#### Goal\nThe goal of this search is to look for network traffic on common ports where a higher layer protocol does not match the port that is being used. For example, this search should identify cases where protocols other than HTTP are running on TCP port 80. \n\n#### Categorization\nMITRE ATT&CK: T1571\n\n#### Strategy Abstract\nThis correlation search can be used by attackers to circumvent firewall restrictions, or as an attempt to hide malicious communications over ports and protocols that are typically allowed and not well inspected.\n\n#### Technical Context\nThe correlation searches is scheduled to run hourly, based on the data from the start of 65 minutes to 5 minutes in the past. Compare the protocol and port from \"Network_Traffic\" datamodel to those from \"interesting_ports_lookup\" table to collect the mismatched ones. Exclude the ones which are internal or in the safe list. Create the risk score based on the dest_ip. Alert if the output is not empty. \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Network_Traffic datamodel events and the \"interesting_ports_lookup\" table is up to date.\n\n#### False Positives\nFalse Positives can be triggered if \"interesting_ports_lookup\", \"whitelist_zoom_safe_ips\",  \"whitelist_if_both_internal_ips\" tables are not up to date.\n\n#### Validation\nThe correlation search can be validated by running the search over a 1 hour time range.\n\n#### Priority\nThis alert should be medium severity.\n\n#### Response\n\n#### Additional Resources\nN/A\n\n\n\n\n","search":"| tstats `summariesonly` count min(_time) as firstTime max(_time) as lastTime values(All_Traffic.protocol) as protocol values(All_Traffic.action) as action from datamodel=Network_Traffic where All_Traffic.app IN (dns,ssh,smtp) by All_Traffic.src_ip, All_Traffic.dest_ip, All_Traffic.app,All_Traffic.dest_port \n| `drop_dm_object_name(\"All_Traffic\")`\n| search NOT [|inputlookup interesting_ports_lookup | fields app,dest_port | format]\n| `whitelist_if_both_internal_ips(src_ip,dest_ip)`\n| `whitelist_zoom_safe_ips(dest_ip)`\n| convert ctime(firstTime) \n| convert ctime(lastTime)\n| eval search_name=\"RR - Protocol or Port Mismatch - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Protocol (\".protocol.\") or Port (\".dest_port.\") Mismatch\"\n| `risk_score_system(dest_ip)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"17 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626485544","updated":"2021-07-16","title":"Threat - Threat - High Confidence Threat Bulletin Matches - Rule - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"Threat - High Confidence Threat Bulletin Matches - Rule","author":"suyog.zambre@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/16/2021: Added ADS documentation\n\n#### Goal\nThe goal of this correlation search is to create alerts on Threat Bulletin related matches from threatstream.\n\n#### Categorization\nMITRE ATT&CK: This use case aligns with almost all MITRE ATT&CK Technique.\n\n#### Strategy Abstract\nThe use case will correlate Threat Bulletin with ThreatStream IOC matching.\n\n#### Technical Context\nThis correlation search runs hourly, based on data from the start of 120 minutes to 60 minutes in the past. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events are available and consistent and our ThreatStream IOC feed has been curated.\n\n#### False Positives\nFalse positives of this use case would be rare.\n\n#### Validation\nThe correlation search can be validated based on the data from 60 minutes in the past. \n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n","search":"`ioc_match_display(\"tipreport\", \"has_tipreport=hard min_confidence=80\", \"event.ts_tipreport=* AND event.ts_confidence>=80\")` \n| rename event.* AS * \n| stats count values(sourcetype) values(source) values(src) values(dest) values(indicator) values(ts_itype) by ts_tipreport, host, victim\n| lookup tm_tipreport id AS ts_tipreport OUTPUT name \n| rename ts_tipreport AS tipreport, values(sourcetype) AS sourcetype, values(source) AS source, values(src) AS src, values(dest) AS dest, values(indicator) AS indicator, values(ts_itype) AS itype","dispatch.earliest_time":"-120m@m","dispatch.latest_time":"-60m@m","cron_schedule":"45 */1 * * *","action.notable.param.rule_title":"Threat Bulletin:$name$ match detected","action.notable.param.rule_description":"Indicator: $indicator$ match related to Threat Bulletin:$name$ detected","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View raw logs associated with $indicator$","action.notable.param.drilldown_search":"`drilldown_filter` sourcetype=$orig_sourcetype$ $indicator$ $victim$ host=$orig_host$  `drilldown_match`","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"5","action.risk.param._risk_object":"victim"}}
{"preview":false,"result":{"updated_time":"1626485515","updated":"2021-07-16","title":"Threat - Threat - High Confidence Actor Matches - Rule - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"Threat - High Confidence Actor Matches - Rule","author":"suyog.zambre@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/16/2021: Added ADS documentation\n\n#### Goal\nThe goal of this correlation search is to alert on actor related matches from threatstream.\n\n#### Categorization\nMITRE ATT&CK: This use case aligns with almost all MITRE ATT&CK Technique.\n\n#### Strategy Abstract\nThe use case will correlate actors with ThreatStream IOC matching. \n\n#### Technical Context\nThis correlation search runs hourly, based on data from the start of 120 minutes to 60 minutes in the past. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events are available and consistent.\n\n#### False Positives\nFalse positives of this use case would be rare.\n\n#### Validation\nThe correlation search can be validated based on the data from 90 days in the past and our ThreatStream IOC feed has been curated.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n\n\n\n\n","search":"`ioc_match_display(\"actor\", \"has_actor=hard min_confidence=80\", \"event.ts_actor=* AND event.ts_confidence>=80\")` \n| rename event.* AS * \n| stats values(sourcetype) values(source) values(ts_itype) values(ts_actor) values(src) values(dest) by indicator, host, victim\n| lookup tm_actor id AS values(ts_actor) OUTPUT name \n| rename values(sourcetype) AS sourcetype, values(source) AS source, values(ts_itype) as ts_itype, values(ts_actor) AS actor, values(src) AS src, values(dest) AS dest","dispatch.earliest_time":"-120m@m","dispatch.latest_time":"-60m@m","cron_schedule":"45 */1 * * *","action.notable.param.rule_title":"Threat Actor:$name$ match detected","action.notable.param.rule_description":"Indicator: $indicator$ match related to Actor:$name$ detected","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View raw logs associated with $indicator$","action.notable.param.drilldown_search":"`drilldown_filter` sourcetype=$orig_sourcetype$ $indicator$ $victim$ host=$orig_host$  `drilldown_match`","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"5","action.risk.param._risk_object":"victim"}}
{"preview":false,"result":{"updated_time":"1626482857","updated":"2021-07-16","title":"Threat - Short-lived Okta Account Detected - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Short-lived Okta Account Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/16/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect when an Okta account is created and deleted within a 1 hour timespan.\n\n#### Categorization\nMITRE ATT&CK: T1550\n\n#### Strategy Abstract\nCurrently OKTA data is ingested into Splunk under index=okta. \n\n#### Technical Context\nThis correlation search runs hourly, based on data from the start of 70 minutes to 10 minutes in the past. It filters based on eventType=user.lifecycle.create OR eventType=user.lifecycle.delete.initiated and command_count > 1.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events of okta index are available and consistent.\n\n#### False Positives\nFalse positives of this use case would be rare.\n\n#### Validation\nThe correlation search can be validated without the constraints of \"(eventType=user.lifecycle.create OR eventType=user.lifecycle.delete.initiated) \" and \"| where command_count > 1\" based on the past 4 hours of data.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n\n\n\n\n","search":"index=okta tag=change tag=account (eventType=user.lifecycle.create OR eventType=user.lifecycle.delete.initiated) \n| bucket span=60m _time \n| stats values(command) as commands dc(command) as command_count first(eventType) as first_command by _time, target{}.alternateId, user\n| search first_command=\"user.lifecycle.create\"\n| where command_count > 1\n| rename target{}.alternateId as target_user\n| eval desc=user.\" created and deleted account \\\"\".target_user.\"\\\" within an hour.\"\n| table _time, user, desc","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m","cron_schedule":"35 * * * *","action.notable.param.rule_title":"Short-lived Okta Account Detected","action.notable.param.rule_description":"Detects when an Okta account is created and deleted within a 1 hour timespan.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related Okta log entries","action.notable.param.drilldown_search":"index=okta tag=change tag=account (eventType=user.lifecycle.create OR eventType=user.lifecycle.delete.initiated) user=$user$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626477294","updated":"2021-07-16","title":"Access - Zoom - Break the glass account use - Rule","index":"asa","datamodel":"N/A","product":"Okta Advanced Secure Access","action.correlationsearch.label":"Zoom - Break the glass account use","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/14/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect whenever users \"bill\", \"billl\", or \"break-glass\" are used to access our servers through okta ASA.\n\n#### Categorization\nMITRE ATT&CK: TA0001\n\n#### Strategy Abstract\nA break glass account is an account that is used for emergency purposes to gain access to a system or service that is not accessible under normal controls. Need to document all of break glass accounts and regularly audit those accounts to ensure that the correct people have access.\n\n#### Technical Context\nThis correlation search runs every 5 minutes, based on data from the start of 65 minutes to 5 minutes in the past. From \"asa\" index, look for the user name, desthost, srcip and destip. Filter the data if user name is \"bill\", billl\", or \"break-glass\".\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events of asa index are consistent.\n\n#### False Positives\nFalse positives of this use case would be rare.\n\n#### Validation\nThe correlation search can be validated based on data from past 90 days. \n\n#### Priority\nHigh\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n\n","search":"index=asa\n| rename details.unix_user_name as user\n| rename details.type as logintype\n| rename details.server.hostname as desthost\n| rename details.from_address as srcip\n| rename details.server.access_address as destip\n| search user=\"bill\" OR user=\"billl\" OR user=\"break-glass\"\n| eval desc=\"The Break-glass account (\".user.\") is being used on \".desthost.\" from \".srcip.\".\"\n| table _time, user, srcip, desthost, destip, desc","dispatch.earliest_time":"-65m","dispatch.latest_time":"-5m","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Zoom - Break the glass account use","action.notable.param.rule_description":"Detects whenever users \"bill, billl, or break-glass\" are used to access our servers through okta ASA.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"index=asa search details.unix_user_name=$user$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1626476962","updated":"2021-07-16","title":"Threat - SSH Bruteforce Activity Detected - Rule","index":"N/A","datamodel":"Authentication","product":["Amazon Web Services","Okta","Linux OS","Juniper","Zoom Application"],"action.correlationsearch.label":"SSH Bruteforce Activity Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/16/2021: Added ADS documentation\n- 2/25/2021: Added ATT&CK mapping (T1110)\n- 2/24/2021: Per tuning request, raising the minimum number of failed requests from 5 to 25. \n\n#### Goal\nThe goal of this correlation search is to detects SSH bruteforce activity based on authentication data in the Authentication.Failed_Authentication dataset.\n\n#### Categorization\nMITRE ATT&CK: T1110\n\n#### Strategy Abstract\nThe correlation search likely indicate of a server with the SSH service open to the internet. May also indicate an internal host that is compromised.\n\n#### Technical Context\nThis correlation search runs every hour, based on data from the 7 days in the past, stats are group by hourly. From \"Authentication\" data model, calculate the total number of failed attempts, then use the mean+/-1std method over the past 7 days to determine the outlier in the number of failed attempts in past 1 hour.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that events for Authentication data are available and consistent.\n\n#### False Positives\nMacro \"ssh_bruteforce_activity_detected_filter\" need to be up to date. \n\n#### Validation\nValidate this alert by running the Splunk search without the filter of AND Authentication.action=failure AND Authentication.src_category!=\"scanner\". \n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n","search":"| tstats count AS total_failed_attempts values(Authentication.dest_category) as dest_category values(Authentication.user) as user dc(Authentication.user) as failed_users_count values(Authentication.src) as src dc(Authentication.src) as sources_count FROM datamodel=Authentication WHERE Authentication.app=sshd AND Authentication.action=failure AND Authentication.src_category!=\"scanner\" GROUPBY Authentication.dest _time span=1h | search NOT src IN (204.141.28.129,204.141.30.129,173.231.80.32,173.231.80.254,173.231.80.253,173.231.84.254,173.231.84.243,173.231.84.32,52.70.99.96)\n| `drop_dm_object_name(Authentication)`\n| `ssh_bruteforce_activity_detected_filter`\n| eventstats avg(total_failed_attempts) as avg_failed_attempts, stdev(total_failed_attempts) as stdev_failed_attempts by dest\n| eval threshold_value=1\n| eval isOutlier=if(total_failed_attempts > avg_failed_attempts+(stdev_failed_attempts * threshold_value), 1, 0)\n| where isOutlier=1 AND _time>=relative_time(now(), \"-1h@h\") AND total_failed_attempts > 25\n| eval mitre_technique=\"T1110\", desc=\"Detected an abnormally high number (\".total_failed_attempts.\") of failed SSH authentication attempts sourcing from \".failed_users_count.\" user(s) over an hour on host \".dest.\".\"\n| table _time, src, dest, dest_category, user, mitre_technique, desc","dispatch.earliest_time":"-7d","dispatch.latest_time":"now","cron_schedule":"0 * * * *","action.notable.param.rule_title":"SSH Bruteforce Activity Detected - $dest$","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View related failed authentication logs","action.notable.param.drilldown_search":"| from datamodel:\"Authentication.Failed_Authentication\" | search app=sshd dest=$dest$","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"dest"}}
{"preview":false,"result":{"updated_time":"1626464841","updated":"2021-07-16","title":"Threat - Zoom - FireEye Red Team IOC Detected - Rule","index":"threatstream_summary","datamodel":"N/A","product":"Threatstream","action.correlationsearch.label":"Zoom - FireEye Red Team IOC Detected","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 2/11/2021: Fixed search to exclude scanning activity where the threat indicator is the source. This will now only alert when traffic is observed outbound to an indicator in question.\n\n#### Goal\nDetects when any IOC related to red team testing has been detected on the network using ThreatStream IOC matching.\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nDetects when any IOC related to red team testing has been detected on the network using ThreatStream IOC matching.\n\n### Technical Context\nThe correlation searches for threatstream_summary where the event.ts_detail is *FireEye Red Team Tool Countermeasures*\n\n#### Blind Spots and Assumptions\nThe correlation search assume that there is no interruption in event collection. \n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is High \nSystem Risk is set to 50 \n\n\n#### Response\n\n#### Additional Resources\n---","search":"index=threatstream_summary whitelisted_at_match=\"no\" event.ts_detail=\"*FireEye Red Team Tool Countermeasures*\" `filter_threatstream_src_ip`\n| fillnull whitelisted_at_match value=\"no\" \n| search whitelisted_at_match=\"no\" \n| rename event.* AS * \n| eval threat_match_value=indicator \n| eval threat_match_field=if(src=threat_match_value,\"src\",\"dest\") \n| where threat_match_field!=\"src\"\n| eval threat_description=ts_detail \n| eval threat_source_type=split(ts_source, \";\")\n| stats max(_time) as _time values(src) as src values(dest) as dest values(threat_description) as threat_description values(threat_source_type) as threat_source_type values(sourcetype) as orig_sourcetype values(ts_itype) as itype values(threat_match_field) by threat_match_value","dispatch.earliest_time":"-120m@m","dispatch.latest_time":"-60m@m","cron_schedule":"45 */1 * * *","action.notable.param.rule_title":"Zoom - FireEye Red Team IOC: $itype$ match detected from $threat_match_value$","action.notable.param.rule_description":"High Priority Match based on FireEye Red Team IOC's: $threat_match_value$ with itype: $itype$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View raw logs associated with $indicator$","action.notable.param.drilldown_search":"`drilldown_filter` sourcetype=$orig_sourcetype$ src=$src$ AND dest IN ($dest$)","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"src"}}
{"preview":false,"result":{"updated_time":"1626463093","updated":"2021-07-16","title":"Access - Zoom - HIPAA Control 2 (Access to UnEncrypted File) - Rule","index":"cimtrak","datamodel":"N/A","product":"Cimtrak","action.correlationsearch.label":"Zoom - HIPAA Control 2 (Access to UnEncrypted File)","author":"suyog.zambre@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- Pre 07/01/2021 - Revised search to group based on device/user where file read/writes are occurring over 5 minute timespan.\n\n#### Goal\nZoom - HIPAA Control (Access to UnEncrypted File) As per HIPAA control, no user should have access to these files except zoom app,\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nZoom - HIPAA Control (Access to UnEncrypted File) As per HIPAA control, no user should have access to these files except zoom app,\n\n### Technical Context\nThe correlation searches for cimtrak events for logs containing specific file paths performed by user not being whitelisted. \n\n#### Blind Spots and Assumptions\nThe correlation search assume that there is no interruption in event collection. \n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is Critical \n\n\n#### Response\n\n#### Additional Resources\n---","search":"index=cimtrak (filePath=\"/opt/ssb/cmr-archive*\" OR filePath=\"/opt/ssb/rmsg-home*\" OR filePath=\"/opt/ssb/mrt-home*\" OR filePath=\"/opt/ssb/mra-home*\") suser!=\"Owner: zoomapp\" AND suser!=\"root\" AND suser!=zoomapp AND filePath!=*.rmsg AND suser!=zoomapp AND suser!=oktajenkins AND suser!=oktatele AND suser!=oktadeploy (neuid!=\"zabbix\" AND deviceProcessName!=\"/usr/bin/find\") AND (neuid!=\"zoomapp\" AND suser!=\"robinsonl\") \n| rename suser as user filePath as object cim_event_type as action shost as dest\n| stats values(object) as file_path values(action) as action by src, dest, user","dispatch.earliest_time":"-8m","dispatch.latest_time":"-3m","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Access to unencrypted file detected 2 (HIPAA control)","action.notable.param.rule_description":"As per HIPAA compliance, we are alerting on any access to unencrypted recording file","action.notable.param.security_domain":"access","action.notable.param.severity":"critical","action.notable.param.drilldown_name":"Access to unencrypted file detected (HIPAA control)","action.notable.param.drilldown_search":"index=cimtrak (filePath=\"/opt/ssb/cmr-archive*\" OR filePath=\"/opt/ssb/rmsg-home*\" OR filePath=\"/opt/ssb/mrt-home*\" OR filePath=\"/opt/ssb/mra-home*\") suser!=\"Owner: zoomapp\" AND suser!=\"root\" AND suser!=zoomapp AND filePath!=*.rmsg AND suser!=zoomapp AND suser!=oktajenkins AND suser!=oktatele AND suser!=oktadeploy (neuid!=\"zabbix\" AND deviceProcessName!=\"/usr/bin/find\") AND (neuid!=\"zoomapp\" AND suser!=\"robinsonl\") | rename suser as user filePath as object cim_event_type as action | search user=$user$ object=$object$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626391077","updated":"2021-07-15","title":"Threat - Undocumented Index Detected - Rule","index":"*","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"Undocumented Index Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/15/2021: Added ADS documentation\n\n#### Goal\nThe goal of this correlation search is to search for new and/or undocumented data sources by index/sourcetype. Notifies Detection team via email. Data sources are documented in the \"es_products_lookup\" lookup table.\n\n#### Categorization\nMITRE ATT&CK: TA0005, TA0010, TA0040\n\n#### Strategy Abstract\nNew and/or undocumented data sources can help with investigating the anomalies.\n\n#### Technical Context\nThis correlation search runs every day, based on data from the 24 hours in the past. Find out the events if field product=\"Undocumented\" AND count > 50 from any index.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events are consistent.\n\n#### False Positives\nFalse positives of this use case would be rare.\n\n#### Validation\nThe correlation search can be validated based on data from the 24 hours in the past. \n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n\n","search":"| tstats count WHERE index=* by index sourcetype\n| lookup es_products_lookup Index as index sourcetype as sourcetype OUTPUT sourcetype as doc_st, product\n| search NOT (index=cim_modactions OR index=*_summary OR index=risk OR index=threat_activity OR index=notable OR index=oci OR sourcetype=stash OR sourcetype=*too_small OR index=os)\n| fillnull product value=\"Undocumented\"\n| where product=\"Undocumented\" AND count > 50\n| eval search_query=\"index=\".index.\" sourcetype=\".sourcetype\n| table index, sourcetype, search_query, count","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"0 7 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626388354","updated":"2021-07-15","title":"Threat - User Risk From Multiple Sources 24 Hours - Rule","index":"risk","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"User Risk From Multiple Sources 24 Hours","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/14/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect when a Splunk user object is assigned more than 1 source of risk in the last 24 hours. \n\n#### Categorization\nMITRE ATT&CK: This use case aligns with the almost all MITRE ATT&CK Techniques.\n\n#### Strategy Abstract\nA Splunk user object which is assigned more than 1 source of risk in the last 24 hours may indicate malicious activity sourcing from the user account in question.\n\n#### Technical Context\nThis correlation search runs every hour, based on data from the 24 hours in the past. From \"risk\" index, look for a Splunk user object which is assigned more than 1 source of risk in the last 24 hours.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events of risk index are consistent.\n\n#### False Positives\nFalse positives of this use case would be rare as long as index \"risk\" can provide accurate information.\n\n#### Validation\nThe correlation search can be validated without the filter of | where distinct_searches > 1.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n","search":"index=risk risk_object_type=user\n| stats values(search_name) as searches dc(search_name) as distinct_searches by user\n| where distinct_searches > 1","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"15 * * * *","action.notable.param.rule_title":"User Risk From Multiple Sources 24 Hours - $user$","action.notable.param.rule_description":"This search detects when a Splunk user object is assigned more than 1 source of risk in the last 24 hours. May indicate malicious activity sourcing from the user account in question.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related risk items","action.notable.param.drilldown_search":"index=risk risk_object_type=user user=$user$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1626297917","updated":"2021-07-14","title":"ESCU - SMB Traffic Spike - MLTK - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"SMB Traffic Spike - MLTK","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/13/2021: Added ADS documentation. Note: can't validate the search because MLTK model \"smb_pdfmodel\" does not exist.\n\n#### Goal\nThe goal of this alert is to identify spikes in the number of Server Message Block (SMB) connections.\n\n#### Categorization\nMITRE ATT&CK: T1021, T1187\n\n#### Strategy Abstract\nUse the Machine Learning Toolkit (MLTK) to detect abnormally high count of SMB request which were observed sourcing from IP over a 10 minute period.\n\n#### Technical Context\nThis correlation search runs hourly, based on data from the start of 70 minutes to 10 minutes in the past. From \"Network_Traffic\" data model (index=corp OR index=paloalto OR index=aws OR index=aruba_cn), calculate the count and keep the IPs and ports. Apply MLTK model to find the anomaly.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events to construct the \"Network_Traffic\" data model are consistent.\n\n#### False Positives\nThe model quality relies greatly on the data. If the data is not typical enough, false positives may be triggered. And also not all anomalies are true positives. They could be related to some non-cybersecurity issues. \n\n#### Validation\nCan't validate the search because MLTK model \"smb_pdfmodel\" does not exist.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n","search":"| tstats `security_content_summariesonly` count values(All_Traffic.dest_ip) as dest values(All_Traffic.dest_port) as port from datamodel=Network_Traffic where All_Traffic.dest_port=139 OR All_Traffic.dest_port=445 OR All_Traffic.app=smb by _time span=10m, All_Traffic.src \n| eval HourOfDay=strftime(_time, \"%H\") \n| eval DayOfWeek=strftime(_time, \"%A\") \n| `drop_dm_object_name(All_Traffic)` \n| apply smb_pdfmodel threshold=0.0001 \n| rename \"IsOutlier(count)\" as isOutlier \n| search isOutlier > 0 AND count > 50 AND src=10.0.0.0/8 OR src=172.16.0.0/12 OR src=192.168.1.0/16\n| sort -count \n| eval desc=\"An abnormally high count (\".count.\") of SMB request were observed sourcing from IP \".src.\" over a 10 minute period.\"\n| table _time desc src dest port count \n| `smb_traffic_spike_mltk_filter`","dispatch.earliest_time":"-70m@m","dispatch.latest_time":"-10m@m","cron_schedule":"0 * * * *","action.notable.param.rule_title":"SMB Traffic Spike from $src$","action.notable.param.rule_description":"There was a spike in SMB traffic from $src$","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"src"}}
{"preview":false,"result":{"updated_time":"1626219050","updated":"2021-07-13","title":"Threat - RR - Detect Large Outbound ICMP Packets - System - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"RR - Detect Large Outbound ICMP Packets - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/08/2021: Added ADS documentation\n- 2020-06-09 NOTE: NEEDS BYTES_OUT info from PANW and Meraki sources.\n\n#### Goal\nThis search looks for outbound ICMP packets with a packet size larger than 1,000 bytes. \n\n#### Categorization\nMITRE ATT&CK: T1095\n\n#### Strategy Abstract\nVarious threat actors have been known to use ICMP as a command and control channel for their attack infrastructure. Large ICMP packets from an endpoint to a remote host may be indicative of this activity. Uses 10 second time window when pulling from Network Traffic data model. \n\n#### Technical Context\nThis correlation search runs hourly, based on data from the start of 65 minutes to 5 minutes in the past. From \"Network_Traffic\" data model (index=corp OR index=paloalto OR index=aws OR index=aruba_cn), calculate the bytes values over 10 seconds time window, where All_Traffic.protocol=\"ICMP\". Exclude the $dest$ in safe list, keep only the output where 'bytes_out'>1000. Evaluate the risk score for $src$.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that  events for \"Network_Traffic\" data model are available and consistent.\n\n#### False Positives\nIf macro `whitelist_zoom_safe_ips' is not up to date, false positives may be triggered.\n\n#### Validation\nValidate this alert by running the Splunk search without \"where All_Traffic.protocol=\"ICMP\"\" filter. \n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A","search":"| tstats summariesonly=true values(All_Traffic.bytes) as bytes values(All_Traffic.bytes_in) as bytes_in sum(All_Traffic.bytes_out) as bytes_out values(All_Traffic.direction) as direction count from datamodel=\"Network_Traffic\" where All_Traffic.protocol=\"ICMP\"  by \"All_Traffic.src\",\"All_Traffic.dest\",index,sourcetype,_time span=10s\n| `drop_dm_object_name(\"All_Traffic\")`\n| `whitelist_zoom_safe_ips(dest)`\n| where 'bytes_out'>1000\n| eval search_name=\"RR - Detect Large Outbound ICMP Packets - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Detect Large Outbound ICMP Packets from \".src\n| `risk_score_system(src)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"14 * * * *","action.notable.param.rule_title":"Large Outbound ICMP Packets from system: $src$","action.notable.param.rule_description":"Detected outbound ICMP packets with a packet size larger than 1,000 bytes. Uses 10 second time window when pulling from Network Traffic data model.","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View ICMP network traffic from $src$","action.notable.param.drilldown_search":"| from datamodel:\"Network_Traffic\" | search src=$src|s$ protocol=\"ICMP\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625863115","updated":"2021-07-09","title":"Threat - Email - Email delivered from High Severity User - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"Email - Email delivered from High Severity User","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 06/22/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect when an email has been delivered to a zoom user from a high severity ThreatStream IOC.\n\n#### Categorization\nMITRE ATT&CK\nName: Initial Accecss/Phishing\nID: T1566\nReference URL: https://attack.mitre.org/techniques/T1566/\n\n#### Strategy Abstract\nCurrently leveraging the email tag specifically associated with Proofpoint event logs.\n\n#### Technical Context\nThe correlation search looks at the sending user and If there are any matches in threatstream, a notable will be created.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Proofpoint events, event tagging is correctly cofigured, and that our ThreatStream IOC feed has been curated for actionable intel.\n\n#### False Positives\nPotential legitimate emails due to improper intelligence feeds.\n\n#### Validation\nThe correlation search can be validated by viewing activity from the sender in proofpoint event logs as well as the proofpoint console.\n\n#### Priority\nThis alert should be high severity.\n\n#### Response\n1. Investigate the ThreatStream IOC and confirm the IOC is still relevant\n2. Pivot search on all other emails received containing the same IOC over the last 7 days, identifying all senders, recipients, subject lines, attachments, etc\n3. If there were other emails sent that went undetected by this alert, Proofpoint, user report, or another means, investigate and triage those emails as phishing attempts\n4. Start the process of removing the malicious emails from recipient inboxes\n5. Validate if credentials were harvested, sessions stolen, or if an infection occurred on any of the target machines as a result of the email\n6. If any signs of potential infection or compromise are detected in step 5, document findings and escalate to Tier 2\n\n#### Additional Resources\n\n---","search":"tag=email signature=pass action=delivered\n| fields src_user, orig_recipient, recipient, subject, severity\n| eval severity_lookup=\"*high\"\n| lookup ts_lookup_email_2 email as src_user severity as severity_lookup OUTPUT severity as ts_severity, itype as threat_source_type, confidence as ts_confidence, source as threat_collection, org as threat_group \n| search ts_severity=\"*high\"\n| eval threat_description=\"ThreatStream has identified \".email.\" as a \".ts_severity.\" severity IP with \".ts_confidence.\"% confidence.\" \n| fields - severity_lookup, ts*","dispatch.earliest_time":"-10m","dispatch.latest_time":"-5m","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Email - Email delivered from High Severity User","action.notable.param.rule_description":"Detects when an email has been delivered by a High Severity user.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"Review associated log entries","action.notable.param.drilldown_search":"tag=email signature=pass action=delivered src_user=$src_user$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"25","action.risk.param._risk_object":"src_user"}}
{"preview":false,"result":{"updated_time":"1625857979","updated":"2021-07-09","title":"Threat - OKTA - Possible Session Hijack - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"OKTA - Possible Session Hijack","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 06/29/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect when a user's okta session may have been hijacked.  \n\n#### Categorization\nMITRE ATT&CK\nName: Initial Accecss/Compromise Accounts\nID: T1586\nReference URL: https://attack.mitre.org/techniques/T1586/\n\nName: Initial Access/phishing\nID: T1566\nReference URL: https://attack.mitre.org/techniques/T1566/\n\nName: Initial Access/Valid Accounts\nID: T1078\nReference URL: https://attack.mitre.org/techniques/T1078/\n\n#### Strategy Abstract\nCurrently leveraging okta event logs associated with user connections.\n\n#### Technical Context\nThe correlation search looks at user connections made over the last hour and compares user IP, OS, and user agent strings to determine if more than 1 IP is connected to the same okta session.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Okta events\n\n#### False Positives\nPotential legitimate user connections being made through okta's login process.\n\n#### Validation\nThe correlation search can be validated by reviewing user connection logs from the user in question based on the sessionID that was created in okta.  \n\n#### Priority\nThis alert should be high severity.\n\n#### Response\n1. Investigate the IPs, user-agent strings, operating systems, geolocations, and device types in use for each detected session for the user\n2. Perform OSINT and contextual analysis on the IPs, user-agent strings, or any other relevant discovered IOCs to determine reputation\n3. Perform a 7-day search on Okta authentication activity for this user to determine normal behavior and expected devices for them\n4. Determine if any of the detected multiple sessions appear suspicious or can be confirmed malicious\n5. If so, determine any other users that have been authenticated to from the same IP addresses or user-agent strings (if they are unique enough)\n6. Document findings and escalate to Tier 2\n\n#### Additional Resources\n\n---","search":"index=okta \n| eval userlower=lower(user) \n| rename authenticationContext.externalSessionId as session \n| rename client.userAgent.rawUserAgent as UA \n| rename client.userAgent.os as OS \n| rename client.device as deviceType \n| stats min(_time) as firstTime \n    max(_time) as lastTime \n    dc(src_ip) as ipcount,\n    dc(UA) as uacount,\n    dc(OS) as oscount,\n    values(OS) as OS,\n    values(UA) as UA,\n    values(deviceType) as deviceType,\n    values(src_ip) as src_ip by session, userlower \n| where ipcount > 1 AND oscount > 1 AND uacount > 1 \n| `security_content_ctime(firstTime)` \n| `security_content_ctime(lastTime)` \n| search deviceType!=Mobile src_ip!=null session!=unknown session!=null userlower!=0*","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m@m","cron_schedule":"0 * * * *","action.notable.param.rule_title":"OKTA - Possible Session Hijack","action.notable.param.rule_description":"The goal of this use case is to detect when a user's okta session may have been hijacked.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"Review associated log entries","action.notable.param.drilldown_search":"index=okta authenticationContext.externalSessionId=$session$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1625856313","updated":"2021-07-09","title":"Threat - Okta User LifeCycle Provisioning Activity Daily Report - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Okta User LifeCycle Provisioning Activity Daily Report","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nProduces and sends a daily PDF report to Okta system admins that contains Okta user life cycle provisioning activities outside of the USA.\n#### Categorization\nMITRE ATT&CK\nName: Valid Accounts\nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n#### Strategy Abstract\nProduces and sends a daily PDF report to Okta system admins that contains Okta user life cycle provisioning activities outside of the USA.\n\n### Technical Context\nThe correlation searches for Okta user.lifecycle events and sends an email to the corresonding teams. \n\n#### Blind Spots and Assumptions\nThe correlation search assumse that there is no intruption in event collection. \n\n#### False Positives\n\n#### Validation\n\n#### Priority\n\n#### Response\n\n#### Additional Resources\nEmails are sent to sysadminsplunkalert@zoom.us, ryan.klingaman@zoom.us\n---","search":"index=okta sourcetype=OktaIM2:log tag=account tag=change eventType=\"user.lifecycle.*\" NOT (user=workday.realtimesync@zoom.us OR user=system@okta.com OR user_work_country=\"united states of america\")\n| fields user, src, displayMessage, target{}.alternateId\n| eval DateTime = strftime(_time, \"%m-%d-%Y %H:%M:%S\")\n| rename user as Actor, src as \"Source IP\", displayMessage as \"Okta Action\",  target{}.alternateId as \"Target User\"\n| sort DateTime \n| table DateTime, Actor, \"Source IP\", \"Okta Action\", \"Target User\"","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"0 6 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625856032","updated":"2021-07-09","title":"Threat - RF Domain Threatlist Search - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"RF Domain Threatlist Search","author":"splunk-system-user","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nEnriches notable events detected from the Domain threat list of Recorded Future with additional information\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nEnriches notable events detected from the Domain threat list of Recorded Future with additional information\n\n### Technical Context\nEnriches notable events detected from the Domain threat list of Recorded Future with additional information\n\n#### Blind Spots and Assumptions\n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is High \n\n#### Response\n\n#### Additional Resources\n\n---","search":"`enrich_from_risklist(rf_domain_risklist, ip_intel, idn)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"20 * * * *","action.notable.param.rule_title":"RF Threat Activity Detected ($threat_match_value$)","action.notable.param.rule_description":"Threat activity ($threat_match_value$) was discovered in the \"$threat_match_field$\" field based on threat intelligence available in the Domain Risk List of Recorded Future.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View all threat activity involving $threat_match_field$=\"$threat_match_value$\"","action.notable.param.drilldown_search":"| datamodel Threat_Intelligence Threat_Activity search | search Threat_Activity.threat_match_field=\"$threat_match_field$\" Threat_Activity.threat_match_value=\"$threat_match_value$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625855886","updated":"2021-07-09","title":"Threat - RF URL Threatlist Search - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"RF URL Threatlist Search","author":"splunk-system-user","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nEnriches notable events detected with data from the URL threat list of Recorded Future with additional information\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nEnriches notable events detected with data from the URL threat list of Recorded Future with additional information\n\n### Technical Context\nEnriches notable events detected with data from the URL threat list of Recorded Future with additional information\n\n#### Blind Spots and Assumptions\n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is High \n\n#### Response\n\n#### Additional Resources\n\n---","search":"`enrich_from_risklist(rf_url_risklist, http_intel, url)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"20 * * * *","action.notable.param.rule_title":"RF Threat Activity Detected ($threat_match_value$)","action.notable.param.rule_description":"Threat activity ($threat_match_value$) was discovered in the \"$threat_match_field$\" field based on threat intelligence available in the URL Risk List of Recorded Future.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View all threat activity involving $threat_match_field$=\"$threat_match_value$\"","action.notable.param.drilldown_search":"| datamodel Threat_Intelligence Threat_Activity search | search Threat_Activity.threat_match_field=\"$threat_match_field$\" Threat_Activity.threat_match_value=\"$threat_match_value$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625855455","updated":"2021-07-09","title":"Threat - RF Hash Threatlist Search - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"RF Hash Threatlist Search","author":"splunk-system-user","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nEnriches notable events detected from the Hash threat list of Recorded Future with additional information\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nEnriches notable events detected from the Hash threat list of Recorded Future with additional information\n\n### Technical Context\nEnriches notable events detected from the Hash threat list of Recorded Future with additional information\n\n#### Blind Spots and Assumptions\n\n#### False Positives\n\n#### Validation\n\n#### Priority\nPriority is High \n\n#### Response\n\n#### Additional Resources\n\n---","search":"`enrich_from_risklist(rf_hash_risklist, file_intel, hash)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"20 * * * *","action.notable.param.rule_title":"RF Threat Activity Detected ($threat_match_value$)","action.notable.param.rule_description":"Threat activity ($threat_match_value$) was discovered in the \"$threat_match_field$\" field based on threat intelligence available in the Hash Risk List of Recorded Future.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View all threat activity involving $threat_match_field$=\"$threat_match_value$\"","action.notable.param.drilldown_search":"| datamodel Threat_Intelligence Threat_Activity search | search Threat_Activity.threat_match_field=\"$threat_match_field$\" Threat_Activity.threat_match_value=\"$threat_match_value$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625855449","updated":"2021-07-09","title":"Threat - RR - Anomalous Audit Trail Activity Detected - System - Rule","index":"gsuite","datamodel":"Change","product":["Google Gsuite","Amazon Web Services","Cimtrak","Okta","Linux OS","Palo Alto Networks","Juniper"],"action.correlationsearch.label":"RR - Anomalous Audit Trail Activity Detected - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/09/2021: Added ADS documentation\n- 03/22/2021: Removed GSuite index which was returning change records with no context and creating a high number of irrelevant Risk objects.\n\n#### Goal\nThe goal of this alert is to discover anomalous activity such as the deletion of or clearing of log files. \n\n#### Categorization\nMITRE ATT&CK: T1070, T1146, T1107\n\n#### Strategy Abstract\nAttackers oftentimes clear the log files in order to hide their actions, therefore, this may indicate that the system has been compromised.\n\n#### Technical Context\nThe correlation search runs every ten minutes, based on data from the start of 15 minutes to 5 minutes in the past. . Currently data model \"Change\" data is ingested into Splunk under index=aws OR index=os OR index=osaudit OR index=routers OR index=switches OR index=okta OR index=cimtrak OR index=paloalto OR index=gsuite OR index=paloaltocdl OR index=aruba_cn. This correlation search look for the cleared/stopped/deleted changes after drop the index \"gsuite\". Create the risk score for the $dest$.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that events for data model \"Change\" are available and consistent.\n\n#### False Positives\nFalse positives is possible if some of the index gives irrelevant Risk objects.\n\n#### Validation\nValidate this alert by running the Splunk search without the constraint of \"NOT index=gsuite\".\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n","search":"| tstats `summariesonly` count, max(_time) as _time, values(All_Changes.result) as result from datamodel=\"Change\" where nodename=All_Changes.Auditing_Changes (All_Changes.action=\"cleared\" OR All_Changes.action=\"stopped\" OR All_Changes.action=\"deleted\") NOT index=gsuite by All_Changes.action, All_Changes.src, All_Changes.dest, All_Changes.result, index, sourcetype\n| `drop_dm_object_name(\"All_Changes\")`\n| rename \"result\" as \"signature\"\n| eval search_name=\"RR - Anomalous Audit Trail Activity Detected - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Anomalous Audit Trail Activity Detected On \".dest\n| `risk_score_system(dest)`","dispatch.earliest_time":"-15m@m","dispatch.latest_time":"-5m@m","cron_schedule":"9,19,29,39,49,59 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625855386","updated":"2021-07-09","title":"Threat - RR - Brute Force Access Behavior Detected - System - Rule","index":"N/A","datamodel":"Authentication","product":["Amazon Web Services","Okta","Linux OS","Juniper","Zoom Application"],"action.correlationsearch.label":"RR - Brute Force Access Behavior Detected - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/08/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect excessive number of failed login attempts along with a successful attempt (this could indicate a successful brute force attack)\n\n#### Categorization\nMITRE ATT&CK: T1110\n\n#### Strategy Abstract\nCurrently data model \"Authentication\" is created from index=os OR index=okta OR index=switches OR index=routers OR index=zoomlog OR index=aws OR index=osaudit OR index=gsuite OR index=aruba_cn. Use the machine learning model to find the outliers from failure count and success count, then evaluate the risk score.\n\n#### Technical Context\nThe correlation search runs hourly, based on data from the start of 65 minutes to 5 minutes in the past. From \"Authentication\" datamodel, find the maximum count of action=success and the maximum count of action=failure. Apply the Splunk machine learning tool kit model \"destinations_by_src_1h\" to find the outliers, excluding the source IPs from the safe list. Evaluate the risk score for the source IP. \n\n#### Blind Spots and Assumptions\nThis correlation search assumes that the events for \"Authentication\" datamodel are available and consistent.\n\n#### False Positives\nIf macros `whitelist_zoom_safe_ips` and `zoom_vuln_scanner_ips` are not up to date, false positives may be triggered.\n\n#### Validation\nValidate this alert by running the Splunk search based on data from the past 4 hours.\n\n#### Priority\nMedium\n\n#### Response\n\n\n#### Additional Resources\nN/A\n\n\n","search":"| tstats `summariesonly` values(Authentication.tag) as tag, values(Authentication.app) as app, count from datamodel=\"Authentication\" by Authentication.src, Authentication.action\n| `drop_dm_object_name(\"Authentication\")`\n| eval failure=if(action=\"failure\",count,null()), success=if(action=\"success\",count,null())\n| stats values(tag) as tag,values(app) as app, max(failure) as failure, max(success) as success by src\n| search success>0 failure>0\n| `mltk_apply_upper(\"app:failures_by_src_count_1h\", \"high\", \"failure\")`\n| `whitelist_zoom_safe_ips(src)`\n| search NOT `zoom_vuln_scanner_ips`\n| eval search_name=\"RR - Brute Force Access Behavior Detected - System\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"Brute Force Access Behavior Detected From \".src\n| `risk_score_system(src)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"04 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625854921","updated":"2021-07-09","title":"Threat - RR - High or Critical Priority Individual Logging into Infected Machine - Combined - Rule","index":"N/A","datamodel":"Malware","product":"Sophos AV","action.correlationsearch.label":"RR - High or Critical Priority Individual Logging into Infected Machine - Combined","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/07/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect malware infections on endpoints and observes the user in the event, if available.  If the user is a high or critical priority user (VIP), then raise the risk score of the user and the endpoint.\n\n#### Categorization\nMITRE ATT&CK: T1204\n\n#### Strategy Abstract\nCurrently Malware\".\"Malware_Attacks datamodel is ingested into Splunk under index=sophos. The use case will correlate malware event with \"simple_identity_lookup\".\n\n#### Technical Context\nThe correlation search runs every hour, based on the data from the start of 65 minutes to 5 minutes in the past. From Malware\".\"Malware_Attacks datamodel, find the malwares and correlate the malwares with \"simple_identity_lookup\" based on the \"user\" or \"user_email\" to obtain the priority information. Keep only the user if the priority is high or critical. Evaluate the risk score based on the fields $user$ or $dest$.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that sophos events for Malware\".\"Malware_Attacks datamodel are available and consistent.\n\n#### False Positives\nIf Malware\".\"Malware_Attacks datamodel creates false positives, this correlation search may trigger false positives as well.\n\n#### Validation\nValidate this correlation search by running the Splunk search based on data from the past 90 days, without filtering the data by condition of user_priority=\"high\" OR user_priority=\"critical\".\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nN/A\n\n","search":"| tstats `summariesonly` count values(Malware_Attacks.action) as action, values(Malware_Attacks.file_path) as file_path, values(Malware_Attacks.signature) as signature from datamodel=\"Malware.Malware_Attacks\" by index, sourcetype, Malware_Attacks.user, Malware_Attacks.src, Malware_Attacks.dest, _time span=1s\n| `drop_dm_object_name(\"Malware_Attacks\")`\n| eval user=LOWER(user)\n| eval user_email=user+\"@zoom.us\"\n| eval user_email2=user+\"@zoom.com\"\n| lookup simple_identity_lookup identity AS user OUTPUT priority as user_priority_1 category as user_category_1\n| lookup simple_identity_lookup identity AS user_email OUTPUT priority as user_priority_2 category as user_category_2\n| lookup simple_identity_lookup identity AS user_email2 OUTPUT priority as user_priority_3 category as user_category_3\n| eval user_category=coalesce(user_category_1,user_category_2,user_category_3), user_priority=coalesce(user_priority_1,user_priority_2,user_priority_3)\n| fields - user_category_* user_priority_* user_email*\n| where user_priority=\"high\" OR user_priority=\"critical\"\n| eval search_name=\"RR - High or Critical Priority Individual Logging into Infected Machine - Combined\"\n| `set_rr_fields(search_name)`\n| eval risk_message=\"High or Critical Priority Individual (\".user.\") logging into Infected Machine\"\n| `risk_score_system(dest)`\n| `risk_score_user(user)`","dispatch.earliest_time":"-65m@m","dispatch.latest_time":"-5m@m","cron_schedule":"12 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625854487","updated":"2021-07-09","title":"Network - RR - Potential Rogue Device Detected - System - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"RR - Potential Rogue Device Detected - System","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/06/2021: Added ADS documentation\n\n#### Goal\nThe goal of this correlation search is to look in the AWS Cloudtrail logs for RunInstances events sourcing from external IP address and users who have not authenticated via MFA. In addition, the search compares the new host to the known list of ES assets and filters out any that exist in CMDB.\n\n#### Categorization\nMITRE ATT&CK: T1111\n\n#### Strategy Abstract\nAWS Cloudtrail logs show a RunInstances event for a instance_id that is not in the known ES assets list of ES assets.\n\n#### Technical Context\nThe correlation searches runs every two hour, based on the data from the start of 145 minutes to 15 minutes in the past. It looks for AWS Cloudtrail RunInstances event users who have not authenticated via MFA, and then filter the result of the sourcing IPs from office. Find the mapped nt_host in lookup \"simple_asset_lookup\" using the field of \"instance_id\" in the search. Alert is triggered if nt_host is null.\n\n#### Blind Spots and Assumptions\nThis search assumes that  AWS Cloudtrail RunInstances events are available and consistent.\n\n#### False Positives\nNull values in the field of \"instance_id\" in the search result in null values in nt_host from lookup \"simple_asset_lookup\". This increases the chances false positives.\n\n#### Validation\nThe correlation search can be validated by running the search over a 7 days time window. \n\n#### Priority\nThis alert should be Medium severity.\n\n#### Response\n\n#### Additional Resources\nN/A\n\n\n","search":"index=aws sourcetype=aws:cloudtrail eventName=RunInstances source=aws_firehose_cloudtrail \"userIdentity.sessionContext.attributes.mfaAuthenticated\"=false src=0.0.0.0/0 NOT \"requestParameters.tagSpecificationSet.items{}.tags{}.value\"=ZEO*\n| search `filter_zoom_office_ips_by_field(src)`\n| rename responseElements.instancesSet.items{}.instanceId as instance_id, responseElements.instancesSet.items{}.privateIpAddress as ip, responseElements.instancesSet.items{}.privateDnsName as dns, responseElements.instancesSet.items{}.networkInterfaceSet.items{}MacAddress as mac, userName as user \n| `potential_rogue_device_detected_filter`\n| rename \"requestParameters.tagSpecificationSet.items{}.tags{}.value\" as desc\n| table _time, instance_id, src, dns, aws_account_id, user, desc\n| lookup simple_asset_lookup nt_host as instance_id OUTPUT nt_host AS foo \n| eval asset_status=if(isnotnull(foo),\"Known\",\"Unknown\") \n| fields - foo \n| search asset_status=\"Unknown\"","dispatch.earliest_time":"-145m@m","dispatch.latest_time":"-15m@m","cron_schedule":"15 */2 * * *","action.notable.param.rule_title":"Potential Rogue Device Detected ($instance_id$)","action.notable.param.rule_description":"AWS Cloudtrail logs show a RunInstances event for a instance_id that is not in the known ES assets list of ES assets.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View Cloudtrail events for instance $instance_id$","action.notable.param.drilldown_search":"index=aws sourcetype=aws:cloudtrail \"$instance_id$\" | search responseElements.instancesSet.items{}.instanceId=\"$instance_id$\"","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625842910","updated":"2021-07-09","title":"Threat - Email Delivered with Potentially Malicious URL - Rule","index":"N/A","datamodel":"Email","product":"Linux OS","action.correlationsearch.label":"Email Delivered with Potentially Malicious URL","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 03/15/2021: Created search\n\n#### Goal\nDetects when a URL within the body of an email destined to a Zoom recipient matches a URL identified as malicious by ThreatStream. Runs every 20 minutes.\n\n#### Categorization\nMITRE ATT&CK\nName: Phishing\nID: T1566.002\nReference URL: https://attack.mitre.org/techniques/T1566/002/\n\n#### Strategy Abstract\nDetects when a URL within the body of an email destined to a Zoom recipient matches a URL identified as malicious by ThreatStream. Runs every 20 minutes.\n\n### Technical Context\nThe correlation searches in the email datamodel for delivered emails. Once the events are returned, the email urls are compared to the TS Look and return matching results. \n\n#### Blind Spots and Assumptions\nThis search assumes that there are not interruption in event collection.\n\n#### False Positives\nTS URL has been cleaned but has not been updated in the TS Lookup \n\n#### Validation\n\n#### Priority\nPriority is medium \n\n#### Response\n\n#### Additional Resources\n\n---","search":"| tstats prestats=false local=false summariesonly=true allow_old_summaries=true count from datamodel=Email where All_Email.action=\"delivered\" NOT All_Email.src_user=\"*confluence.atlassian.net\" NOT All_Email.src_user=\"*@zoom.us\" NOT receipient=postmaster by _time, host, source, sourcetype All_Email.src,All_Email.dest, All_Email.action, All_Email.src_user, All_Email.recipient All_Email.subject All_Email.url span=10m \n| rename All_Email.* AS * \n| fillnull value=\"unknown\"\n| lookup local=true ts_lookup_url url as url OUTPUTNEW asn as ts_asn, classification as ts_classification, confidence as ts_confidence, country as ts_country, date_first as ts_date_first, date_last as ts_date_last, itype as ts_itype, lat as ts_lat, lon as ts_lon, maltype as ts_maltype, org as ts_org, severity as ts_severity, source as ts_source, email as ts_lookup_key_value, id as ts_id, detail as ts_detail, resource_uri as ts_resource_uri, actor as ts_actor, tipreport as ts_tipreport, type as ts_type\n| search ts_lookup_key_value=* \n| rename ts_lookup_key_value AS indicator","dispatch.earliest_time":"-25m","dispatch.latest_time":"-5m","cron_schedule":"*/20 * * * *","action.notable.param.rule_title":"Email Delivered with Potentially Malicious URL","action.notable.param.rule_description":"Detects when a URL within the body of an email destined to a Zoom recipient matches a URL identified as malicious by ThreatStream.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View email logs","action.notable.param.drilldown_search":"| tstats prestats=false local=false summariesonly=true allow_old_summaries=true count from datamodel=Email where All_Email.action=\"delivered\" NOT All_Email.src_user=\"*confluence.atlassian.net\" NOT All_Email.src_user=\"*@zoom.us\" NOT receipient=postmaster by _time, host, source, sourcetype All_Email.src,All_Email.dest, All_Email.action, All_Email.src_user, All_Email.recipient All_Email.subject All_Email.url span=10m  | rename All_Email.* AS *  | fillnull value=\"unknown\" | lookup local=true ts_lookup_url url as url OUTPUTNEW asn as ts_asn, classification as ts_classification, confidence as ts_confidence, country as ts_country, date_first as ts_date_first, date_last as ts_date_last, itype as ts_itype, lat as ts_lat, lon as ts_lon, maltype as ts_maltype, org as ts_org, severity as ts_severity, source as ts_source, email as ts_lookup_key_value, id as ts_id, detail as ts_detail, resource_uri as ts_resource_uri, actor as ts_actor, tipreport as ts_tipreport, type as ts_type | search ts_lookup_key_value=*  | rename ts_lookup_key_value AS indicator | search url=$url$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625842781","updated":"2021-07-09","title":"Threat - Email Delivered with Potentially Malicious Attachment - Rule","index":"N/A","datamodel":"Email","product":"Linux OS","action.correlationsearch.label":"Email Delivered with Potentially Malicious Attachment","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 03/15/2021: Created search\n- 06/02/2021: Revised search due to additional character stored in the drill down.  Initial request - INC0039738.\n\n#### Goal\nDetects when the file extension of an email matches an extension defined in the \"is_suspicious_file_extension_lookup\" lookup table. Runs every 20 minutes.\n\n#### Categorization\nMITRE ATT&CK\nName: Phishing\nID: T1566.001\nReference URL: https://attack.mitre.org/techniques/T1566/001/\n\n#### Strategy Abstract\nDetects when the file extension of an email matches an extension defined in the \"is_suspicious_file_extension_lookup\" lookup table. Runs every 20 minutes.\n\n### Technical Context\nThe correlation searches in the email datamodel for delivered emails returning events that contain suspicious_email_attachments\n\n#### Blind Spots and Assumptions\nThis search assumes that there are not interruption in event collection.\n\n#### False Positives\nWrong rating was given to the email attachment. \n\n#### Validation\n\n#### Priority\nPriority is medium \n\n#### Response\n\n#### Additional Resources\n\n---","search":"| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(All_Email.recipient) as recipient from datamodel=Email where All_Email.file_name=\"*\" AND All_Email.action=\"delivered\" by All_Email.src_user, All_Email.file_name All_Email.file_hash All_Email.message_id All_Email.action\n| `security_content_ctime(firstTime)` \n| `security_content_ctime(lastTime)` \n| `drop_dm_object_name(\"All_Email\")` \n| `suspicious_email_attachments`","dispatch.earliest_time":"-25m","dispatch.latest_time":"-5m","cron_schedule":"*/20 * * * *","action.notable.param.rule_title":"Email Delivered with Potentially Malicious Attachment","action.notable.param.rule_description":"Detects when the file extension of an email matches an extension defined in the \"is_suspicious_file_extension_lookup\" lookup table.","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View email logs","action.notable.param.drilldown_search":"| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time) as lastTime values(All_Email.recipient) as recipient from datamodel=Email where All_Email.file_name=\"*\" AND All_Email.action=\"delivered\" by All_Email.src_user, All_Email.file_name All_Email.file_hash All_Email.message_id All_Email.action | `security_content_ctime(firstTime)`  | `security_content_ctime(lastTime)`  | `drop_dm_object_name(\"All_Email\")`  | `suspicious_email_attachments` | search file_name=$file_name$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625841703","updated":"2021-07-09","title":"Threat - RN - 24 hour risk threshold exceeded - Rule","index":"N/A","datamodel":"Risk","product":"Miscellaneous","action.correlationsearch.label":"RN - 24 hour risk threshold exceeded","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nRBA: Risk Threshold exceeded for an object within the previous 24 hours.\n\n#### Categorization\nMITRE ATT&CK\n\n#### Strategy Abstract\nRBA: Risk Threshold exceeded for an object within the previous 24 hours.\n\n### Technical Context\nThe correlation searches on the Risk datamodel pulling data into a table while separating the MITRE tactics and techniques. \nOnce the information is seprated, a risk score is calcuated. \nIf the risk score is greater than 100, results are returned for specific host IP addresses. \n\n#### Blind Spots and Assumptions\nThis search assumes that there are not intruption in event collection.\n\n#### False Positives\nRisk List are not populated with high fidelty data points\n\n#### Validation\n\n#### Priority\nPriority is high\n\n#### Response\n\n#### Additional Resources\n\n---","search":"| from datamodel:\"Risk.All_Risk\" \n| search source=\"Threat - RR*\" NOT testmode=1 risk_object!=\"unknown\" \n| table _time, risk_object risk_object_type risk_message source risk_score rule_attack_tactic_technique \n| makemv delim=\"|\" rule_attack_tactic_technique \n| mvexpand rule_attack_tactic_technique \n| rex field=rule_attack_tactic_technique \"(^|\\|)(?<tactic>.+?) - (?<tactic_num>.+?) - (?<technique>.+?) - (?<technique_ref>.*)\" \n| streamstats reset_after=\"(\"max_time-min_time>86400\")\" sum(risk_score) as risk_ScoreSum \n    min(_time) as min_time\n    max(_time) as max_time\n    dc(source) as sourceCount \n    dc(tactic) as tacticCount \n    dc(technique) as techniqueCount\n    by risk_object,risk_object_type \n| stats sum(risk_score) as risk_ScoreSum \n    values(risk_message) as risk_message \n    min(min_time) as min_time\n    max(sourceCount) as sourceCount \n    values(source) as source \n    values(rule_attack_tactic_technique) as rule_attack_tactic_technique \n    max(tacticCount) as tacticCount \n    values(tactic) as tactic \n    max(techniqueCount) as techniqueCount\n    values(technique) as technique\n    by risk_object,risk_object_type,max_time \n| eval risk_duration=max_time-min_time \n| where risk_ScoreSum > 100 and risk_duration<86400 \n| eval risk_duration=tostring(risk_duration,\"duration\") \n| eval severity=case(risk_ScoreSum>=100 and risk_ScoreSum<250,\"medium\",\n    risk_ScoreSum>=250 and risk_ScoreSum <500,\"high\",\n    risk_ScoreSum>=500,\"critical\") \n| eval message=\"24 hour risk threshold exceeded for \".risk_object_type.\"=\".risk_object.\" spanning \".sourceCount.\" Risk Rules, \".tacticCount.\" ATT&CK tactics, and \".techniqueCount.\" ATT&CK techniques\" \n| eval user=if(risk_object_type=\"user\",risk_object,null()) \n| eval orig_host=if(risk_object_type=\"system\",risk_object,null()) \n| search orig_host IN (204.141.30.129,204.141.28.129,173.231.80.254,192.168.10.247,149.137.24.86,192.168.82.247,173.231.84.254,192.168.57.247,52.70.99.96)","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"07,17,27,37,47,57 * * * *","action.notable.param.rule_title":"RBA:  24 hour risk threshold exceeded for $risk_object_type$=$risk_object$ spanning $sourceCount$ Risk Rules, $tacticCount$, ATT&CK tactics, and $techniqueCount$ ATT&CK techniques","action.notable.param.rule_description":"RBA:  Risk Threshold Exceeded for an object over a 24 hour period","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View the individual Risk Attributions","action.notable.param.drilldown_search":"|from datamodel:\"Risk.All_Risk\"|search risk_object=$risk_object$ source=\"Threat*\"|table _time risk_object risk_object_type risk_message source risk_score rule_attack_tactic_technique |eventstats sum(risk_score) as risk_scoreSum by risk_object","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625779593","updated":"2021-07-08","title":"Threat - Detect Local Account Authentication in Production - Rule","index":"os","datamodel":"N/A","product":"Linux OS","action.correlationsearch.label":"Detect Local Account Authentication in Production","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 2/12/2021: Created search/report\n\n#### Goal\nProduces email report for the Engineering Operations team (Zak Pierce) that outlines local account authentication events destined to assets in the production network. Does not currently produce notables/risk objects.\n\n#### Categorization\nMITRE ATT&CK\nName: Account Manipulation\nID: T1098\nReference URL: https://attack.mitre.org/techniques/T1098/\n\nName: Valid Accounts: Local Account\nID: T1078.003\nReference URL: https://attack.mitre.org/techniques/T1078/003/\n\n#### Strategy Abstract\nProduces email report for the Engineering Operations team (Zak Pierce) that outlines local account authentication events destined to assets in the production network. Does not currently produce notables/risk objects.\n\n### Technical Context\nProduces email report for the Engineering Operations team (Zak Pierce) that outlines local account authentication events destined to assets in the production network. Does not currently produce notables/risk objects.\n\n#### Blind Spots and Assumptions\nThis search assumes that there are not intruption in event collection.\n\n#### False Positives\nThis is a report\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=os tag=authentication app=sshd action=success NOT user_bunit=* NOT (user=zoomcs OR user=oktadeploy OR user=oktajenkins OR user=oktatele OR user=zoomcs OR user=zoomlog) NOT (user=git AND (host=sc7-git.zoom.us OR host=sc7-git-data OR host=sc7-git-op)) \n| stats values(src) as src values(src_category) as source_category dc(dest) as destinations_count by user\n| fillnull source_category value=\"unknown\"\n| sort - destinations_count","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"45 13 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625779066","updated":"2021-07-08","title":"Threat - GSuite Admin Added Self Permission to GDrive - Rule","index":"gsuite","datamodel":"N/A","product":"Google Gsuite","action.correlationsearch.label":"GSuite Admin Added Self Permission to GDrive","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 03/03/2021: Fixed search to exclude users removing themselves from a GDrive location.\n\n#### Goal\nThis search alerts on events that indicate a GSuite Administrator has inappropriately added themself to a Google Shared Drive location.\n\n#### Categorization\nMITRE ATT&CK\nName: Account Manipulation\nID: T1098\nReference URL: https://attack.mitre.org/techniques/T1098/\n\nName: Valid Accounts: Cloud Accounts\nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n\n#### Strategy Abstract\nThis search alerts on events that indicate a GSuite Administrator has inappropriately added themself to a Google Shared Drive location.\n\n### Technical Context\nThe correlation searches gsuite events for changes to the shared_drive_membership_change. \n\n#### Blind Spots and Assumptions\nThis search assumes that there are not intruption in event collection.\n\n#### False Positives\nAdmin has legitimate business usecase to perform report activity\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nUser risk analysis is set to 50 \nPriority is medium\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=gsuite event_name=shared_drive_membership_change NOT events{}.parameters{}.membership_change_type=\"remove_from_shared_drive\"\n| rename events{}.parameters{}.target AS user actor.email AS src_user events{}.parameters{}.doc_title AS drive \n| where src_user=user","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m","cron_schedule":"0 * * * *","action.notable.param.rule_title":"GSuite Admin Added Self Permission to GDrive - $user$","action.notable.param.rule_description":"GSuite Administrator $user$ has inappropriately added themself to a Google Shared Drive location $drive$.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related log entries","action.notable.param.drilldown_search":"index=gsuite event_name=shared_drive_membership_change  | rename events{}.parameters{}.target AS user actor.email AS src_user events{}.parameters{}.doc_title AS drive | where src_user=user | search user=$user$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1625776414","updated":"2021-07-08","title":"Threat - MLTK Populate Zoom Datacenter Base Traffic Model - Rule","index":"N/A","datamodel":"Network_Traffic","product":["Amazon Web Services","Palo Alto Networks"],"action.correlationsearch.label":"MLTK Populate Zoom Datacenter Base Traffic Model","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 03/03/2021: Changed timespan to 30 minutes to account for expected spike at the top of each hour.\n- 2/16/2021: INC0038579 - shortened training timespan to 10m from 1h. Increased threshold to 0.00005 from 0.0005.\n- 2/10/2021: Created search\n\n\n#### Goal\nPopulate the \"zoom_dc_traffic_baseline\" MLTK model that drives DDoS detection content. Runs daily at 4AM (EST).\n\n#### Categorization\nMITRE ATT&CK\nName: Network Denial of Service\nID: T1498\nReference URL: https://attack.mitre.org/techniques/T1498/\n\n\n#### Strategy Abstract\nPopulate the \"zoom_dc_traffic_baseline\" MLTK model that drives DDoS detection content. Runs daily at 4AM (EST).\n\n### Technical Context\nPopulate the \"zoom_dc_traffic_baseline\" MLTK model that drives DDoS detection content. Runs daily at 4AM (EST).\n\n\n#### Blind Spots and Assumptions\nThe data model must provide enough data to ensure the proper ML can be performed on the data. \n\n#### False Positives\nMachine Learning\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\n\n#### Response\n\n#### Additional Resources\n\n---","search":"| tstats summariesonly=true count as traffic_count from datamodel=\"Network_Traffic\" where host=\"Zoom-*\" groupby host _time span=30m \n| fit DensityFunction traffic_count threshold=0.00005 by host into zoom_dc_traffic_baseline","dispatch.earliest_time":"-30d","dispatch.latest_time":"now","cron_schedule":"0 4 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625767493","updated":"2021-07-08","title":"ESCU - Multiple Okta Users With Invalid Credentails From The Same IP - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Multiple Okta Users With Invalid Credentails From The Same IP","author":"admin","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n\n#### Goal\nThis search detects Okta login failures due to bad credentials for multiple users originating from the same ip address.\n\n#### Categorization\nMITRE ATT&CK\nName: Valid Accounts: Brute Force: Password Spraying\nID: T1110.003\nReference URL: https://attack.mitre.org/techniques/T1110/003/\n\n\n#### Strategy Abstract\nThis search detects Okta login failures due to bad credentials for multiple users originating from the same ip address.\n\n### Technical Context\nThe correlation searches for Okta events with outcome.reason=INVALID_CREDENTIALS. \nOnce the search has completed, we rename the Geo Location fields and obtain information about the first and last time of distinct users. \nThis data is these grouped together by the specificied fields of which the distinct count for user being greater than 5 will retrun results.  \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Okta events. \n\n#### False Positives\nApplication is providing inadequate logging\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nSysten Risk is set to 50\nPriority is a medium\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=okta outcome.reason=INVALID_CREDENTIALS | rename client.geographicalContext.country as country, client.geographicalContext.state as state, client.geographicalContext.city as city | stats min(_time) as firstTime max(_time) as lastTime dc(user) as distinct_users values(user) as users by src_ip, displayMessage, outcome.reason, country, state, city  | `security_content_ctime(firstTime)` | `security_content_ctime(lastTime)` |  search distinct_users > 5| `okta_multiple_users_with_auth_failures_from_ip_filter`","dispatch.earliest_time":"-70m@m","dispatch.latest_time":"-10m@m","cron_schedule":"0 * * * *","action.notable.param.rule_title":"Multiple Okta Users With Authentication Failures From from $src_ip$","action.notable.param.rule_description":"Multiple Users Failing Authenticaiton From $src_ip$","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related log entry","action.notable.param.drilldown_search":"index=okta outcome.reason=INVALID_CREDENTIALS src_ip=$src_ip$| stats  min(_time) as firstTime max(_time) as lastTime values(app) as Apps count by user, result ,displayMessage, src_ip, user_bunit  | `security_content_ctime(firstTime)`  | `security_content_ctime(lastTime)` | search * | sort firstTime","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"50","action.risk.param._risk_object":"system"}}
{"preview":false,"result":{"updated_time":"1625761686","updated":"2021-07-08","title":"Threat - Okta Admin Added Self To App - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Okta Admin Added Self To App","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 2/23/2021: Due to high noise level we removed notable alert action. The administrator user object will instead receive increase risk score of 50. \n\n#### Goal\nDetects when an Okta admin adds themselves to an Okta app. Runs every two hours on data from the last 2 hours. This could indicate an abuse of privileged Okta access or an account takeover attempt. These alerts should be investigated and triaged to “sysadminsplunkalert@zoom.us”.\n\n#### Categorization\nMITRE ATT&CK\nName: Valid Accounts: Cloud Accounts \nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n\n#### Strategy Abstract\nDetects when an Okta admin adds themselves to an Okta app. Runs every two hours on data from the last 2 hours. This could indicate an abuse of privileged Okta access or an account takeover attempt. These alerts should be investigated and triaged to “sysadminsplunkalert@zoom.us”.\n\n### Technical Context\nThe correlation searches for Okta events with event type application.user_membership.add. \nOnce the events have returned the target{}.alternateId is renamed/shortened. \nThe altID contains the user information and application information which is extracted into new fields for comparison. \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Okta events. \n\n#### False Positives\nApplication is providing inadequate logging\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nRisk of user is set to 50 for the Risk Analysis Dashboard\n\n#### Response\n\n#### Additional Resources\nEmail is sent to sysadminsplunkalert@zoom.us along with a notable. \n---","search":"index=okta sourcetype=OktaIM2:log eventType=\"application.user_membership.add\"\n| spath \"target{}.id\" \n| rename target{}.type as type target{}.alternateId as altId \n| eval app_user=mvindex(altId, 0) \n| eval okta_app=mvindex(altId, 1) \n| eval okta_user=mvindex(altId, 2)\n| eval result=lower(result)\n| rename actor as src_user\n| eval dest_user=okta_user\n| eval object=app_user\n| eval desc=user.\" added their account to the \".okta_app.\" Okta app.\"\n| where user=okta_user \n| table _time, user, desc","dispatch.earliest_time":"-135m@m","dispatch.latest_time":"-15m@m","cron_schedule":"0 */2 * * *","action.notable.param.rule_title":"Okta Admin Added Self To App","action.notable.param.rule_description":"Detects when an Okta admin adds themselves to an Okta app. Runs every two hours on data from the last 2 hours. This could indicate an abuse of privileged Okta access or an account takeover attempt. These alerts should be investigated and triaged to “sysadminsplunkalert@zoom.us”.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related Okta log entries","action.notable.param.drilldown_search":"index=okta sourcetype=OktaIM2:log eventType=\"application.user_membership.add\" | spath \"target{}.id\"  | rename target{}.type as type target{}.alternateId as altId  | eval app_user=mvindex(altId, 0)  | eval okta_app=mvindex(altId, 1)  | eval okta_user=mvindex(altId, 2) | eval result=lower(result) | rename actor as src_user | eval dest_user=okta_user | eval object=app_user | eval desc=user.\" added their account to the \".okta_app.\" Okta app.\" | where user=okta_user | search user=$user$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1625691147","updated":"2021-07-07","title":"Threat - Okta Suspicious App User Rename - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Okta Suspicious App User Rename","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 2/22/2021: Fixed search logic to filter on results where the acting Okta admin username matches the Okta username that is changed.\n\n#### Goal\nDetects when a privileged Okta admin renames an Okta user's application username. This could indicate an abuse of privileged Okta access.\n\n#### Categorization\nMITRE ATT&CK\nName: Valid Accounts: Cloud Accounts \nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n\n#### Strategy Abstract\nDetects when a privileged Okta admin renames an Okta user's application username. This could indicate an abuse of privileged Okta access.\n\n### Technical Context\nThe correlation searches for Okta events with event type application.user_membership.change_username and then excludes specific target{}.id. \nOnce the data set has returned, we shorten a field to altID and acting_user. \nWe then take the altID and seprate the values from altID by index value of 0,1, and 2. \nOnce we obtain the information from the indexed values to determine if the user=okta user and that the okta user != app_user. \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Okta events. \nThe ignored target{}.id are assumed to safe to ignore\n\n#### False Positives\nApplication is providing inadequate logging\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nPriority is set to Medium\n\n#### Response\n\n#### Additional Resources\nEmail is sent to sysadminsplunkalert@zoom.us along with a notable. \n---","search":"index=okta sourcetype=OktaIM2:log eventType=\"application.user_membership.change_username\" \n| spath \"target{}.id\" \n| search NOT (\"target{}.id\"=0oae2kxuu44bjIM7e356 OR \"target{}.id\"=0oaecjs88xjSQfGRI356 OR \"target{}.id\"=0oaeuq4b2YErAMfrh356 OR \"target{}.id\"=0oaf35mzsV1vnTlXI356 OR \"target{}.id\"=0oaf2wdjgIualm9Yc356 OR \"target{}.id\"=0oaf30697wsUXEffg356 OR \"target{}.id\"=0oaf371ssXzybF5eH356 OR \"target{}.id\"=0oaf28n7nq1og1E8W356 OR \"target{}.id\"=0oaf35lqpt0j60pN5356 OR \"target{}.id\"=0oaf7n4wkQ1ToyxnB356 OR \"target{}.id\"=0oahm1o63uV2MgCUK356 OR \"target{}.id\"=0oamgpn6z0ooNt2Iu356 OR \"target{}.id\"=0oan0n9rvDXmvRAEs356 OR \"target{}.id\"=0oan9cihnfQsP1TkJ356 OR \"target{}.id\"=0oa13qgywadYGs80a357 OR \"target{}.id\"=0oa1fyhdjqvvzSNXY357 OR \"target{}.id\"=0oa4ak5pb0QP3vJwL357) \n| rename target{}.alternateId as altId actor.alternateId as acting_user\n| eval app_user=mvindex(altId, 0) \n| eval okta_app=mvindex(altId, 1) \n| eval okta_user=mvindex(altId, 2) \n| eval result=lower(result)\n| eval desc=\"The user's \".okta_app.\" account was renamed to \".app_user\n| where okta_user!=app_user AND user=okta_user\n| table _time, user, okta_user, desc, result","dispatch.earliest_time":"-1h","dispatch.latest_time":"now","cron_schedule":"*/25 * * * *","action.notable.param.rule_title":"Okta Suspicious App User Rename","action.notable.param.rule_description":"Detects when a privileged Okta admin renames an Okta user's application username. This could indicate an abuse of privileged Okta access.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related log entries","action.notable.param.drilldown_search":"index=okta sourcetype=OktaIM2:log eventType=\"application.user_membership.change_username\"  | spath \"target{}.id\"  | search NOT (\"target{}.id\"=0oae2kxuu44bjIM7e356 OR \"target{}.id\"=0oaecjs88xjSQfGRI356 OR \"target{}.id\"=0oaeuq4b2YErAMfrh356 OR \"target{}.id\"=0oaf35mzsV1vnTlXI356 OR \"target{}.id\"=0oaf2wdjgIualm9Yc356 OR \"target{}.id\"=0oaf30697wsUXEffg356 OR \"target{}.id\"=0oaf371ssXzybF5eH356 OR \"target{}.id\"=0oaf28n7nq1og1E8W356 OR \"target{}.id\"=0oaf35lqpt0j60pN5356 OR \"target{}.id\"=0oaf7n4wkQ1ToyxnB356 OR \"target{}.id\"=0oahm1o63uV2MgCUK356 OR \"target{}.id\"=0oamgpn6z0ooNt2Iu356 OR \"target{}.id\"=0oan0n9rvDXmvRAEs356 OR \"target{}.id\"=0oan9cihnfQsP1TkJ356 OR \"target{}.id\"=0oa13qgywadYGs80a357 OR \"target{}.id\"=0oa1fyhdjqvvzSNXY357 OR \"target{}.id\"=0oa4ak5pb0QP3vJwL357)  | rename target{}.alternateId as altId actor.alternateId as acting_user | eval app_user=mvindex(altId, 0)  | eval okta_app=mvindex(altId, 1)  | eval okta_user=mvindex(altId, 2)  | eval result=lower(result) | eval desc=\"The user's \".okta_app.\" account was renamed to \".app_user | where okta_user!=app_user | search user=$user$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625689293","updated":"2021-07-07","title":"Threat - Okta Geographically Improbable Access - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"Okta Geographically Improbable Access","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- 2/25/2021: Excluded AWS workspace IPs (ZOOM-217764)\n\n#### Goal\nAdds risk score of 10 to users who are observed logging into Okta from two geographically distinct IP addresses to the Risk Analysis Dashboard.\n\n#### Categorization\nMITRE ATT&CK\nName: External Remote Services\nID: T1133\nReference URL: https://attack.mitre.org/techniques/T1133/\n\nName: Valid Accounts: Cloud Accounts \nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n\n#### Strategy Abstract\nAdds risk score of 10 to users who are observed logging into Okta from two geographically distinct IP addresses.\n\n#### Technical Context\nThe correlation searches for Successful Okta logins by Application that did not occur from WAN, Office, VPN, workspace ip addresses or accounts named support and developer.\nOnce the search is completed, geolocation fields within Splunk are renamed/shorten then validated for data. \nAfter the geo location is validated, the CS will perform a stats to obtain information about when successful application logins which is converted into unique keys. \nThis information is then passed to the eventstats to account for all login occurrences by user and aggregating the total logins by each user. \nIf a user has more than 1 successful login, the source geo information and event time is compared. \nIf the time and distance between the different successful logins match the alerting criteria a value of 10 is assign to the user pushing the information to the Risk Analysis Dashboard.  \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Okta events. \nNetwork information as such must be maintained. (src_category=wan OR src_category=office OR src_category=vpn OR src_category=workspace)\n\n#### False Positives\nMis-categorization of the WAN, Office, VPN or Workspace IP Addresses\n\n#### Validation\nRun Correlation Search for a defined period of time.\n\n#### Priority\nRisk of user is set to 10 for the Risk Analysis Dashboard\n\n#### Response\n\n#### Additional Resources\nRisk Score of 10 is assigned to user for the Risk Analysis Dashboard \n---","search":"index=okta displayMessage=\"User login to Okta\" action=success NOT user=support@zoom.us NOT user=developer@zoom.us NOT (src_category=wan OR src_category=office OR src_category=vpn OR src_category=workspace)\n| rename client.geographicalContext.geolocation.lon as src_long client.geographicalContext.geolocation.lat as src_lat client.geographicalContext.city as src_city client.geographicalContext.state as src_state client.geographicalContext.country as src_country \"target{}.displayName\" as application \n| eval src_ip=src \n| eval src_lat=if(isnotnull(src_lat),src_lat,lat),src_long=if(isnotnull(src_long),src_long,lon),src_city=case(isnotnull(src_city),src_city,isnotnull(City),City,1=1,\"unknown\"),src_country=case(isnotnull(src_country),src_country,isnotnull(Country),Country,1=1,\"unknown\")\n| stats earliest(application) as src_app,min(_time) as src_time by src,src_lat,src_long,src_city,src_state,src_country,user \n| fillnull value=\"null\" src_app, src_time, src_lat, src_long, src_city, src_state, src_country \n| eval key=src.\"@@\".src_time.\"@@\".src_app.\"@@\".src_lat.\"@@\".src_long.\"@@\".src_city.\"@@\".src_state.\"@@\".src_country \n| eventstats dc(key) as key_count,values(key) as key by user \n| search key_count>1 \n| stats first(src_app) as src_app,first(src_time) as src_time,first(src_lat) as src_lat,first(src_long) as src_long,first(src_city) as src_city,first(src_state) as src_state,first(src_country) as src_country by src,key,user \n| rex field=key \"^(?<dest>.+?)@@(?<dest_time>.+?)@@(?<dest_app>.+)@@(?<dest_lat>.+)@@(?<dest_long>.+)@@(?<dest_city>.+)@@(?<dest_state>.+)@@(?<dest_country>.+)\" \n| where src!=dest \n| eval key=mvsort(mvappend(src.\"->\".dest, NULL, dest.\"->\".src)),units=\"m\" \n| dedup key, user \n| `globedistance(src_lat,src_long,dest_lat,dest_long,units)` \n| eval speed=distance/(abs(src_time-dest_time+1)/3600) \n| where speed>=500 AND distance>=100\n| fields user,src_time,src_app,src,src_lat,src_long,src_city,src_state,src_country,dest_time,dest_app,dest,dest_lat,dest_long,dest_city,dest_state,dest_country,distance,speed","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"10","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1625670048","updated":"2021-07-07","title":"Access - Unknown Device Connected to GlobalProtect VPN - Rule","index":"paloaltocdl","datamodel":"N/A","product":"Palo Alto Networks","action.correlationsearch.label":"Unknown Device Connected to GlobalProtect VPN","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 7/6/21: Created search\n\n#### Goal\nThe goal of this alert is to detect non-zoom provisioned devices successfully connecting to Global Protect VPN.\n\n#### Categorization\nMITRE ATT&CK: T1133, T1078, T1210\n\n#### Strategy Abstract\nUnknown devices connecting to VPN poses a serious threat to the Zoom environment as it can indicate a perimeter breach.\n\n#### Technical Context\nThis alert detects successful Global Protect VPN connections from devices that don’t match the Zoom’s dvc naming convention ending in “ipa.zoomvideo.com”\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that paloaltocdl and paloalto_cn  events are available, consistent, and ingesting in a timely manner (< 10 minute delay). This use case doesn’t cover potential adversaries that are familiar with Zoom’s device field naming and manually altered to match.\n\n#### False Positives\nNo false positives known at the time, non-Zoom provisioned devices should not be accessing VPN under any circumstances.\n\n#### Validation\nValidate this alert by running the Splunk search and verifying that the dvc field doesn’t have the standard Zoom naming convention.\n\n#### Priority\nHigh\n\n#### Response\n\n#### Additional Resources\nN/A","search":"(index=paloaltocdl OR index=paloalto_cn) signature=\"globalprotectportal-auth-succ\" NOT regex dvc=\"^[a-zA-Z]+([+-]?(?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))(?:[eE]([+-]?\\d+))?-30-201([+-]?(?=\\.\\d|\\d)(?:\\d+)?(?:\\.?\\d*))(?:[eE]([+-]?\\d+))?ipa\\.zoomvideo\\.com$\"","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Unknown Device Connected to GlobalProtect VPN","action.notable.param.rule_description":"The goal of this alert is to detect non-zoom provisioned devices successfully connecting to Global Protect VPN.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625582573","updated":"2021-07-06","title":"Threat - REvil Ransomware - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"REvil Ransomware","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 06/07/2021: Created search\n\n#### Goal\nThe goal of this alert is to detect potential REvil Ransomware attempts.\n\n#### Categorization\nMITRE ATT&CK: T1059.001, T1548\n\n#### Strategy Abstract\nCasey VSA, a remote monitoring management software heavily used by managed service providers, was compromised by Revil, and being used to distribute ransomware to its on-premise customers. Since VSA requires elevated permissions to execute, an adversary was able to use it to disable Microsoft Defender and efficiently distribute the ransomware via endpoint agents. \n\n#### Technical Context\nThe search detects any attempts to disable Microsoft Defender technologies when the ransomware runs. It accomplishes this by issuing a PowerShell command to turn off these endpoint detection.\n\n#### Blind Spots and Assumptions\nThe search assumes we are currently ingesting Windows event logs and the  events are available, consistent, and ingesting in a timely manner (< 10 minute delay). \n\n#### False Positives\nHits on the search could be testing done by the cyber defense team but should be investigated promptly.\n\n#### Validation\n\n#### Priority\nHigh\n\n#### Response\n\n\n#### Additional Resources\nhttps://www.splunk.com/en_us/blog/security/kaseya-sera-what-revil-shall-encrypt-shall-encrypt.html","search":"source=\"WinEventLog:Microsoft-Windows-PowerShell/Operational\"\n| search Message=\"*Set-MpPreference -Disable* $true* -Disable* $true*\"\n| table _time, host, Message","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"REvil Ransomware","action.notable.param.rule_description":"The search detects any attempts to disable Microsoft Defender technologies when the ransomware runs. It accomplishes this by issuing a PowerShell command to turn off these endpoint detection.","action.notable.param.security_domain":"threat","action.notable.param.severity":"critical","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1625254410","updated":"2021-07-02","title":"Network - Palo Alto Sunburst Activity Detected - Rule","index":"N/A","datamodel":"Intrusion_Detection","product":["Aruba Airwave","Palo Alto Networks","Webnginx App Protect"],"action.correlationsearch.label":"Palo Alto Sunburst Activity Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- Pre 07/01 - Correlation Search Creation\n\n#### Goal\nDetects activity associated with Solarwinds/Sunburst incident on Palo Alto firewalls using built-in signatures.\n\n#### Categorization\nMITRE ATT&CK\nName: Network Intrusion Prevention \nID: M1031\nReference URL: https://attack.mitre.org/mitigations/M1031/\n\n\n#### Strategy Abstract\nDetects activity associated with Solarwinds/Sunburst incident on Palo Alto firewalls using built-in signatures.\n\n#### Technical Context\nThe correlation searches for paloalto events with the Solarwinds/Sunburst signature. \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of paloalto events. Additionally paloalto network traffic is only available for systems connected to the VPN and servers held within the datacenters. \n\n#### False Positives\nPotential legitimate connections created with activity that mimics a paloalto signature. \n\n#### Validation\n\n#### Priority\nThis alert should be critical severity.\n\n#### Response\n\n#### Additional Resources\n\n---","search":"| from datamodel:\"Intrusion_Detection.IDS_Attacks\"\n| search signature=\"*sunburst*\"","dispatch.earliest_time":"-20m","dispatch.latest_time":"-5m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"Palo Alto Sunburst Activity Detected","action.notable.param.rule_description":"Detects activity associated with Solarwinds/Sunburst incident on Palo Alto firewalls using built-in signatures.","action.notable.param.security_domain":"network","action.notable.param.severity":"critical","action.notable.param.drilldown_name":"View related logs","action.notable.param.drilldown_search":"index=paloalto_cn sourcetype=\"pan:threat\" signature=\"SUNBURST*\" src=$src$","action.risk.param._risk_object_type":"system","action.risk.param._risk_score":"25","action.risk.param._risk_object":"src"}}
{"preview":false,"result":{"updated_time":"1625250167","updated":"2021-07-02","title":"Network - Palo Alto Packet High Volume Packet Flood Detected - Rule","index":"paloalto","datamodel":"N/A","product":"Palo Alto Networks","action.correlationsearch.label":"Palo Alto Packet High Volume Packet Flood Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 07/01/2021 - Official ADS Framework Creation \n- Pre 07/01 - Correlation Search Creation\n\n#### Goal\nThis goal of this use-case is to detect an unusually high count of TCP/UDP/ICMP flood Palo Alto signatures destined to a Zoom IP. Searches for activity in the last hour based on statistics from the last 7 days.\n\n#### Categorization\nMITRE ATT&CK\nName: Network Intrusion Prevention \nID: M1031\nReference URL: https://attack.mitre.org/mitigations/M1031/\n\nName: Network Denial of Service\nID: T1498.001\nReference URL: https://attack.mitre.org/techniques/T1498/001/\n\n\n#### Strategy Abstract\nCorrelation is searching for allowed paloalto firewall events with signatures of critical and high severity.\n\n#### Technical Context\nThe correlation searches for paloalto events that are of critical and high severity grouping by destination and signature for the last 7 days running every hour at the 29th minute mark. \nDuring this time, the correlation is baselining the average occurence of signature by destination and the standard deviation of occurrences for the last 7 days. \nTo create an actionable event, a stats count of the last hour is compared to the last 7 days average plus 4 times the standard deviation. \nIf the current count is greater than the comparison to the last 7 days plus the standard deviation, we calculate the current hourly standard deviation. \nOnce all the calculations have been completed, we return a table with the matching data.  \n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of paloalto events. Additionally paloalto network traffic is only available for systems connected to the VPN and servers held within the datacenters. \n\n#### False Positives\nPotential legitimate connections created with activity that mimics a paloalto signature. \n\n#### Validation\n \n\n#### Priority\nThis alert should be medium severity.\n\n#### Response\n\n#### Additional Resources\n\n---","search":"index=paloalto sourcetype=\"pan:threat\" (severity=critical OR severity=high) action=allowed NOT dest=0.0.0.0\n| fields dest, signature\n| bucket span=1h _time\n| stats count as failed_attempts by _time, dest, signature\n| eventstats avg(failed_attempts) as failed_attempts_avg, stdev(failed_attempts) as failed_attempts_stdev\n| eval threshold_value = 4 \n| eval isOutlier=if(failed_attempts > failed_attempts_avg+(failed_attempts_stdev * threshold_value), 1, 0) \n| search isOutlier=1 AND _time >= relative_time(now(), \"-70m@m\")\n| eval num_standard_deviations_away = round(abs(failed_attempts - failed_attempts_avg) / failed_attempts_stdev, 2)\n| table _time, dest, signature, failed_attempts, failed_attempts_avg, failed_attempts_stdev, num_standard_deviations_away","dispatch.earliest_time":"-7d","dispatch.latest_time":"now","cron_schedule":"29 * * * *","action.notable.param.rule_title":"Palo Alto Packet High Volume Packet Flood Detected","action.notable.param.rule_description":"This will detect an unusually high count of TCP/UDP/ICMP flood Palo Alto signatures destined to a Zoom IP. Searches for activity in the last hour based on statistics from the last 7 days.","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related Palo Alto logs","action.notable.param.drilldown_search":"index=paloalto sourcetype=\"pan:threat\" dest=$dest$","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1624906603","updated":"2021-06-28","title":"Threat - Suspicious Creation of Linux Accounts - Rule","index":"os","datamodel":"N/A","product":"Linux OS","action.correlationsearch.label":"Suspicious Creation of Linux Accounts","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 6/28/2021: Created search\n\n#### Goal\nThe goal of this alert is to detect any suspicious Linux Local user accounts being created without the proper request/approval process\n\n#### Categorization\nMITRE ATT&CK: TA0001, TA0003, TA0008, TA0011\n\n#### Strategy Abstract\nLocal Linux account should not be created without the proper request and approval process. All new hire s account setup is done via HappyDesk and any other authorized user account creation is handled via Jira.\n\n\n#### Technical Context\nThis alert detects successful account creation or deletion in the linux_secure environment. Allowlisted accounts have been added to a lookup table and have been excluded from the search.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that OS linux_secure events are available, consistent, and ingesting in a timely manner (< 10 minute delay). \n\n#### False Positives\nAccount that have been recently given permission to perform accountadd/accountdel in the Linux environment and haven’t been added to the allow list will trigger false positive alerts.\n\n#### Validation\nValidate this alert by cross referencing the user that created the account with the lookup table valid_linux_users, and further investigate if the user isn’t part of the allow list.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\nN/A","search":"index=os sourcetype=linux_secure object_category=user (process=useradd OR process=userdel) user!=inputlookup\"valid_linux_users\"\n| rex field=_raw \"name=(?<user>[^,]*)\" \n| search NOT (user IN (\"centos\",\"ktang\",\"opc\"))\n| bucket _time span=4h\n| stats values(UID) as uid values(process) as process dc(process) as process_count count by user, src, _time\n| where process_count>1","dispatch.earliest_time":"-10m","dispatch.latest_time":"now","cron_schedule":"*/10 * * * *","action.notable.param.rule_title":"Suspicious Creation of Linux Account","action.notable.param.rule_description":"The goal of this alert is to detect any suspicious Linux Local user accounts being created without the proper request/approval process","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1624313274","updated":"2021-06-21","title":"Threat - Detect Palo Alto GlobalConnect VPN Login From High Severity IP - Rule","index":"paloaltocdl","datamodel":"N/A","product":"Palo Alto Networks","action.correlationsearch.label":"Detect Palo Alto GlobalConnect VPN Login From High Severity IP","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 03/23/2021: Added \"paloalto_cn\" index for China VPN location event logs.\n- 06/10/2021: Added ADS documentation\n\n#### Goal\nThe goal of this use case is to detect when a Palo Alto GlobalConnect VPN client connection is sourcing from an IP address that ThreatStream has identified as a high severity IOC.\n\n#### Categorization\nMITRE ATT&CK\nName: Initial Access/External Remote Services\nID: T1133\nReference URL: https://attack.mitre.org/techniques/T1133/\n\n#### Strategy Abstract\nCurrently leveraging Palo Alto VPN global auth connections from devices where the destination IP matches a High Severity ThreatStream IOC.\n\n#### Technical Context\nThe correlation search looks at (index=paloaltocdl OR index=paloalto_cn) signature=\"globalprotectportal-auth-succ\" and maps the src field to 'ts_lookup_srcip_2' for matches.  If there are any matches, a notable will be created.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of Carbon Black events, and that our ThreatStream IOC feed has been curated for actionable intel.\n\n#### False Positives\nPotential legitimate connections made to previously \"bad\" IP's may trigger false positives due to multiple domains sometimes being associated with the same IP address.  Intel could also be stale.\n\n#### Validation\nThe correlation search can be validated by running the search over the last day based on the user's device as well as connecting to Carbon Black to investigate directly.\n\n#### Priority\nThis alert should be high severity.\n\n#### Response\nReview logs for the last 7 days that are associated with either the user or the device owned by the user.  Also review activity associated with user's device directly from Carbon Black.\n\n#### Additional Resources\n\n---","search":"(index=paloaltocdl OR index=paloalto_cn) signature=\"globalprotectportal-auth-succ\" \n| fields user, src_ip, action, severity \n| eval severity_lookup=\"high\" \n| lookup ts_lookup_srcip_2 srcip as src_ip severity as severity_lookup OUTPUT severity as ts_severity, itype as threat_source_type, confidence as ts_confidence, source as threat_collection, org as threat_group \n| search ts_severity=high \n| eval desc=\"ThreatStream has identified \".src.\" as a \".ts_severity.\" severity IP with \".ts_confidence.\"% confidence.\" \n| fields - severity_lookup, ts* | `palo_alto_globalprotect_login_from_high_severity_ip_filter`","dispatch.earliest_time":"-20m","dispatch.latest_time":"-5m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"Detect Palo Alto GlobalConnect VPN Login From High Severity IP","action.notable.param.rule_description":"Detects a Palo Alto GlobalConnect VPN client connection sourcing from an IP address that ThreatStream has identified as a high severity IOC.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View related log entry","action.notable.param.drilldown_search":"index=paloaltocdl signature=\"globalprotectportal-auth-succ\" user=$user$ src_ip=$src_ip$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1623782860","updated":"2021-06-15","title":"Threat - OP Superadmin adding or editing OP Users - Rule","index":"op","datamodel":"N/A","product":"Zoom Operation","action.correlationsearch.label":"OP Superadmin adding or editing OP Users","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/29/2021: Initial Release\nUse case requested by Gary Chan \n\n#### Goal\nThe goal of this alert is to monitor for and alert on OP super admin users adding or editing OP users.\n\n\n#### Categorization\nMITRE ATT&CK: TA0042\n\n#### Strategy Abstract\nThe search logic is querying the OP index, opaudit source type for opRole=superadmin action=addOPUser OR action=editOPUser\n\n#### Technical Context\nOP super admin privileged accounts should not be adding or editing OP users even though they have the permissions.\n\n#### Blind Spots and Assumptions\nThe alert assumes the OP index is up and no logs are missing.\n\n#### False Positives\nFalse positives in this case can be categorized as policy violation\n\n#### Validation\nThe SOC should ensure that the super admin account logged in belongs to a known individual with elevated privileges.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\n","search":"index=op sourcetype=opaudit opRole=superadmin action=\"addOPUser\" OR action=\"editOPUser\" OR action=deleteOPUser\n| rename opEmail as user, sourceIp as src","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"OP Superadmin Add/Edit OP Users","action.notable.param.rule_description":"The use case alerts on OP superadmin adding or editing OP users","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623777597","updated":"2021-06-15","title":"Threat - OP Superadmin Access Granted - Rule","index":"op","datamodel":"N/A","product":"Zoom Operation","action.correlationsearch.label":"OP Superadmin Access Granted","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/29/2021: Initial Release\nUse case requested by Gary Chan \n\n#### Goal\nThe goal of this alert is to monitor for and alert on OP super admin users adding or editing OP users.\n\n\n#### Categorization\nMITRE ATT&CK: TA0042\n\n#### Strategy Abstract\nThe search logic is querying the OP index, opaudit source type for action=\"approveSuperAdmin\" \n\n#### Technical Context\nSOC should be alerted when  OP super admin permissions have been granted.\n\n#### Blind Spots and Assumptions\nThe alert assumes the OP index is up and no logs are missing.\n\n#### False Positives\nNo known false positives exists for this use case.\n\n#### Validation\nThe SOC should ensure that the super admin account is being granted to a user with the proper request/approvals.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\n","search":"index=op sourcetype=opaudit action=\"approveSuperAdmin\" \n| rename opEmail as user, sourceIp as src","dispatch.earliest_time":"-7min","dispatch.latest_time":"-2min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"OP Superadmin Access Granted","action.notable.param.rule_description":"This use case alerts on OP superadmin access granted","action.notable.param.security_domain":"threat","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623777534","updated":"2021-06-15","title":"Access - OP SuperAdmin Login by Password - Rule","index":"op","datamodel":"N/A","product":"Zoom Operation","action.correlationsearch.label":"OP SuperAdmin Login by Password","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/29/2021: Initial Release\nUse case requested by Gary Chan \n\n#### Goal\nThe goal of this alert is to monitor for and alert on OP super admin users login by password bypassing Okta MFA.\n\n#### Categorization\nMITRE ATT&CK: TA0001\n\n#### Strategy Abstract\nThe search logic is querying the OP index, opaudit source type for action=loginByPassword\n\n#### Technical Context\nOP super admin privileged accounts should be strictly prohibited from login by password. Logins should always be via Okta MFA.\n\n#### Blind Spots and Assumptions\nThe alert assumes the OP index is up and no logs are missing.\n\n#### False Positives\nFalse positives in this case can be categorized as policy violation\n\n#### Validation\nThe SOC should ensure that the super admin account logged in belongs to a known individual with elevated privileges.\n\n#### Priority\nMedium\n\n#### Response\n\n#### Additional Resources\n","search":"index=op sourcetype=opaudit opRole=superadmin moudle=Login action!=loginFromOkta action=loginByPassword\n| rename opEmail as user, sourceIp as src","dispatch.earliest_time":"-7min","dispatch.latest_time":"-2min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"OP Superadmin MFA Bypass Login","action.notable.param.rule_description":"This use cases alerts on OP superadmin users login in by password instead of Okta MFA","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623777302","updated":"2021-06-15","title":"Threat - OP Access Control Parameter Changes - Rule","index":"op","datamodel":"N/A","product":"Zoom Operation","action.correlationsearch.label":"OP Access Control Parameter Changes","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/29/2021: Initial Release\nUse case requested by Gary Chan \n\n#### Goal\nThe goal of this use case is to monitor for OP access controls parameters changes.\n\n\n#### Categorization\nMITRE ATT&CK: TA0003\n\n#### Strategy Abstract\nThe search logic is querying the OP index, opaudit source type for action=\"saveOPUserPwdRule\" OR action=\"saveOPSessionExpiryTime\" OR action=\"saveOPUserLockRule\"\n\n#### Technical Context\nRecords and reports of access controls changes should be kept for audit purposes.\n\n#### Blind Spots and Assumptions\nThe alert assumes the OP index is up and no logs are missing.\n\n#### False Positives\nNo known false positives exists for this use case.\n\n#### Validation\n\n#### Priority\nMedium\n\n#### Response\nNo SOC response required at this time, report will be emailed to Gary directly.\n\n#### Additional Resources\n","search":"index=op sourcetype=opaudit action=\"saveOPUserPwdRule\" OR action=\"saveOPSessionExpiryTime\" OR action=\"saveOPUserLockRule\"\n| rename opEmail as user, sourceIp as src","dispatch.earliest_time":"-7min","dispatch.latest_time":"-2min","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623158855","updated":"2021-06-08","title":"Threat - Break-glass account use detected - Rule","index":"os","datamodel":"N/A","product":"Linux OS","action.correlationsearch.label":"Break-glass account use detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 2/15/2021: Search created\n-06/08/2021: ADS documentation added\n\n#### Goal\nThe goal of this use case is to detect the use of break-glass local Linux account\n\n#### Categorization\nMITRE ATT&CK: T1078\n\n#### Strategy Abstract\nThe break-glass local Linux account should only be used in emergency situations. Any detected use that is not already called out by Zak Pierce and the Engineering Operations team should be vetted with them and investigated if unexpected.\n\n#### Technical Context\nThis alert detects users login or ssh into the break glass user account.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that os index events are available, consistent, and ingesting in a timely manner (< 10 minute delay). \n\n#### False Positives\nAlert triggered could be intended activity but must be confirmed with the engineering operations team.\n\n#### Validation\nAny detected use that is not already called out by Zak Pierce and the Engineering Operations team should be vetted with them and investigated if unexpected.\n\n#### Priority\nMedium\n\n#### Response\nThe SOC should confirm with engineering operations whether the use of break-glass account was to be expected and further investigations is necessary of not.\n\n#### Additional Resources\nN/A\n","search":"index=os user=break-glass (app=login OR app=sshd)","dispatch.earliest_time":"-16m","dispatch.latest_time":"-1m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"Break-glass account use detected on $dest$","action.notable.param.rule_description":"The break-glass local Linux account should only be used in emergency situations. Any detected use that is not already called out by Zak Pierce and the Engineering Operations team should be vetted with them and investigated if unexpected.","action.notable.param.security_domain":"access","action.notable.param.severity":"critical","action.notable.param.drilldown_name":"View break-glass authentication logs","action.notable.param.drilldown_search":"index=os user=break-glass (app=login OR app=sshd)","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623157975","updated":"2021-06-08","title":"ESCU - Abnormally High AWS Instances Launched by User - MLTK - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"Abnormally High AWS Instances Launched by User - MLTK","author":"admin","disabled":"0","description":"#### Release Notes\n- 05/18/2021: Added ADS documentation\n\n#### Goal\nThe goal of this alert is to detect users successfully launching high number of AWS instances\n#### Categorization\nMITRE ATT&CK: TA0042\n\n#### Strategy Abstract\nLarge number of AWS instances launched by a single user over a short span of time should be promptly investigated as this can indicate an adversary attempting to create resources to gain persistence.\n\n#### Technical Context\nThis alert detects successful AWS instance creations over a 10 minute timeframe. It searches in the was index with cloud trail sourctype and event name RunInstances. It tables the events by instances launched by the source users.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nAlert triggered could also be legitimate AWS admin activity.\n\n#### Validation\nValidate this alert by cross referencing the Ads account ID with the user and ensuring they have the proper request/approval to launch the instances.\n#### Priority\nMedium\n\n#### Response\nThe account and user in question should be investigated further for suspicious activity. It may be necessary to interview the end user to understand the need behind creating the instances in a short amount of time.\n\n#### Additional Resources\nN/A","search":"index=aws sourcetype=aws:cloudtrail eventName=RunInstances errorCode=success \n| bucket span=10m _time \n| stats count as instances_launched by _time src_user \n| apply ec2_excessive_runinstances_v1 \n| rename \"IsOutlier(instances_launched)\" as isOutlier \n| where isOutlier=1","dispatch.earliest_time":"-70m@m","dispatch.latest_time":"-10m@m","cron_schedule":"*/10 * * * *","action.notable.param.rule_title":"High Number of AWS instances launched by $src_user$","action.notable.param.rule_description":"An abnormally high number of instances were launched by a user within in a 10-minute window","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"30","action.risk.param._risk_object":"src_user"}}
{"preview":false,"result":{"updated_time":"1623097657","updated":"2021-06-07","title":"Threat - Access - CSMS - Use of EXTEND_POLICY_SAVE detected - Rule","index":"csms","datamodel":"N/A","product":"Cloud Secrets Management Server","action.correlationsearch.label":"Access - CSMS - Use of EXTEND_POLICY_SAVE detected","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/25/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect when a user runs the \"Extend Policy Save\" command in CSMS.  This effectively grants universal AWS permissions to anyone with CSMS permissions.\n\n#### Categorization\nMITRE ATT&CK\nName: Valid Accounts: Cloud Accounts\nID: T1078.004\nReference URL: https://attack.mitre.org/techniques/T1078/004/\n\n#### Strategy Abstract\nCurrently ingesting CSMS data in splunk as index=csms.  The use case will create an alert that should be sent to the SOC for triage.\n\n#### Technical Context\nThe correlation search filters based on the \"EXTEND_POLICY_SAVE\" event in csms.  This event effectively grants universal AWS permissions to anyone with CSMS access.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of CSMS events.\n\n#### False Positives\nNone - this should not be taking place.\n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days against the CSMS index.\n\n#### Priority\nThis alert is high severity.\n\n#### Response\nContact John Zila and Daniel Klein for review.\n\n#### Additional Resources\nN/A\n\n---","search":"index=csms \n| rex field=message mode=sed \"s/CSMS Audit Log>>>>>//\" \n| fields _time index source sourcetype message \n| spath input=message \n| spath input=input \n| spath input=output\n| search action=EXTEND_POLICY_SAVE result=false","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m@m","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623095833","updated":"2021-06-07","title":"Threat - AWS Endgame Tool Use Detected - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Endgame Tool Use Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 06/07/2021: Added ADS documentation\n- 2/18/2021: Search created\n\n#### Goal\nDetects the use of the AWS Endgame penetration testing tool by alerting on the tool's default user agent \"HotDogsAreSandwiches\". The tool can be used alongside a compromised AWS credential to alter AWS resource permissions enmasse. More details here: [https://endgame.readthedocs.io/en/latest/](https://endgame.readthedocs.io/en/latest/) \n\n#### Categorization\nMITRE ATT&CK: TA0011, TA0040\n\n#### Strategy Abstract\nThe AWS endgame tool should not be used outside of red team activity. Alerts triggered should be immediately validated with the red team to ensure that they were performing a penetration testing exercise.\n\n#### Technical Context\nThis alert detects any activity coming from the endgate tool’s default user agent HotDOgsAreSandwiches, running every 15min against the was index and was:cloudtrail source type.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nFalse positives of this use case would indicate the red team performing a penetration test against the cloud environment.\n\n#### Validation\nIf triggered, the SOC should immediately contact the red team to confirm that they are the ones that performed the activity under the user agent HotDogsAreSandwiches.\n\n#### Priority\nMedium\n\n#### Response\nSOC should immediately contact the red team to confirm that they are the ones that performed the activity under the user agent HotDogsAreSandwiches.\n\n#### Additional Resources\nhttps://endgame.readthedocs.io/en/latest/","search":"index=aws sourcetype=aws:cloudtrail userAgent=HotDogsAreSandwiches","dispatch.earliest_time":"-16m","dispatch.latest_time":"-1m","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"AWS Endgame Tool Use Detected from $src$","action.notable.param.rule_description":"Detects the use of the AWS Endgame penetration testing tool by alerting on the tool's default user agent \"HotDogsAreSandwiches\". The tool can be used alongside a compromised AWS credential to alter AWS resource permissions enmasse.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View AWS CloudTrail logs","action.notable.param.drilldown_search":"index=aws sourcetype=aws:cloudtrail userAgent=HotDogsAreSandwiches","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1623094730","updated":"2021-06-07","title":"Threat - AWS Detect Suspicious Secrets Manager API Activity - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Detect Suspicious Secrets Manager API Activity","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"AWS Detect Suspicious Secrets Manager API Activity\n\n#### Release Notes\n- 06/107/2021: Added ADS documentation\n\n#### Goal\nThis detection searches for suspicious AWS IAM secrets manager API access based on non-SDK browser agent types. This was created as a result of incident Zoom-214341 (JIRA). \n\n#### Categorization\nMITRE ATT&CK: TA0001, TA0004\n\n#### Strategy Abstract\nThis use case stemmed from incident ZOOM-214341 where Offensive Security discovered a critical vulnerability that affects Zoom’s AWS components. An attacker can abuse link preview image caching in a server-side request forgery attack leading to significant compromise of Zoom’s AWS environments (confidentiality, integrity, and availability are all highly impacted). The root cause of this issue stems from multiple flaws in the design, implementation, and deployment of the link preview feature.\n\n#### Technical Context\nWhen users share links to various pages and articles that support the Open Graph Protocol, Zoom chat will conveniently attempt to display this metadata to the participants of the conversation. An example of this feature in action can be replicated by simply sending a news article in a Zoom chat conversation.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nAPI activity from a secrets manager account can be legitimate despite originating from non-SDK type browser agent, but events should be validated by SOC analyst.\n\n#### Validation\nValidate this alert by running the Splunk search without the office, vpn, AWS workspace exclusions, and the where speed>=85 filter. Results should display based on users who have logged in from home and office/vpn IP addresses.\n\n#### Priority\nMedium\n\n#### Response\nThe account and user in question should be investigated further for suspicious activity. It may be necessary to interview the end user to understand the reason the API call was performed outside of a SDK based browser.\n\n#### Additional Resources\nhttps://zoomvideo.atlassian.net/browse/ZOOM-214341","search":"index=aws sourcetype=\"aws:cloudtrail\" eventType=AwsApiCall eventSource=\"secretsmanager.amazonaws.com\" eventName=\"GetSecretValue\" requestParameters.secretId=\"prod/*\" NOT (userAgent=ssm.amazonaws.com OR userAgent=*aws-sdk*)","dispatch.earliest_time":"-1h","dispatch.latest_time":"now","cron_schedule":"*/15 * * * *","action.notable.param.rule_title":"AWS Detect Suspicious Secrets Manager API Activity","action.notable.param.rule_description":"This detection searches for suspicious AWS IAM secrets manager API access based on non-SDK browser agent types. This was created as a result of incident Zoom-214341 (JIRA). This alert must be escalated to tier 3 IR.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View related log entries","action.notable.param.drilldown_search":"index=aws sourcetype=\"aws:cloudtrail\" eventType=AwsApiCall eventSource=\"secretsmanager.amazonaws.com\" src=$src$ eventName=\"GetSecretValue\" requestParameters.secretId=\"prod/*\" NOT (userAgent=ssm.amazonaws.com OR userAgent=*aws-sdk*)","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1621958226","updated":"2021-05-25","title":"ESCU - AWS Cross Account Activity From Previously Unseen Account - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Cross Account Activity From Previously Unseen Account","author":"admin","disabled":"0","description":"#### Release Notes\n- 05/25/2021: Add ADS Documentation\n\n#### Goal\nThe goal of this use case is to search for AssumeRole events where an IAM role in a different account is requested for the first time.\n\n#### Categorization\nMITRE ATT&CK: TA0001\n\n#### Strategy Abstract\nThe search logic is querying AWS Cloudtrail logs for assume role events on an IAM role to a different account that was initially granted access to.\n\n#### Technical Context\nBy definition IAM accounts/role should have limited access that was initially granted and any new request/access to different accounts should be investigated.\n\n#### Blind Spots and Assumptions\nThe alert assumes all AWS account CloudTrail logs are ingested and available in Splunk.\n\n#### False Positives\nFalse positives include legitimate IAM accounts with properly request/approval of account access.\n\n#### Validation\nThe validation process would be to confirm the IAM account is permitted to access the new requested role.\n\n#### Priority\nMedium\n\n#### Response\nAs part of the response procedure, the SOC should confirm that the IAM account triggering the alert has gone thought the proper access request/approval process to access new resources.\n\n#### Additional Resources\n","search":"index=aws sourcetype=aws:cloudtrail eventName=AssumeRole \n| spath output=requestingAccountId path=userIdentity.accountId \n| spath output=requestedAccountId path=resources{}.accountId \n| search requestingAccountId=* \n| where requestingAccountId != requestedAccountId \n| inputlookup append=t previously_seen_aws_cross_account_activity \n| multireport \n    [| stats min(eval(coalesce(firstTime, strptime(_time,\"%Y-%m-%d %H:%M:%S\")))) as firstTime max(eval(coalesce(strptime(_time,\"%Y-%m-%d %H:%M:%S\"), lastTime))) as lastTime by requestingAccountId, requestedAccountId \n    | outputlookup previously_seen_aws_cross_account_activity \n    | where fact=fiction] \n    [| eventstats min(eval(coalesce(firstTime, strptime(_time,\"%Y-%m-%d %H:%M:%S\")))) as firstTime, max(eval(coalesce(strptime(_time,\"%Y-%m-%d %H:%M:%S\"), lastTime))) as lastTime by requestingAccountId, requestedAccountId \n    | where firstTime >= relative_time(now(), \"-70m@m\") AND isnotnull(_time) \n    | spath output=accessKeyId path=responseElements.credentials.accessKeyId \n    | spath output=requestingARN path=resources{}.ARN \n    | stats values(awsRegion) as awsRegion values(firstTime) as firstTime values(lastTime) as lastTime values(sharedEventID) as sharedEventID, values(requestingARN) as src_user, values(responseElements.assumedRoleUser.arn) as dest_user by _time, requestingAccountId, requestedAccountId, accessKeyId] \n| table _time, firstTime, lastTime, src_user, requestingAccountId, dest_user, requestedAccountId, awsRegion, accessKeyId, sharedEventID","dispatch.earliest_time":"-70m@m","dispatch.latest_time":"-10m@m","cron_schedule":"5 * * * *","action.notable.param.rule_title":"AWS Account $dest_user$ access by $src_user$","action.notable.param.rule_description":"Access to $dest_user$ was requested for the first time by $src_user$","action.notable.param.security_domain":"network","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"20","action.risk.param._risk_object":"dest_user"}}
{"preview":false,"result":{"updated_time":"1621274372","updated":"2021-05-17","title":"Threat - AWS Console Geographically Improbable Access - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Console Geographically Improbable Access","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/17/2021: Added ADS documentation\n- 12/18/2020: Created search\n\n#### Goal\nThe goal of this alert is to detect unauthorized use of privileged AWS console accounts by internal or external actors through the use of geodata.\n\n#### Categorization\nMITRE ATT&CK: T1078, T1078.004\n\n#### Strategy Abstract\nAWS console access should not normally source from more than one geographically distinct IP addresses (with the exception of authentication behind Zoom VPN). AWS console authentication sourcing from two geographically distinct IPs (e.g. US and Lithuania) may indicate account compromise or account sharing by internal employees.\n\n#### Technical Context\nThis alert detects successful AWS Console access sourcing from two geographically distant source IP addresses in an hour time window. The search uses Splunk's built \"iplocation\" command to get the source IP's city, state, county, and geocoordinates. These fields are then used to calculate amount of time, distance, and speed that occurred between authentication attempts. The alert triggers when authentication attempts occur at a speed >= 85 MPH.\n\n#### Blind Spots and Assumptions\nThis correlation search assumes that AWS CloudTrail events are available, consistent, and ingesting in a timely manner (< 10 minute delay). As a result of the 2022 Q1 AWS Epics, all Zoom AWS accounts should be configured for CloudTrail. Blind spots may exist if new AWS accounts are introduced and not properly configured for CloudTrail and logging to Splunk.\n\n#### False Positives\nSplunk's iplocation command can occasionally provide an out-of-date or inaccurate IP to geo location lookup. The IP's true location should be validated using Whois-ARIN or ThreatStream. A false positive may also trigger if a user authenticates from a personal VPN service or if a new VPN IP address/range is added to Zoom.\n\n#### Validation\nValidate this alert by running the Splunk search without the office, vpn, AWS workspace exclusions, and the where speed>=85 filter. Results should display based on users who have logged in from home and office/vpn IP addresses.\n\n#### Priority\nMedium\n\n#### Response\nThe account and user in question should be investigated further for suspicious activity. It may be necessary to interview the end user to understand if the geographically distant IP source authentication attempts are expected or if they are sharing their account credentials.\n\n#### Additional Resources\nN/A","search":"index=aws sourcetype=\"aws:cloudtrail\" tag=authentication eventName=ConsoleLogin action=success NOT (src_category=office OR src_category=vpn OR src_category=workspace)\n| eval src_time=_time \n| eval src_ip=src \n| iplocation src \n| search (src_lat=* src_long=*) OR (lat=* lon=*) \n| eval src_lat=if(isnotnull(src_lat),src_lat,lat),src_long=if(isnotnull(src_long),src_long,lon),src_city=case(isnotnull(src_city),src_city,isnotnull(City),City,1=1,\"unknown\"),src_country=case(isnotnull(src_country),src_country,isnotnull(Country),Country,1=1,\"unknown\") \n| stats earliest(sourcetype) as src_app,min(src_time) as src_time by src,src_lat,src_long,src_city,src_country,user \n| fillnull value=\"null\" src_app, src_time, src_lat, src_long, src_city, src_country \n| eval key=src.\"@@\".src_time.\"@@\".src_app.\"@@\".src_lat.\"@@\".src_long.\"@@\".src_city.\"@@\".src_country \n| eventstats dc(key) as key_count,values(key) as key by user \n| search key_count>1 \n| stats first(src_app) as src_app,first(src_time) as src_time,first(src_lat) as src_lat,first(src_long) as src_long,first(src_city) as src_city,first(src_country) as src_country by src,key,user \n| rex field=key \"^(?<dest>.+?)@@(?<dest_time>.+?)@@(?<dest_app>.+)@@(?<dest_lat>.+)@@(?<dest_long>.+)@@(?<dest_city>.+)@@(?<dest_country>.+)\" \n| where src!=dest \n| eval key=mvsort(mvappend(src.\"->\".dest, NULL, dest.\"->\".src)),units=\"m\" \n| dedup key, user \n| `globedistance(src_lat,src_long,dest_lat,dest_long,units)` \n| eval speed=distance/(abs(src_time-dest_time+1)/3600)\n| where speed>=85\n| fields user,src_time,src_app,src,src_lat,src_long,src_city,src_country,dest_time,dest_app,dest,dest_lat,dest_long,dest_city,dest_country,distance,speed \n| eval _time=now()","dispatch.earliest_time":"-12h","dispatch.latest_time":"now","cron_schedule":"18 * * * *","action.notable.param.rule_title":"AWS Console Geographically Improbable Access","action.notable.param.rule_description":"Detects successful AWS Console access sourcing from two geographically separated source IP addresses in an hour time window. Splunk's iplocation command can occasionally provide an out-of-date IP to geo location. The IP's true location should be validated using Whois-ARIN or ThreatStream.","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"20","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1621015478","updated":"2021-05-14","title":"Access - AWS Root Account Use Detected - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Root Account Use Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 04/20/2021: Add MFA login to search\n\n#### Goal\nThe goal of this alert is to monitor for and alert on potentially malicious or unauthorized use of an AWS root accounts.\n\n#### Categorization\nMITRE ATT&CK: T1078\n\n#### Strategy Abstract\nThe search logic is querying AWS Cloudtrail logs for root account use of the AWS API or AWS web console.\n\n#### Technical Context\nAWS root account use is prohibited per policy. This alert indicates unauthorized use of an AWS account by Zoom personnel or could indicate malicious use by an external actor.\n\n#### Blind Spots and Assumptions\nThe alert assumes all AWS account CloudTrail logs are ingested and available in Splunk.\n\n#### False Positives\nNo false positives are known at this time.\n\n#### Validation\nThe Operations team can log in to an AWS account's web console with a known root account. \n\n#### Priority\nMedium\n\n#### Response\nThe source IP address should be investigated to understand the source of the AWS root account use. Based on findings, the appriopriate Zoom team should consulted with to understand why the account was used. If the source IP address appears to be associated with an external actor, the event should be escalated appropriately.\n\n#### Additional Resources\n[Access, Authentication, and Monitoring Standard](https://c1secure.service-now.com/kb_view.do?sys_kb_id=f94943501b4f2050c8194118cc4bcb53)","search":"index=aws sourcetype=\"aws:cloudtrail\" user_type=Root ((eventType=AwsConsoleSignIn AND MFA=False) OR eventType=AwsApiCall)\n| rename userIdentity.invokedBy as userIdentityinvokedBy\n| where (eventType=\"AwsApiCall\" AND isnull(userIdentityinvokedBy)) OR eventType=\"AwsConsoleSignIn\"\n| eval user=coalesce(user, userName)\n| fields _time, user, user_type, eventType, eventName, sourceIPAddress, userAgent, aws_account_id\n| stats values(user_type) AS user_category earliest(_time) AS start_time latest(_time) AS end_time count by aws_account_id user eventType sourceIPAddress userAgent\n| fieldformat start_time=strftime(start_time,\"%F %T\")\n| fieldformat end_time=strftime(end_time,\"%F %T\")\n| fillnull value=\"unknown\"\n| sort start_time\n| rename sourceIPAddress as src\n| rename aws_account_id as src_user","dispatch.earliest_time":"-7d","dispatch.latest_time":"-10m","cron_schedule":"0 2 * * 5","action.notable.param.rule_title":"AWS Root Account Use Detected","action.notable.param.rule_description":"AWS root account use is prohibited per policy. This alert indicates unauthorized use of an AWS account by Zoom personnel or could indicate malicious use by an external actor.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"View related logs","action.notable.param.drilldown_search":"index=aws sourcetype=\"aws:cloudtrail\" user_type=Root (eventType=AwsConsoleSignIn OR eventType=AwsApiCall) | rename userIdentity.invokedBy as userIdentityinvokedBy | where (eventType=\"AwsApiCall\" AND isnull(userIdentityinvokedBy)) OR eventType=\"AwsConsoleSignIn\" | eval user=coalesce(user, userName)","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1620745567","updated":"2021-05-11","title":"Threat - OKTA - Attempted Bypass of User MFA - Rule","index":"okta","datamodel":"N/A","product":"Okta","action.correlationsearch.label":"OKTA - Attempted Bypass of User MFA","author":"matt.devries@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/11/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect when a user's multi-factor authentication (MFA) has been bypassed.  An adversary may deactivate MFA for an Okta user in order to register new MFA factors to abuse the account and blend in with normal activity.\n\n#### Categorization\nMITRE ATT&CK\nName: Persistence\nID: TA0003\nReference URL: https://attack.mitre.org/tactics/TA0003/\n\nName: Account Manipulation\nID: T1098\nReference URL: https://attack.mitre.org/techniques/T1098/\n\n#### Strategy Abstract\nCurrently ingesting Okta data in splunk as index=okta.  The use case will create a threat object based on the user's email and corrrelate with additional risk score matches.\n\n#### Technical Context\nThe correlation search filters based on Okta event user.mfa.attempt_bypass\" followed by a \"SUCCESS\".  The search runs every 10 minutes.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption or Okta events. \n\n#### False Positives\nUsers re-creating their own MFA tokens by adding a new phone or additional factor on their own.  \n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days against okta data.\n\n#### Priority\nThis alert should be a low severity but should be validated if additional alerts match with the same user.\n\n#### Response\nContact user (phone call or chat) to validate user was actually attempting to reconfigure or add a new MFA token to their account.  Suggest reviewing additional logs from the IP address(s) associated with the changes for additional account modifications for other users.\n\n#### Additional Resources\nhttps://developer.okta.com/docs/reference/api/event-types/\n\n#### Splunk Search\n```\nindex=okta tag=change eventType=\"user.mfa.attempt_bypass\" eventtype=\"okta_log_change_events\" result=SUCCESS\n```","search":"index=okta tag=change eventType=\"user.mfa.attempt_bypass\" eventtype=\"okta_log_change_events\" result=SUCCESS","dispatch.earliest_time":"-10m","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"30","action.risk.param._risk_object":"user"}}
{"preview":false,"result":{"updated_time":"1620236165","updated":"2021-05-05","title":"Access - AWS GuardDuty Tampering - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS GuardDuty Tampering","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/04/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect any attempt to disable or modify the functionalities of GuardDuty.\n\n#### Categorization\nThis use case aligns with TA0005 (Defense Evasion) and TA0003 (Persistence) ATT&CK Techniques.\n\n#### Strategy Abstract\nCurrently AWS GuardDuty data is ingested into Splunk under index=aws and sourcetype=\"aws:cloudtrail\". The use case will correlate IOA event names with GuardDuty's event source.\n\n#### Technical Context\nThe correlation search filters based on specific eventNames that indicated Loftrail tampering such as\n- DeleteDetector\n- DeleteMembers\n- DisassociateFromMasterAccount\n- DisassociateMembers\n- StopMonitoringMembers. The search runs every 6 hours based on data from the last 6 hours.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of AWS GuardDuty data feed.\n\n#### False Positives\nFalse positives is possible but unlikely for this use case as there ins't any valid uses that involves disable or altering GuardDuty, even for testing purposes.\n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days of alert data. It's unlikely that an alert will not trigger within a 7 day range.\n\n#### Priority\nThis alert should be a high severity and should be investigated as soon as possible.\n\n#### Response\nTriage Steps\n\n-Identify the source account, source IP, AWS instance, and any other relevant information collected from the correlated events\n\n-Perform research on the source IP to identify if it is a Zoom-controlled asset or not, attempt to identify an owner for the host\n\n-Investigate other activity performed by the same IP, user, and account ID over the last 24 hours paying close attention to the events immediately leading up to and following the time of this alert\n\n-Verify if there are any notifications to the SOC, Jira tickets, or other approved communications that this activity would be expected and authorized\n\n-If there is no justification for this activity, document all findings and escalate to Tier 2\n\n#### Splunk Search\n\n```\nindex=aws sourcetype=aws:cloudtrail eventSource=guardduty.amazonaws.com\neventName=DeleteDetector OR eventName=DisassociateFromMasterAccount OR eventName=StopMonitoringMembers OR eventName=DeleteMembers | eval user=coalesce(user, userName)\n| fields _time, user, user_type, eventType, eventName, sourceIPAddress, userAgent, aws_account_id\n| stats values(user_type) AS user_category earliest(_time) AS start_time latest(_time) AS end_time count by aws_account_id user eventType sourceIPAddress userAgent\n| fieldformat start_time=strftime(start_time,\"%F %T\")\n| fieldformat end_time=strftime(end_time,\"%F %T\")\n| fillnull value=\"unknown\"\n| sort start_time\n| rename sourceIPAddress as src, userAgent as http_user_agent, eventName as signature\n```\n","search":"index=aws sourcetype=aws:cloudtrail eventSource=guardduty.amazonaws.com\neventName=DeleteDetector OR eventName=DisassociateFromMasterAccount OR eventName=StopMonitoringMembers OR eventName=DeleteMembers | eval user=coalesce(user, userName)\n| fields _time, user, user_type, eventType, eventName, sourceIPAddress, userAgent, aws_account_id\n| stats values(user_type) AS user_category earliest(_time) AS start_time latest(_time) AS end_time count by aws_account_id user eventType sourceIPAddress userAgent\n| fieldformat start_time=strftime(start_time,\"%F %T\")\n| fieldformat end_time=strftime(end_time,\"%F %T\")\n| fillnull value=\"unknown\"\n| sort start_time\n| rename sourceIPAddress as src, userAgent as http_user_agent, eventName as signature","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"AWS GuardDuty Tampering","action.notable.param.rule_description":"The goal of this use case is to detect any attempt to disable or modify the functionalities of GuardDuty.","action.notable.param.security_domain":"access","action.notable.param.severity":"high","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1620235360","updated":"2021-05-05","title":"Access - AWS Admin Privileges Granted - Rule","index":"aws","datamodel":"N/A","product":"Amazon Web Services","action.correlationsearch.label":"AWS Admin Privileges Granted","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 05/04/2021: Initial Release\n\n#### Goal\nThe goal of this use case is to detect any AWS IAM roles with admin privileges being granted.\n\n#### Categorization\nThis use case aligns with the access MITRE ATT&CK Technique.\n\n#### Strategy Abstract\nCurrently AWS CloudTrail data is ingested into Splunk under index=aws and sourcetype=\"aws:cloudtrail\". The use case will correlate IOA event names with CloudTrail's event sources.\n\n#### Technical Context\nThe correlation search filters based on specific eventName=AttachUserPolicy and requestParameters.policyArn=*AdministratorAccess*. The search runs every 60 minutes based on data from the last 70 minutes.\n\n#### Blind Spots and Assumptions\nThis search assumes that there is no interruption of AWS cloudtrail data feed.\n\n#### False Positives\nMajority of alerts should be normal IT activity.\n\n#### Validation\nThe correlation search can be validated by running the search for the last 7 days against Cloudtrail data source.\n\n#### Priority\nThis alert should be a medium severity but should be validated against SNOW request.\n\n#### Response\nValidate AWS account ID with HappyDesk request for AWS admin privileges.\n\n#### Additional Resources\n\n\n#### Splunk Search\n\n```\nindex=aws sourcetype=aws:cloudtrail eventName=AttachUserPolicy requestParameters.policyArn=*AdministratorAccess*\n| table _time, action, aws_account_id, aws_account_name, awsRegion, status, eventName, sourceIPAddress, userAgent, eventType, requestParameters.userName, user, requestParameters.policyArn\n```","search":"index=aws sourcetype=aws:cloudtrail eventName=AttachUserPolicy requestParameters.policyArn=*AdministratorAccess*\n| table _time, action, aws_account_id, aws_account_name, awsRegion, status, eventName, sourceIPAddress, userAgent, eventType, requestParameters.userName, user, requestParameters.policyArn","dispatch.earliest_time":"-70min","dispatch.latest_time":"-10min","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"AWS Admin Privileges Granted","action.notable.param.rule_description":"The goal of this use case is to detect any AWS IAM roles with admin privileges being granted.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1617739526","updated":"2021-04-06","title":"Threat - Access: Unknown Assets Connected to Global Protect VPN - Rule","index":"paloaltocdl","datamodel":"N/A","product":"Palo Alto Networks","action.correlationsearch.label":"Access: Unknown Assets Connected to Global Protect VPN","author":"zunyan.yang@zoom.us","disabled":"0","description":"#### Release Notes\n- 04/05/2021: Created search\n\n#### Goal\nThe goal of this use case is to alert on VPN connections without Okta MFA. Alert count should be very low, if triggered there should be immediate investigation.\n\n#### Categorization\nMITRE ATT&CK: T1078\n\n#### Strategy Abstract\nThe search logic is querying aloaltocdl OR paloalto_cn for successful connections without Okta MFA.\n\n#### Technical Context\nAll VPN connections must be done via Okta MFA. Any connections without MFA could be indicative of malicious activity.\n\n#### Blind Spots and Assumptions\nThe alert assumes all Paloalto logs are ingested and available in Splunk.\n\n#### False Positives\nNo false positives are known at this time.\n\n#### Validation\nThe Operations team can log in to an AWS account's web console with a known root account. \n\n#### Priority\nMedium\n\n#### Response\nThe source IP address should be investigated to understand the source of the connections and cross-referenced with known malicious IPs. If the source IP address appears to be associated with an external actor, the event should be escalated appropriately.\n\n#### Additional Resources\n","search":"(index=paloaltocdl OR index=paloalto_cn) signature=\"globalprotectportal-auth-succ\" NOT \"Auth type: SAML\"","dispatch.earliest_time":"-70m","dispatch.latest_time":"-10m","cron_schedule":"*/60 * * * *","action.notable.param.rule_title":"Access: Unknown Assets Connected to Global Protect VPN","action.notable.param.rule_description":"The search logic is querying aloaltocdl OR paloalto_cn for successful connections without Okta MFA.","action.notable.param.security_domain":"access","action.notable.param.severity":"medium","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1617626747","updated":"2021-04-05","title":"Threat - Proofpoint TAP Imposter Detected - Rule","index":"proofpoint","datamodel":"N/A","product":["Proofpoint Digital Risk","Proofpoint Email","Proofpoint Targeted Attack Protection (TAP)"],"action.correlationsearch.label":"Proofpoint TAP Imposter Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 04/05/2021: Created search\n\n#### Goal\nThe overall goal of this alert is to detect, drive a rapid response, and minimize the impact caused by a user who has received an email from a fradulent sender attempting to imposter Zoom personnel.\n\n#### Categorization\nATT&CK: T1566, T1078, T1204\n\n#### Strategy Abstract\nThis search queries for events that match field/value of  \"threatsInfoMap{}.threatType\"=imposter and eventType=messagesDelivered in the Proofpoint TAP index/sourcetype. Enrichment is performed upstream in Proofpoint which has retroactively determined that a user received a message sourcing from a fradulent sender. False positives are very unlikely.\n\n#### Technical Context\nProofpoint Targeted Attack Protection (TAP) is responsible for blocking and detecting email threats destined to Zoom users. TAP will retroactively analyze previous message attachments against new intel. TAP console is here: https://threatinsight.proofpoint.com/\n\n#### Blind Spots and Assumptions\nProofpoint TAP only inspects email that is routed through Proofpoint MTAs. This will not inspect email received through any other third party services or email routed through separate email infrastructure.\n\n#### False Positives\nFalse positives are very unlikely for this alert. Any false positives occur upstream in Proofpoint TAP and will be caused by inaccurate intel sourcing from Proofpoint. False positives can be ruled out during the analysis of attachments\n\n#### Validation\nGive the reliance on Proofpoint intel, this control cannot be easily validated.\n\n#### Priority\nHigh\n\n#### Response\nThe alert should be further analyzed in ProofPoint TAP to understand the content of the email and if any malicious links are included in the body. \n\n#### Additional Resources\n- Email logs are contained in the index=proofpoint sourcetype=pps_messagelog.\n- More info can be found in [TAP support docs here](https://help.proofpoint.com/Threat_Insight_Dashboard/Product_Documentation/Threat_and_Campaign_Activity)","search":"index=proofpoint sourcetype=proofpoint_tap_siem \"threatsInfoMap{}.classification\"=impostor eventType=messagesDelivered\n| dedup messageID \n| stats latest(_time) as _time values(senderIP) as src, values(sender) as sender, values(\"recipient{}\") as recipient, values(subject) as subject, values(eventType) as action, values(threatsInfoMap{}.threatUrl) as url by messageID\n| rename messageID as transaction_id\n| eval file_name=mvfilter(NOT (match(file_name,\"text.html\") OR match(file_name,\"text.txt\"))), signature=\"Impostor\", desc=\"An inbound message from a fraudulent sender has been delivered to an end user.\"","dispatch.earliest_time":"-10m","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Imposter Message Detected - $recipient$","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View TAP logs","action.notable.param.drilldown_search":"index=proofpoint sourcetype=proofpoint_tap_siem \"threatsInfoMap{}.classification\"=impostor eventType=messagesDelivered messageID=\"$transaction_id$\"","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"20","action.risk.param._risk_object":"recipient"}}
{"preview":false,"result":{"updated_time":"1616779272","updated":"2021-03-26","title":"Threat - Unexpiring Notable Event Suppression Created - Rule","index":"N/A","datamodel":"N/A","product":"Miscellaneous","action.correlationsearch.label":"Unexpiring Notable Event Suppression Created","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 03/26/2021: Created search\n\n#### Goal\nAdministrative control designed to catch Notable Event suppressions that are inappropriately created without expiration dates. Generates an email notification to the Detection team.\n\n#### Categorization\nThis is not a threat detection capability.\n\n#### Strategy Abstract\nThe search is designed to catch Splunk ES Notable Event suppressions that are created without an expiration date. Notable Event suppressions should be used for short-term suppressions and long-term suppression should occur in the Splunk ES Correlation search's tuning macro.\n\n#### Technical Context\nThe search uses Splunk's REST API to find eventtypes that match criteria for Notable Event suppressions that have no expiration data set (no < symbol in search). Runs every morning at 2AM ET.\n\n#### Blind Spots and Assumptions\nNo blind spots exist.\n\n#### False Positives\nThis search will not generate false positives.\n\n#### Validation\nRun this search without filtering Detection Engineer team members and results will display.\n\n#### Priority\nLow\n\n#### Response\nThe Detection Team must add an expiration data and follow up with the individual who created the suppression to enter a long term supression request in CISO Sentinel.\n\n#### Additional Resources\n- [Tuning Detection Content](https://zoomvideo.atlassian.net/wiki/spaces/IS/pages/1732512088/Tuning+Detection+Content)\n- [How to create a Tuning Macro in Splunk ES](https://zoomvideo.atlassian.net/wiki/spaces/IS/pages/1678597980/How+to+create+a+Tuning+Macro+in+Splunk+ES)","search":"| rest servicesNS/-/-/saved/eventtypes\n| search title=\"notable_*\" NOT search=\"*<*\" NOT author IN (brendan.chamberlain@zoom.us, matt.devries@zoom.us, zunyan.yang@zoom.us, devon.thompson@zoom.us)\n| table title, author, updated","dispatch.earliest_time":"-24h","dispatch.latest_time":"now","cron_schedule":"0 2 * * *","action.notable.param.rule_title":"N/A","action.notable.param.rule_description":"N/A","action.notable.param.security_domain":"N/A","action.notable.param.severity":"N/A","action.notable.param.drilldown_name":"N/A","action.notable.param.drilldown_search":"N/A","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
{"preview":false,"result":{"updated_time":"1615985478","updated":"2021-03-17","title":"Threat - Proofpoint TAP Malicious URL Click Detected - Rule","index":"proofpoint","datamodel":"N/A","product":["Proofpoint Digital Risk","Proofpoint Email","Proofpoint Targeted Attack Protection (TAP)"],"action.correlationsearch.label":"Proofpoint TAP Malicious URL Click Detected","author":"brendan.chamberlain@zoom.us","disabled":"0","description":"#### Release Notes\n- 03/17/2021: Created search\n\n#### Goal\nThe overall goal of this alert is to detect, drive a rapid response, and minimize the impact caused by a user who has fallen victim to a phishing email.\n\n#### Categorization\nATT&CK: T1566, T1078, T1204\n\n#### Strategy Abstract\nThis search is keying on events that match field/value of  eventType=\"clicksPermitted\" in the Proofpoint TAP index/sourcetype. Enrichment is performed upstream in Proofpoint which has retroactively determined that a user clicked a malicious link that was not blocked. False positives are very unlikely.\n\n#### Technical Context\nProofpoint Targeted Attack Protection (TAP) is responsible for blocking and detecting email threats destined to Zoom users. TAP will retroactively analyze previous URL clicks against new intel that indicates when a user previously successfully clicked a phishing URL. TAP console is here: https://threatinsight.proofpoint.com/\n\n#### Blind Spots and Assumptions\nProofpoint TAP only inspects email that is routed through Proofpoint MTAs. This will not inspect email received through any other third party services or email routed through separate infrastructure.\n\n#### False Positives\nFalse positives are very unlikely for this alert. Any false positives occur upstream in Proofpoint TAP and will be caused by inaccurate intel sourcing from Proofpoint. False positives can be ruled out during the analysis of URLs.\n\n#### Validation\nGive the reliance on Proofpoint intel, this control cannot be easily validated.\n\n#### Priority\nHigh\n\n#### Response\nThe URL in question should be analyzed to understand intent (phish vs. malicious download). If the intent was to steal user credentials, the user's password should immediately be reset. If the URL leads to a malicious download, the users endpoint should be investigated for malicious activity and escalated appropriately.\n\n#### Additional Resources\n- Email logs are contained in the index=proofpoint sourcetype=pps_messagelog. \n- More info can be found in [TAP support docs here](https://help.proofpoint.com/Threat_Insight_Dashboard/Product_Documentation/Threat_and_Campaign_Activity)\n\n","search":"index=proofpoint sourcetype=proofpoint_tap_siem eventType=clicksPermitted \n| dedup url \n| eval desc=\"TAP detected user \".recipient.\" successfully browsed to a malicious URL. View more details in TAP by following this URL: \".threatURL, app=\"Proofpoint TAP\", action=if(eventType==\"clicksPermitted\", \"allowed\", \"blocked\") \n| rename senderIP as src, sender as src_user, classification as signature, eventType as signature_extra, userAgent as http_user_agent","dispatch.earliest_time":"-10m","dispatch.latest_time":"now","cron_schedule":"*/5 * * * *","action.notable.param.rule_title":"Malicious URL Click Detected - $recipient$","action.notable.param.rule_description":"$desc$","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View TAP logs","action.notable.param.drilldown_search":"index=proofpoint sourcetype=proofpoint_tap_siem eventType=clicksPermitted | dedup url  | eval desc=\"TAP detected user \".recipient.\" successfully browsed to a malicious URL. View more details in TAP by following this URL: \".threatURL, app=\"Proofpoint TAP\", action=if(eventType==\"clicksPermitted\", \"allowed\", \"blocked\")  | rename senderIP as src, sender as src_user, classification as signature, eventType as signature_extra, userAgent as http_user_agent | search recipient=$recipient$ url=$url$","action.risk.param._risk_object_type":"user","action.risk.param._risk_score":"50","action.risk.param._risk_object":"recipient"}}
{"preview":false,"lastrow":true,"result":{"updated_time":"1593124226","updated":"2020-06-25","title":"Threat - RN - 7 day ATT&CK Tactic threshold exceeded - Rule","index":"N/A","datamodel":"Risk","product":"Miscellaneous","action.correlationsearch.label":"RN - 7 day ATT&CK Tactic threshold exceeded","author":"admin","disabled":"0","description":"RBA:  ATT&CK tactic Threshold exceeded for an object within the previous 7 days.","search":"| from datamodel:\"Risk.All_Risk\" \n| search source=\"Threat - RR*\"  NOT testmode=1\n| table _time, risk_object risk_object_type risk_message source risk_score rule_attack_tactic_technique \n| makemv delim=\"|\" rule_attack_tactic_technique \n| mvexpand rule_attack_tactic_technique \n| rex field=rule_attack_tactic_technique \"(^|\\|)(?<tactic>.+?) - (?<tactic_num>.+?) - (?<technique>.+?) - (?<technique_ref>.*)\" \n| streamstats reset_after=\"(\"max_time-min_time>604800\")\" sum(risk_score) as risk_ScoreSum \n    min(_time) as min_time\n    max(_time) as max_time\n    dc(source) as sourceCount \n    dc(tactic) as tacticCount \n    dc(technique) as techniqueCount\n    by risk_object,risk_object_type \n| stats sum(risk_score) as risk_ScoreSum \n    values(risk_message) as risk_message \n    min(min_time) as min_time\n    max(sourceCount) as sourceCount \n    values(source) as source \n    values(rule_attack_tactic_technique) as rule_attack_tactic_technique \n    max(tacticCount) as tacticCount \n    values(tactic) as tactic \n    max(techniqueCount) as techniqueCount\n    values(technique) as technique\n    by risk_object,risk_object_type,max_time \n| eval risk_duration=max_time-min_time \n| where tacticCount >=3 and sourceCount >=4 and risk_duration < 604800 \n| eval risk_duration=tostring(risk_duration,\"duration\") \n| eval severity=case(risk_ScoreSum>=100 and risk_ScoreSum<250,\"medium\",\n    risk_ScoreSum>=250 and risk_ScoreSum <500,\"high\",\n    risk_ScoreSum>=500,\"critical\") \n| eval message=\"ATT&CT Tactic threshold exceeded (>=3) over previous 7 days for \".risk_object_type.\"=\".risk_object.\" spanning \".sourceCount.\" Risk Rules, \".tacticCount.\" ATT&CK tactics, and \".techniqueCount.\" ATT&CK techniques\"","dispatch.earliest_time":"-7d","dispatch.latest_time":"now","cron_schedule":"11,26,41,56 * * * *","action.notable.param.rule_title":"RBA:  ATT&CK Tactic threshold exceeded (>=3) over previous 7 days for $risk_object_type$=$risk_object$ spanning $sourceCount$ Risk Rules, $tacticCount$ ATT&CK tactics, and $techniqueCount$ ATT&CK techniques","action.notable.param.rule_description":"RBA:  ATT&CK tactic Threshold Exceeded for an object over the previous 7 days","action.notable.param.security_domain":"threat","action.notable.param.severity":"high","action.notable.param.drilldown_name":"View the individual Risk Attributions","action.notable.param.drilldown_search":"|from datamodel:\"Risk.All_Risk\"|search risk_object=$risk_object$ source=\"Threat*\" |table _time risk_object risk_object_type risk_message source risk_score rule_attack_tactic_technique |eventstats sum(risk_score) as risk_scoreSum by risk_object","action.risk.param._risk_object_type":"N/A","action.risk.param._risk_score":"N/A","action.risk.param._risk_object":"N/A"}}
